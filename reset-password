<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recuperar contraseña — LIXBY</title>
  <meta name="description" content="Recupera el acceso a tu cuenta de Lixby de forma segura y rápida." />
  <link rel="stylesheet" href="style.css">
  <style>
    .form-card { max-width:460px; margin:64px auto; text-align:left; border-radius:14px; padding:28px 18px 20px 18px; box-shadow:0 10px 30px rgba(2,6,12,0.06); background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.96)); }
    h1 { margin:0 0 10px; font-size:1.15rem; text-align:center; }
    .small { color:var(--muted); font-size:0.95rem; text-align:center; }
    label { display:block; margin-top:14px; font-weight:700; }
    input[type="email"], input[type="text"], input[type="password"] { width:100%; padding:10px 12px; border-radius:8px; border:1px solid var(--stroke); box-sizing:border-box; font-size:1rem; margin-top:6px; }
    .btn { padding:10px 15px; border-radius:10px; border:1px solid var(--stroke); background:transparent; cursor:pointer; font-weight:700; }
    .btn.primary { background:linear-gradient(180deg,var(--accent), color-mix(in oklab, var(--accent) 60%, #fff 40%)); color:#00121a; border:none; }
    .btn[disabled] { opacity:0.5; pointer-events:none; }
    .error { color:#dc2626; font-size:0.96rem; margin-top:6px; min-height:1.1em; }
    #formMessage { color:var(--muted); text-align:center; font-size:0.97rem; min-height:1.3em; margin-top:10px; }
    @media (max-width:560px){ .form-card { margin:32px 6px; padding:12px; } }
  </style>
</head>
<body>
  <header class="nav" aria-label="Cabecera">
    <div class="nav-inner" style="max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;">
      <div class="brand" id="brand" role="link" tabindex="0" aria-label="Ir al inicio">LIXBY</div>
      <div class="nav-right">
        <a href="login.html" class="btn ghost">Acceder</a>
      </div>
    </div>
  </header>

  <main>
    <div class="form-card" role="main" aria-labelledby="resetTitle">
      <h1 id="resetTitle">Recuperar acceso</h1>
      <div class="small">Introduce tu correo y te enviaremos instrucciones para restablecer tu contraseña.</div>
      <form id="resetForm" novalidate>
        <label for="resetEmail">Correo electrónico</label>
        <input id="resetEmail" type="email" autocomplete="email" required placeholder="nombre@ejemplo.com" />
        <div id="err-email" class="error" aria-live="polite"></div>
        <div style="margin-top:18px;display:flex;gap:8px;justify-content:flex-end;">
          <a href="login.html" class="btn ghost">Volver</a>
          <button id="btnSend" class="btn primary" type="submit">Enviar enlace</button>
        </div>
        <div id="formMessage" aria-live="polite"></div>
      </form>
    </div>
  </main>
  <script type="module" src="auth-firebase-minimal.js"></script>
  <script>
    const $ = id => document.getElementById(id);
    $('brand').addEventListener('click', ()=> location.href='index.html');
    $('brand').addEventListener('keypress', (e)=> { if(e.key==='Enter') location.href='index.html'; });

    const form = $('resetForm');
    form.addEventListener('submit', async ev => {
      ev.preventDefault();
      $('err-email').textContent = '';
      $('formMessage').textContent = '';
      const email = ($('resetEmail')||{}).value.trim();
      if (!email) { $('err-email').textContent = 'Introduce tu email.'; $('resetEmail').focus(); return; }
      // simple email regex
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { $('err-email').textContent = 'Email no válido.'; $('resetEmail').focus(); return; }
      $('btnSend').disabled = true;
      $('formMessage').textContent = 'Enviando email...';
      try {
        if(window.appAuth && typeof window.appAuth.resetPassword === 'function'){
          await window.appAuth.resetPassword(email, {method:'link'});
          $('formMessage').textContent = 'Te hemos enviado un email para restablecer la contraseña.';
        } else {
          $('formMessage').textContent = 'No se pudo conectar con el sistema de recuperación.';
        }
      } catch(e) {
        $('formMessage').textContent = (e && e.message) || 'Error enviando email.';
      } finally {
        $('btnSend').disabled = false;
      }
    });
  </script>
</body>
</html>
