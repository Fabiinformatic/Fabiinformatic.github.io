<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LIXBY ‚Äî Tecnolog√≠a minimalista</title>

  <!-- PERF: preconnect para reducir latencia en recursos externos -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://images.weserv.nl" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

  <link rel="stylesheet" href="style.css" />
  <!-- Overrides locales para header y comportamiento consistente -->
  <style>
    /* Header compacto, l√≠nea recta, minimal */
    .nav { position: fixed; top: 0; left: 0; right: 0; z-index: 120; padding: 10px 24px; background: rgba(255,255,255,0.02); backdrop-filter: blur(8px) saturate(120%); -webkit-backdrop-filter: blur(8px) saturate(120%); border-bottom: 1px solid rgba(255,255,255,0.03); border-radius: 0; box-shadow: none; }
    .nav-inner { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 16px; min-height: 64px; padding: 0 6px; }
    .nav-left { display:flex; align-items:center; gap:8px; flex:0 0 auto; }
    #navLinks { display:flex; gap:18px; align-items:center; justify-content:center; flex: 1 1 auto; padding: 8px 12px; white-space: nowrap; }
    .nav-right { display:flex; gap:10px; align-items:center; justify-content:flex-end; flex: 0 0 auto; flex-direction: row !important; }
    .cart-wrapper { position:relative; }
    .mini-cart { right:18px; top:56px; width:320px; box-sizing:border-box; z-index:140; display:none; flex-direction:column; }
    .lang-menu { right:18px; top:56px; box-sizing:border-box; z-index:140; }
    main { padding-top: calc(64px + 12px); }
    .card .actions { display:flex; gap:8px; align-items:center; margin-top:8px; }
    .btn-add { padding:8px 12px; border-radius:8px; border: none; cursor:pointer; background:linear-gradient(180deg,var(--accent), color-mix(in oklab, var(--accent) 60%, #fff 40%)); color:#00121a; font-weight:700; }
    .btn-view { padding:8px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:var(--text); cursor:pointer; }
    .contact-min { max-width: 1100px; margin: 28px auto; padding: 30px; display:flex; gap:24px; align-items:center; justify-content:space-between; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border:1px solid rgba(255,255,255,0.03); box-sizing:border-box; }
    .contact-min .form { flex:0 0 360px; display:flex; flex-direction:column; gap:10px }
    .contact-success { display:none; color:var(--accent); font-weight:600; margin-top:8px }
    #authOverlay { display:none; }
    #authOverlay[aria-hidden="false"] { display:block; }
    #authModal .btn { min-width:120px; }

    /* ligero hover animation global */
    .btn-add, .btn-fav, .icon-btn, .btn { transition: transform .16s cubic-bezier(.2,.9,.3,1), box-shadow .16s ease; }
    .btn-add:hover, .btn-fav:hover, .icon-btn:hover, .btn:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 10px 22px rgba(2,6,12,0.12); }

    /* skip link visible cuando tiene foco */
    .skip-link {
      position: absolute;
      left: 12px;
      top: 8px;
      padding: 8px 12px;
      background: #07101a;
      color: #fff;
      border-radius: 6px;
      z-index: 99999;
      transform: translateY(-120%);
      transition: transform .18s ease;
    }
    .skip-link:focus { transform: translateY(0); }

    /* pantalla oculta para lectores */
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
    @media (max-width:900px){
      .contact-min { flex-direction:column; } .contact-min .form{ width:100% }
    }

    /* small header account holder */
    .account-holder-btn {
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 8px;
      border-radius:10px;
      background: transparent;
      border:1px solid rgba(255,255,255,0.03);
      color:var(--text);
      cursor:pointer;
    }
    .account-holder-btn img { width:32px; height:32px; border-radius:8px; object-fit:cover; display:block; }
    .account-holder-btn .name { font-weight:700; font-size:0.95rem; color:var(--muted); }

    /* icon inside auth buttons */
    .auth-icon { width:18px; height:18px; flex:0 0 18px; display:inline-block; vertical-align:middle; }
    .auth-btn { display:inline-flex; align-items:center; gap:10px; justify-content:center; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; cursor:pointer; }

    /* Footer improvements */
    .footer { text-align:left; padding:40px 20px; margin-top:40px; }
    .footer-grid { max-width:1200px; margin:0 auto; display:grid; grid-template-columns: 1.4fr 1fr 1fr 1.2fr; gap:22px; align-items:start; }
    .footer-col h4 { margin:0 0 8px; font-size:1rem; color:var(--text); }
    .footer-brand { font-weight:800; letter-spacing:0.08em; font-size:1.05rem; margin-bottom:8px; }
    .footer p { margin:0 0 8px; color:var(--muted); }
    .footer-links { display:flex; flex-direction:column; gap:6px; }
    .footer-links a { color:var(--muted); font-size:0.95rem; }
    .social-links { display:flex; gap:8px; margin-top:8px; }
    .social-links a { display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:8px; background: rgba(255,255,255,0.02); color:var(--text); text-decoration:none; }
    .newsletter-form { display:flex; gap:8px; align-items:center; margin-top:6px; }
    .newsletter-form input[type="email"]{ padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--text); min-width:0; flex:1; }
    .newsletter-form button{ padding:10px 12px; border-radius:8px; border:0; background:var(--accent); color:#00121a; font-weight:700; cursor:pointer; }
    .footer-bottom { max-width:1200px; margin:18px auto 0; display:flex; align-items:center; justify-content:space-between; gap:12px; color:var(--muted); font-size:0.92rem; }
    .legal-links { display:flex; gap:12px; align-items:center; }
    .back-to-top { display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.04); cursor:pointer; color:var(--text); }
    @media (max-width:900px){
      .footer-grid { grid-template-columns: 1fr; gap:14px; }
      .footer-bottom { flex-direction:column; align-items:flex-start; gap:8px; }
    }
  </style>

  <!-- A√±adir: glass util (liquid glass styling consistente) -->
  <style id="lixby-glass-style">
    .glass {
      background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      backdrop-filter: blur(10px) saturate(120%);
      box-shadow: 0 6px 26px rgba(2,6,12,0.48);
      color: inherit;
    }
    .btn, .icon-btn {
      transition: transform .14s cubic-bezier(.2,.9,.3,1), box-shadow .14s ease;
    }
    .btn:focus, .icon-btn:focus, button:focus { outline: 3px solid rgba(10,132,255,0.14); outline-offset: 3px; }
  </style>

  <!-- Soporte: estilos a√±adidos (no borro nada, a√±ado) -->
  <style>
    /* --- Soporte t√©cnico (LIXBY) --- */
    .support-hero { padding:18px; border-radius:12px; display:flex; gap:12px; align-items:center; justify-content:space-between; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border:1px solid rgba(255,255,255,0.03); }
    .support-columns { display:grid; grid-template-columns: 1fr 380px; gap:22px; }
    @media (max-width:900px){ .support-columns { grid-template-columns: 1fr; } }
    .kb-item { border-radius:10px; padding:10px; background: rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.03); }
    .ticket-form input, .ticket-form textarea, .ticket-form select { padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--text); font-size:0.95rem; }
    .dropzone { border-radius:10px; padding:9px; cursor:pointer; background: rgba(255,255,255,0.005); color:var(--muted); display:flex; align-items:center; justify-content:space-between; }
    .attachments .attach-item { display:flex; justify-content:space-between; gap:8px; padding:8px; border-radius:8px; background: rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.03); }
    .progress-wrap { margin-top:8px; border-radius:8px; overflow:hidden; }
    .ticket-card { border: 1px solid rgba(255,255,255,0.03); }
    .ticket-card .btn { font-size:0.9rem; padding:6px 8px; }
    .ticket-meta { font-size:0.92rem; color:var(--muted); }
    .ticket-success { color: var(--accent); font-weight:700; }
  </style>
</head>
<body>
  <!-- skip link para accesibilidad -->
  <a class="skip-link" href="#maincontent">Saltar al contenido</a>

<!-- NAV -->
<header class="nav glass" role="banner">
  <div class="nav-inner">
    <!-- LEFT: logo -->
    <div class="nav-left">
      <div class="brand" role="button" aria-label="Ir al inicio" onclick="location.href='index.html'">LIXBY</div>
    </div>
    <!-- CENTER: nav links -->
    <nav id="navLinks" role="navigation" aria-label="Principal">
      <a href="#inicio" data-i18n="nav.inicio">Inicio</a>
      <a href="#productos" data-i18n="nav.productos">Productos</a>
      <a href="#contacto" data-i18n="nav.contacto">Cont√°ctanos</a>
      <a href="#conocenos" data-i18n="nav.conocenos">Con√≥cenos</a>
      <a href="#soporte" data-i18n="nav.soporte">Soporte</a>
    </nav>
    <!-- RIGHT: controles en fila -->
    <div class="nav-right" aria-hidden="false">
      <div class="cart-wrapper" style="position:relative;">
        <!-- A√±adido aria-controls y aria-expanded para accesibilidad -->
        <button id="cartBtn" class="icon-btn" aria-label="Ver carrito" aria-controls="miniCart" aria-expanded="false" type="button">üõí <span id="cartCount" class="badge">0</span></button>
        <div id="miniCart" class="mini-cart glass" aria-hidden="true" role="region" aria-label="Mini carrito">
          <div class="mini-cart-header" style="display:flex;justify-content:space-between;align-items:center;">
            <strong data-i18n="cart.title">Carrito</strong>
            <button id="clearCart" class="text-btn" data-i18n="cart.clear" type="button">Vaciar</button>
          </div>
          <div id="miniCartItems" class="mini-cart-items" tabindex="0" aria-live="polite" style="max-height:220px;overflow:auto;">
            <!-- items din√°micos -->
          </div>
          <div class="mini-cart-footer" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div><strong data-i18n="cart.total">Total:</strong> <span id="miniCartTotal">0‚Ç¨</span></div>
              <div><button id="checkoutBtn" class="btn primary" data-i18n="cart.checkout" type="button">Pagar</button></div>
            </div>
            <div style="display:flex;gap:8px;"><button id="viewCartBtn" class="btn ghost" type="button">Ver carrito</button></div>
          </div>
        </div>
      </div>

      <div class="lang-wrapper">
        <button id="langBtn" class="icon-btn" aria-haspopup="true" aria-expanded="false" type="button"> üá™üá∏ <span id="langLabel">Espa√±ol</span> ‚ñæ </button>
        <div id="langMenu" class="lang-menu glass" aria-hidden="true" style="display:none;flex-direction:column;gap:6px;padding:8px;width:160px;">
          <button class="lang-item" data-lang="es" type="button">üá™üá∏ Espa√±ol</button>
          <button class="lang-item" data-lang="en" type="button">üá¨üáß English</button>
          <button class="lang-item" data-lang="fr" type="button">üá´üá∑ Fran√ßais</button>
        </div>
      </div>

      <div id="accountContainer">
        <button id="accountBtn" class="btn ghost" aria-label="Mi cuenta" type="button">Cuenta</button>
      </div>

      <button id="themeToggle" class="btn ghost" aria-label="Cambiar tema" type="button">‚óê</button>
    </div>
  </div>
</header>

<!-- AUTH / WELCOME MODAL (mantengo tu HTML, actualizado con iconos) -->
<div id="authOverlay" aria-hidden="true" style="position:fixed;inset:0;z-index:9998;display:none;">
  <div id="authBackdrop" style="position:absolute;inset:0;background:rgba(0,0,0,0.45);backdrop-filter:blur(4px)"></div>
  <div id="authModal" class="glass" role="dialog" aria-labelledby="authTitle" style="position:relative;max-width:540px;margin:6vh auto;padding:22px;border-radius:12px;z-index:9999;">
    <h2 id="authTitle" style="margin:0 0 8px">Bienvenido a LIXBY</h2>
    <p style="margin:0 0 18px;color:var(--muted)">Inicia sesi√≥n para acceder a tu cuenta, pedidos y favoritos.</p>
    <div style="display:flex;gap:8px;margin-bottom:12px;">
      <!-- Google button with inline svg icon -->
      <button id="btnGoogle" class="auth-btn" style="flex:1" type="button" aria-label="Iniciar con Google">
        <svg class="auth-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path fill="#EA4335" d="M21.6 12.227c0-.74-.066-1.449-.191-2.136H12v4.048h5.4c-.233 1.254-1.01 2.316-2.155 3.03v2.52h3.48c2.036-1.876 3.23-4.64 3.23-7.462z"/><path fill="#34A853" d="M12 22c2.43 0 4.467-.8 5.956-2.17l-3.48-2.52c-.968.647-2.208 1.03-3.476 1.03-2.673 0-4.935-1.802-5.744-4.22H2.664v2.64C4.137 19.95 7.78 22 12 22z"/><path fill="#4A90E2" d="M6.256 13.12A6.997 6.997 0 0 1 6 12c0-.414.042-.817.122-1.2V8.16H2.664A9.997 9.997 0 0 0 2 12c0 1.66.397 3.226 1.096 4.64l3.16-3.52z"/><path fill="#FBBC05" d="M12 6.0c1.318 0 2.5.452 3.43 1.34l2.57-2.57C16.47 2.98 14.43 2 12 2 7.78 2 4.137 4.05 2.664 8.16L6 9.36C6.865 7.16 9.327 6 12 6z"/></svg>
        <span>Iniciar con Google</span>
      </button>

      <!-- GitHub button with SVG -->
      <button id="btnGitHub" class="auth-btn" style="flex:1" type="button" aria-label="Iniciar con GitHub">
        <svg class="auth-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path fill="currentColor" d="M12 2C6.48 2 2 6.58 2 12.18c0 4.5 2.87 8.32 6.84 9.66.5.1.68-.22.68-.48 0-.24-.01-.87-.01-1.7-2.78.62-3.37-1.36-3.37-1.36-.45-1.18-1.11-1.5-1.11-1.5-.91-.64.07-.63.07-.63 1 .07 1.53 1.05 1.53 1.05.9 1.56 2.36 1.11 2.94.85.09-.66.35-1.11.64-1.37-2.22-.26-4.56-1.14-4.56-5.07 0-1.12.39-2.04 1.03-2.76-.1-.26-.45-1.31.1-2.73 0 0 .84-.27 2.75 1.05A9.24 9.24 0 0 1 12 6.8c.85.004 1.71.115 2.5.34 1.9-1.32 2.74-1.05 2.74-1.05.55 1.42.2 2.47.1 2.73.64.72 1.03 1.64 1.03 2.76 0 3.94-2.34 4.81-4.57 5.07.36.3.68.9.68 1.82 0 1.31-.01 2.36-.01 2.68 0 .26.18.59.69.49A10.2 10.2 0 0 0 22 12.18C22 6.58 17.52 2 12 2z"/></svg>
        <span>Iniciar con GitHub</span>
      </button>
    </div>
    <div style="display:flex;align-items:center;gap:8px;margin:8px 0;color:var(--muted)">
      <hr style="flex:1;border:none;height:1px;background:rgba(255,255,255,0.04)"/>
      <span style="font-size:0.9rem">o con correo</span>
      <hr style="flex:1;border:none;height:1px;background:rgba(255,255,255,0.04)"/>
    </div>
    <form id="authEmailForm" style="display:flex;flex-direction:column;gap:8px" onsubmit="return false;">
      <input id="authEmail" type="email" placeholder="Correo" required style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)"/>
      <input id="authPass" type="password" placeholder="Contrase√±a" required style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)"/>
      <div style="display:flex;gap:8px;justify-content:space-between;align-items:center">
        <button type="button" id="btnEmailSignIn" class="btn primary">Iniciar sesi√≥n</button>
        <button type="button" id="btnEmailSignUp" class="btn ghost">Registrarse</button>
      </div>
    </form>
    <div style="text-align:center;margin-top:12px">
      <button id="btnAnonymous" class="btn ghost" type="button">Continuar como invitado</button>
    </div>
    <div style="display:flex;justify-content:center;margin-top:12px;font-size:0.9rem">
      <a id="authToAccount" href="cuenta.html" style="color:var(--muted)">Ya tienes cuenta? Ir a mi cuenta</a>
    </div>
    <button id="authClose" aria-label="Cerrar" style="position:absolute;right:12px;top:12px;background:transparent;border:0;font-size:18px" type="button">‚úï</button>
  </div>
</div>
<!-- END AUTH -->

<main id="maincontent">
  <!-- HERO -->
  <section id="inicio" class="hero reveal" aria-labelledby="hero-title">
    <div class="hero-content">
      <h1 id="hero-title">La tecnolog√≠a que te entiende</h1>
      <p>Innovaci√≥n minimalista para tu d√≠a a d√≠a</p>
      <!-- changed to explorar.html as requested -->
      <a href="explorar.html" class="btn primary" data-i18n="btn.explorar">Explorar</a>
    </div>
  </section>

  <!-- PRODUCTOS -->
  <section id="productos" class="section reveal" aria-labelledby="prod-title">
    <h2 id="prod-title">Productos</h2>
    <div class="grid">
      <!-- Lixby One Air -->
      <article class="card glass" data-product="lixby-one-air" role="button" tabindex="0" aria-label="Lixby One Air">
        <div class="thumb">
          <!-- mantuvimos loading lazy y dimensiones -->
          <img src="https://m.media-amazon.com/images/I/61j5RD1d9KL._UF1000,1000_QL80_.jpg" alt="Lixby One Air"
               loading="lazy" decoding="async" width="600" height="600">
        </div>
        <h3>Lixby One Air</h3>
        <p>Ultraligero y econ√≥mico.</p>
        <span class="price">249‚Ç¨</span>
        <div class="actions">
          <button class="btn-view" onclick="location.href='producto.html?id=lixby-one-air'" type="button">Ver</button>
          <button class="btn-add" data-id="lixby-one-air" type="button">A√±adir al carrito</button>
        </div>
      </article>

      <!-- Lixby One -->
      <article class="card glass" data-product="lixby-one" role="button" tabindex="0" aria-label="Lixby One">
        <div class="thumb">
          <img src="https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg" alt="Lixby One"
               loading="lazy" decoding="async" width="600" height="600">
        </div>
        <h3>Lixby One</h3>
        <p>Ultraligero y potente.</p>
        <span class="price">349‚Ç¨</span>
        <div class="actions">
          <button class="btn-view" onclick="location.href='producto.html?id=lixby-one'" type="button">Ver</button>
          <button class="btn-add" data-id="lixby-one" type="button">A√±adir al carrito</button>
        </div>
      </article>

      <!-- Lixby One Pro -->
      <article class="card glass" data-product="lixby-one-pro" role="button" tabindex="0" aria-label="Lixby One Pro">
        <div class="thumb">
          <img src="https://m.media-amazon.com/images/I/61rriyfRKwL.jpg" alt="Lixby One Pro"
               loading="lazy" decoding="async" width="600" height="600">
        </div>
        <h3>Lixby One Pro</h3>
        <p>Audio de alta fidelidad.</p>
        <span class="price">899‚Ç¨</span>
        <div class="actions">
          <button class="btn-view" onclick="location.href='producto.html?id=lixby-one-pro'" type="button">Ver</button>
          <button class="btn-add" data-id="lixby-one-pro" type="button">A√±adir al carrito</button>
        </div>
      </article>
    </div>
  </section>

  <!-- CONTACTO -->
  <section id="contacto" class="section contact-min glass reveal" aria-labelledby="contact-title">
    <div class="left">
      <h2 id="contact-title">Cont√°ctanos</h2>
      <p class="lead">D√©janos una duda o sugerencias y te responderemos lo antes posible.</p>
    </div>

    <form id="contactForm" class="form" aria-label="Formulario de contacto" onsubmit="return false;">
      <input id="contactName" name="from_name" type="text" placeholder="Nombre" required autocomplete="name">
      <input id="contactEmail" name="from_email" type="email" placeholder="Correo" required autocomplete="email">
      <textarea id="contactMessage" name="message" placeholder="Tu mensaje" required></textarea>
      <div class="actions">
        <button type="button" class="btn ghost" onclick="document.getElementById('contactForm').reset();">Borrar</button>
        <button type="submit" id="contactSend" class="btn primary">Enviar</button>
      </div>
      <div id="contactSuccess" class="contact-success" role="status" aria-live="polite">Mensaje enviado. ¬°Gracias! Te contestaremos pronto.</div>
    </form>
  </section>

  <!-- CON√ìCENOS -->
  <section id="conocenos" class="section reveal" aria-labelledby="about-title">
    <h2 id="about-title">Con√≥cenos</h2>
    <p>En LIXBY creemos en el equilibrio perfecto entre dise√±o y funcionalidad. Creamos productos que no solo funcionan, sino que tambi√©n inspiran.</p>
  </section>

  <!-- ===========================
       SECCI√ìN: Soporte t√©cnico (A√ëADIDA sin borrar nada)
       =========================== -->
  <section id="soporte" class="section reveal" aria-labelledby="soporte-title">
    <div style="max-width:1100px;margin:0 auto;display:flex;flex-direction:column;gap:18px;">
      <div class="support-hero glass" style="display:flex;justify-content:space-between;align-items:center;padding:18px;">
        <div>
          <h2 id="soporte-title" style="margin:0 0 6px">Soporte t√©cnico</h2>
          <p style="margin:0;color:var(--muted)">Abre un ticket con capturas o registros y te ayudamos lo antes posible.</p>
        </div>
        <div style="text-align:right;color:var(--muted);font-size:0.95rem;">
          Horario: Lun‚ÄìVie 09:00‚Äì18:00
        </div>
      </div>

      <div class="support-columns">
        <!-- Left: KB + tickets -->
        <div>
          <h3 style="margin-top:0">Resoluci√≥n r√°pida</h3>

          <details class="kb-item glass" open style="padding:12px;margin-bottom:8px;">
            <summary>Mi dispositivo no enciende</summary>
            <div style="color:var(--muted);margin-top:8px">
              <ol style="margin:0 0 0 18px">
                <li>Comprueba el cargador y el cable.</li>
                <li>Mant√©n pulsado encendido 12s.</li>
                <li>Adjunta foto del puerto si abres ticket.</li>
              </ol>
            </div>
          </details>

          <details class="kb-item glass" style="padding:12px;margin-bottom:8px;">
            <summary>Problemas de red</summary>
            <div style="color:var(--muted);margin-top:8px">
              Reinicia router y dispositivo; si persiste, adjunta logs o captura.
            </div>
          </details>

          <hr style="border:none;height:1px;background:rgba(255,255,255,0.03)">

          <h4 style="margin:10px 0 6px">Tus tickets recientes</h4>
          <div id="ticketsList" class="tickets-list" aria-live="polite" style="display:flex;flex-direction:column;gap:10px;"></div>
        </div>

        <!-- Right: formulario -->
        <aside>
          <form id="ticketForm" class="ticket-form glass" style="display:flex;flex-direction:column;gap:10px;padding:12px;border-radius:12px;" onsubmit="return false;">
            <input id="t-name" name="name" type="text" placeholder="Tu nombre" required />
            <input id="t-email" name="email" type="email" placeholder="tu@correo.com" required />
            <select id="t-product" name="product" aria-label="Selecciona producto">
              <option value="">Producto (opcional)</option>
              <option value="lixby-one-air">Lixby One Air</option>
              <option value="lixby-one">Lixby One</option>
              <option value="lixby-one-pro">Lixby One Pro</option>
            </select>
            <textarea id="t-desc" name="description" rows="5" placeholder="Describe el problema" required></textarea>

            <label for="fileInput" id="dropzone" class="dropzone" tabindex="0" style="display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;border:2px dashed rgba(255,255,255,0.04);cursor:pointer;">
              <span class="dz-info">Arrastra archivos o haz clic (m√°x 5 archivos / 10MB total)</span>
              <input id="fileInput" type="file" accept=".png,.jpg,.jpeg,.webp,.txt,.log,.zip,.pdf" multiple style="display:none" />
            </label>

            <div id="attachments" class="attachments" style="display:flex;flex-direction:column;gap:8px"></div>

            <div id="uploadProgressWrap" class="progress-wrap" style="display:none;background:rgba(255,255,255,0.02);border-radius:8px;padding:4px;">
              <div id="uploadProgressBar" class="progress-bar" style="height:8px;width:0%;border-radius:6px;background:var(--accent);transition:width .24s ease;"></div>
            </div>

            <div style="display:flex;gap:8px;justify-content:space-between;align-items:center">
              <button id="submitTicket" class="btn primary" type="button">Enviar ticket</button>
              <div style="display:flex;gap:8px">
                <button id="attachLog" type="button" class="btn ghost">Adjuntar registro</button>
                <button id="clearForm" type="button" class="btn ghost">Limpiar</button>
              </div>
            </div>

            <div id="ticketInfo" class="ticket-meta" style="color:var(--muted);font-size:0.95rem"></div>
            <div id="ticketSuccess" class="ticket-success" style="display:none;margin-top:8px">Ticket creado ‚Äî ID: <span id="ticketId"></span></div>
          </form>
        </aside>
      </div>
    </div>
  </section>
  <!-- /Soporte a√±adido -->

</main>

<!-- debug (oculto a usuarios, √∫til para showDebug) -->
<div id="debug" style="display:none;max-width:1100px;margin:12px auto;color:var(--muted);white-space:pre-wrap;"></div>

<!-- Enhanced footer: preserve original copyright but add columns, newsletter and links -->
<footer class="footer glass" role="contentinfo" aria-labelledby="footer-heading">
  <div class="footer-grid" id="footerGrid">
    <div class="footer-col">
      <div class="footer-brand">LIXBY</div>
      <p>Dise√±o minimalista, tecnolog√≠a que acompa√±a tu d√≠a a d√≠a. S√≠guenos para novedades y lanzamientos.</p>
      <div class="social-links" aria-label="Redes sociales">
        <a href="#" title="Twitter" aria-label="Twitter" rel="noopener">
          <!-- simple svg icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M22 5.92c-.64.29-1.32.49-2.04.58.73-.44 1.28-1.14 1.54-1.97-.68.4-1.43.69-2.23.85C18.94 4.6 18 4.2 17 4.2c-1.83 0-3.32 1.54-3 3.34C9.72 7.3 6.1 5.3 3.73 2.47c-.2.35-.3.76-.3 1.2 0 1.03.52 1.94 1.33 2.48-.6 0-1.15-.18-1.63-.45v.05c0 1.2.9 2.2 2.06 2.43-.45.12-.92.15-1.4.06.4 1.25 1.56 2.16 2.94 2.19C6.1 11.4 4.5 11.9 3 11.9c-.25 0-.5 0-.74-.04C4.36 13.06 6.16 13.8 8.12 13.8c8.35 0 12.92-6.9 12.92-12.88v-.58c.9-.68 1.6-1.54 2.2-2.52-.83.38-1.72.63-2.64.74z"/></svg>
        </a>
        <a href="#" title="Instagram" aria-label="Instagram" rel="noopener">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 6.2a4.8 4.8 0 1 0 0 9.6 4.8 4.8 0 0 0 0-9.6zm6.5-.9a1.1 1.1 0 1 1 0 2.2 1.1 1.1 0 0 1 0-2.2zM12 9.6a2.4 2.4 0 1 1 0 4.8 2.4 2.4 0 0 1 0-4.8z"/></svg>
        </a>
        <a href="#" title="YouTube" aria-label="YouTube" rel="noopener">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M23 7.5s-.2-1.7-.8-2.4c-.8-.9-1.7-.92-2.1-1-2.95-.22-7.35-.22-7.35-.22S6.9 3 3.95 3.22c-.44.07-1.33.1-2.1 1C1.27 4.8 1 6.5 1 6.5S1 8.86 1 11.25v1.5C1 16 1 18.5 1 18.5s.27 1.7.85 2.4c.8.9 1.84.87 2.3.98 1.66.22 7.05.22 7.05.22s4.4 0 7.35-.22c.44-.07 1.33-.1 2.1-1 .62-.66.82-2.4.82-2.4s.1-2.5.1-4.88v-1.5C23 8.86 23 7.5 23 7.5zM9.75 15.5v-7l6 3.5-6 3.5z"/></svg>
        </a>
      </div>
    </div>

    <div class="footer-col">
      <h4>Enlaces</h4>
      <div class="footer-links" role="navigation" aria-label="Enlaces r√°pidos">
        <a href="explorar.html">Explorar</a>
        <a href="productos.html">Cat√°logo</a>
        <a href="carrito.html">Carrito</a>
        <a href="cuenta.html">Mi cuenta</a>
      </div>
    </div>

    <div class="footer-col">
      <h4>Ayuda</h4>
      <div class="footer-links">
        <a href="contacto.html">Contacto</a>
        <a href="faq.html" id="footerFaqLink">Preguntas frecuentes</a>
        <a href="envios.html">Env√≠os y devoluciones</a>
        <a href="soporte.html">Soporte t√©cnico</a>
      </div>
    </div>

    <div class="footer-col" aria-label="Newsletter">
      <h4>Suscr√≠bete</h4>
      <p>Recibe novedades, ofertas exclusivas y lanzamientos.</p>
      <form id="newsletterForm" class="newsletter-form" onsubmit="return false;" aria-label="Formulario newsletter">
        <input id="newsletterEmail" type="email" placeholder="tu@correo.com" aria-label="Correo electr√≥nico para newsletter" required>
        <button id="newsletterBtn" type="submit" aria-label="Suscribirse">Suscribir</button>
      </form>
      <div id="newsletterMsg" role="status" aria-live="polite" style="margin-top:8px;color:var(--muted);font-size:0.95rem"></div>
    </div>
  </div>

  <div class="footer-bottom">
    <div class="legal-left">
      <small>¬© <span id="year"></span> LIXBY ‚Äî Todos los derechos reservados</small>
      <div class="legal-links" style="margin-left:12px;">
        <a href="privacidad.html">Pol√≠tica de privacidad</a>
        <a href="terminos.html">T√©rminos y condiciones</a>
        <a href="accessibility.html">Accesibilidad</a>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:12px;">
      <button id="backToTop" class="back-to-top" aria-label="Volver arriba" title="Volver arriba">‚Üë Volver arriba</button>
      <small style="color:var(--muted)">Versi√≥n demo</small>
    </div>
  </div>
</footer>

<!-- Cart panel (est√°tico) + backdrop -->
<div id="cartBackdrop" class="cart-backdrop" aria-hidden="true"></div>
<aside id="cartPanel" class="cart-panel" aria-hidden="true">
  <div class="cart-panel-inner glass" role="dialog" aria-label="Carrito">
    <div class="cart-header" style="display:flex;justify-content:space-between;align-items:center;">
      <strong data-i18n="cart.title">Carrito</strong>
      <button id="cartPanelClose" class="text-btn" aria-label="Cerrar" type="button">‚úï</button>
    </div>
    <div id="cartPanelItems" class="cart-list" style="max-height:60vh;overflow:auto;padding:12px"></div>
    <div class="cart-footer" style="padding:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <strong>Total</strong>
        <span id="cartPanelTotal">0‚Ç¨</span>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button id="cartPanelCheckout" class="btn primary" data-i18n="cart.checkout" type="button">Pagar</button>
        <button id="cartPanelClear" class="btn ghost" data-i18n="cart.clear" type="button">Vaciar</button>
      </div>
    </div>
  </div>
</aside>

<!-- Live region for screen-reader announcements (used when adding to cart, etc.) -->
<div id="announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<noscript style="display:block;background:#fffb; padding:10px; text-align:center;">
  JavaScript est√° desactivado o ha ocurrido un error. Si la p√°gina no carga correctamente, abre la consola (F12 ‚Üí Console).
</noscript>

<!-- ===========================
     SCRIPTS (todo inline para que copies directo)
     =========================== -->
<script>
(function(){
  // -------------------------
  // Helpers y estado
  // -------------------------
  const KEY = 'lixby_cart_v1';
  // Formateador consistente (es-ES)
  const CURRENCY = new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' });

  function parsePrice(s){ if (s === undefined || s === null) return 0; return Number(String(s).replace(/[^\d.,-]/g,'').replace(',', '.')) || 0; }
  function saveCart(c){ try { localStorage.setItem(KEY, JSON.stringify(c)); } catch(e){} }
  function loadCart(){ try { return JSON.parse(localStorage.getItem(KEY))||[]; } catch(e){ return []; } }
  function formatPriceNum(num){ return CURRENCY.format(Number(num) || 0); }
  function showDebug(msg){ const el=document.getElementById('debug'); if(!el) return; el.style.display='block'; el.textContent += msg + "\n"; console.log('DEBUG',msg); }

  // set year
  try { document.getElementById('year').textContent = new Date().getFullYear(); } catch(e){}

  // product brief (igual que antes)
  const PRODUCTS_BRIEF = {
    'lixby-one-air': { id:'lixby-one-air', name: 'Lixby One Air', price: '249‚Ç¨', priceNum: 249, image: 'https://m.media-amazon.com/images/I/61j5RD1d9KL._UF1000,1000_QL80_.jpg' },
    'lixby-one': { id:'lixby-one', name: 'Lixby One', price: '349‚Ç¨', priceNum: 349, image: 'https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg' },
    'lixby-one-pro': { id:'lixby-one-pro', name: 'Lixby One Pro', price: '899‚Ç¨', priceNum: 899, image: 'https://m.media-amazon.com/images/I/61rriyfRKwL.jpg' }
  };

  // CART
  let cart = loadCart();
  const cartBtn = document.getElementById('cartBtn');
  const miniCart = document.getElementById('miniCart');
  const miniCartItems = document.getElementById('miniCartItems');
  const miniCartTotal = document.getElementById('miniCartTotal');
  const cartCount = document.getElementById('cartCount');
  const clearCartBtn = document.getElementById('clearCart');
  const checkoutBtn = document.getElementById('checkoutBtn');
  const announcements = document.getElementById('announcements');

  // panel elements
  const cartPanel = document.getElementById('cartPanel');
  const cartBackdrop = document.getElementById('cartBackdrop');
  const cartPanelClose = document.getElementById('cartPanelClose');
  const cartPanelItems = document.getElementById('cartPanelItems');
  const cartPanelTotal = document.getElementById('cartPanelTotal');
  const cartPanelClear = document.getElementById('cartPanelClear');

  function updateMiniCartUI(){
    if (!cartCount) return;
    const totalQty = cart.reduce((s,i)=>s+(i.qty||0),0);
    cartCount.textContent = totalQty;
    if (!miniCartItems) return;
    miniCartItems.innerHTML = '';
    if (cart.length === 0) {
      miniCartItems.innerHTML = '<div style="padding:8px;color:var(--muted)">'+ (getTranslation('cart.empty') || 'Tu carrito est√° vac√≠o.') +'</div>';
      if (miniCartTotal) miniCartTotal.textContent = formatPriceNum(0);
      return;
    }
    let total = 0;
    // fragment para menor reflow
    const frag = document.createDocumentFragment();
    cart.forEach((it, idx) => {
      const item = document.createElement('div');
      item.className = 'mini-cart-item';
      item.style.display = 'flex'; item.style.gap='10px'; item.style.alignItems='center'; item.style.padding='8px'; item.style.borderRadius='8px';
      const img = document.createElement('img'); img.src = it.image || 'https://via.placeholder.com/80x80?text=Img'; img.alt = it.name; img.style.width='44px'; img.style.height='44px'; img.style.objectFit='cover'; img.style.borderRadius='6px';
      img.loading='lazy'; img.decoding='async';
      const meta = document.createElement('div'); meta.className='meta';
      // RENDER SEGURO: no usar innerHTML con contenido din√°mico
      const title = document.createElement('div'); title.style.fontWeight = '700'; title.textContent = it.name || '';
      const subtitle = document.createElement('div'); subtitle.style.color = 'var(--muted)'; subtitle.textContent = `${formatPriceNum(it.priceNum || parsePrice(it.price))} √ó ${it.qty||1}`;
      meta.appendChild(title); meta.appendChild(subtitle);

      const remove = document.createElement('button'); remove.className='remove'; remove.textContent='‚úï'; remove.style.background='transparent'; remove.style.border='none'; remove.style.cursor='pointer';
      remove.setAttribute('type','button');
      remove.addEventListener('click', (e)=>{ e.stopPropagation(); cart.splice(idx,1); saveCart(cart); updateMiniCartUI(); updateCartPanel(); });
      item.appendChild(img); item.appendChild(meta); item.appendChild(remove);
      frag.appendChild(item);
      total += (it.priceNum || parsePrice(it.price)) * (it.qty||1);
    });
    miniCartItems.appendChild(frag);
    if (miniCartTotal) miniCartTotal.textContent = formatPriceNum(total);
  }

  function updateCartPanel(){
    if (!cartPanelItems) return;
    cartPanelItems.innerHTML = '';
    if (cart.length === 0) {
      cartPanelItems.innerHTML = '<div style="padding:12px;color:var(--muted)">'+ (getTranslation('cart.empty') || 'Tu carrito est√° vac√≠o.') +'</div>';
      if (cartPanelTotal) cartPanelTotal.textContent = formatPriceNum(0);
      return;
    }
    let total = 0;
    const frag = document.createDocumentFragment();
    cart.forEach((it, idx) => {
      const row = document.createElement('div');
      row.style.display='flex'; row.style.gap='12px'; row.style.alignItems='center'; row.style.padding='10px 0'; row.style.borderBottom='1px solid rgba(255,255,255,0.03)';
      const img = document.createElement('img'); img.src = it.image || ''; img.alt = it.name; img.style.width='64px'; img.style.height='64px'; img.style.objectFit='cover'; img.style.borderRadius='8px';
      const meta = document.createElement('div'); meta.style.flex='1';
      const title = document.createElement('div'); title.style.fontWeight='700'; title.textContent = it.name || '';
      const qty = document.createElement('div'); qty.style.color='var(--muted)'; qty.textContent = `√ó ${it.qty || 1} ‚Äî ${formatPriceNum(it.priceNum || parsePrice(it.price))}`;
      meta.appendChild(title); meta.appendChild(qty);
      const remove = document.createElement('button'); remove.className='text-btn'; remove.textContent='Eliminar'; remove.setAttribute('type','button');
      remove.addEventListener('click', ()=> { cart.splice(idx,1); saveCart(cart); updateMiniCartUI(); updateCartPanel(); });
      row.appendChild(img); row.appendChild(meta); row.appendChild(remove);
      frag.appendChild(row);
      total += (it.priceNum || parsePrice(it.price)) * (it.qty||1);
    });
    cartPanelItems.appendChild(frag);
    if (cartPanelTotal) cartPanelTotal.textContent = formatPriceNum(total);
  }

  // ensure miniCart style reflects aria-hidden initially
  if (miniCart) {
    if (miniCart.getAttribute('aria-hidden') === 'false') miniCart.style.display = 'flex';
    else miniCart.style.display = '';
  }

  // Hover show mini-cart & click open panel
  (function wireCartHoverAndClick(){
    const wrapper = document.querySelector('.cart-wrapper');
    let hideTimeout = null;

    function showMini(){
      if (!miniCart) return;
      miniCart.setAttribute('aria-hidden','false');
      miniCart.style.display = 'flex';
      try { cartBtn.setAttribute('aria-expanded','true'); } catch(e){}
    }
    function hideMini(){
      if (!miniCart) return;
      miniCart.setAttribute('aria-hidden','true');
      miniCart.style.display = '';
      try { cartBtn.setAttribute('aria-expanded','false'); } catch(e){}
    }

    // show on hover enter; keep visible while hovering miniCart
    if (wrapper) {
      wrapper.addEventListener('mouseenter', (e) => {
        clearTimeout(hideTimeout);
        showMini();
      });
      wrapper.addEventListener('mouseleave', (e) => {
        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(() => {
          // do not hide if cart panel is open
          if (cartPanel && cartPanel.classList.contains('open')) return;
          hideMini();
        }, 180);
      });
    }
    if (miniCart) {
      miniCart.addEventListener('mouseenter', () => { clearTimeout(hideTimeout); showMini(); });
      miniCart.addEventListener('mouseleave', () => {
        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(() => {
          if (cartPanel && cartPanel.classList.contains('open')) return;
          hideMini();
        }, 180);
      });
    }

    // click opens panel (and hide mini)
    if (cartBtn) {
      cartBtn.addEventListener('click', (e) => {
        openCartPanel();
      });
    }

    // also wire viewCartBtn to open panel
    const viewBtn = document.getElementById('viewCartBtn');
    if (viewBtn) viewBtn.addEventListener('click', (e)=> openCartPanel());
  })();

  // Panel control functions
  function openCartPanel(){
    if (!cartPanel || !cartBackdrop) return;
    cartPanel.classList.add('open');
    cartBackdrop.classList.add('open');
    cartPanel.setAttribute('aria-hidden','false');
    cartBackdrop.setAttribute('aria-hidden','false');
    // ensure mini hidden
    if (miniCart) { miniCart.setAttribute('aria-hidden','true'); miniCart.style.display = ''; try { cartBtn.setAttribute('aria-expanded','false'); } catch(e){} }
    // update content
    updateCartPanel();
  }
  function closeCartPanel(){
    if (!cartPanel || !cartBackdrop) return;
    cartPanel.classList.remove('open');
    cartBackdrop.classList.remove('open');
    cartPanel.setAttribute('aria-hidden','true');
    cartBackdrop.setAttribute('aria-hidden','true');
  }
  if (cartBackdrop) cartBackdrop.addEventListener('click', closeCartPanel);
  if (cartPanelClose) cartPanelClose.addEventListener('click', closeCartPanel);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { if (cartPanel && cartPanel.classList.contains('open')) closeCartPanel(); } });

  // clear handlers for panel & mini
  if (clearCartBtn) clearCartBtn.addEventListener('click', () => { cart=[]; saveCart(cart); updateMiniCartUI(); updateCartPanel(); });
  if (cartPanelClear) cartPanelClear.addEventListener('click', () => { cart=[]; saveCart(cart); updateMiniCartUI(); updateCartPanel(); });

  if (checkoutBtn) checkoutBtn.addEventListener('click', () => { if (cart.length===0) return alert('El carrito est√° vac√≠o'); alert('Simulaci√≥n de checkout: ' + cart.reduce((s,i)=>s+(i.qty||0),0) + ' items'); });
  if (document.getElementById('cartPanelCheckout')) document.getElementById('cartPanelCheckout').addEventListener('click', () => { if (cart.length===0) return alert('El carrito est√° vac√≠o'); alert('Simulaci√≥n de checkout desde panel: ' + cart.reduce((s,i)=>s+(i.qty||0),0) + ' items'); });

  window.addToCart = function(product){
    const existing = cart.find(p => p.id === product.id);
    if (existing) existing.qty = (existing.qty||1) + 1;
    else cart.push({ id: product.id, name: product.name, price: product.price, priceNum: Number(product.priceNum || parsePrice(product.price) || 0), qty:1, image: product.image });
    saveCart(cart);
    updateMiniCartUI();
    updateCartPanel();
    if (miniCart) { miniCart.setAttribute('aria-hidden','false'); miniCart.style.display = 'flex'; try { cartBtn.setAttribute('aria-expanded','true'); } catch(e){} setTimeout(()=>{ if (miniCart) { miniCart.setAttribute('aria-hidden','true'); miniCart.style.display = ''; try { cartBtn.setAttribute('aria-expanded','false'); } catch(e){} } }, 2200); }
    // announce for screen readers
    try { if (announcements) announcements.textContent = `${product.name} a√±adido al carrito.`; } catch(e){}
  };

  updateMiniCartUI();
  updateCartPanel();

  // LANG / I18N (simple)
  const langBtn = document.getElementById('langBtn'), langMenu = document.getElementById('langMenu'), langLabel = document.getElementById('langLabel');
  const translations = {
    es: { "nav.inicio":"Inicio","nav.productos":"Productos","nav.contacto":"Cont√°ctanos","nav.conocenos":"Con√≥cenos","cart.title":"Carrito","cart.clear":"Vaciar","cart.total":"Total:","cart.checkout":"Pagar","btn.add":"A√±adir al carrito","btn.added":"A√±adido","btn.explorar":"Explorar","btn.enviar":"Enviar","theme.toggle":"Cambiar tema","cart.empty":"Tu carrito est√° vac√≠o." },
    en: { "nav.inicio":"Home","nav.productos":"Products","nav.contacto":"Contact","nav.conocenos":"About","cart.title":"Cart","cart.clear":"Clear","cart.total":"Total:","cart.checkout":"Checkout","btn.add":"Add to cart","btn.added":"Added","btn.explorar":"Explore","btn.enviar":"Send","theme.toggle":"Toggle theme","cart.empty":"Your cart is empty." },
    fr: { "nav.inicio":"Accueil","nav.productos":"Produits","nav.contacto":"Contact","nav.conocenos":"√Ä propos","cart.title":"Panier","cart.clear":"Vider","cart.total":"Total:","cart.checkout":"Payer","btn.add":"Ajouter au panier","btn.added":"Ajout√©","btn.explorar":"Explorer","btn.enviar":"Envoyer","theme.toggle":"Changer el th√®me","cart.empty":"Votre panier est vide." }
  };
  let currentLang = localStorage.getItem('lixby_lang') || 'es';
  function getTranslation(key){
    try {
      const map = translations[currentLang] || translations['es'];
      return (map && map[key]) ? map[key] : null;
    } catch(e){ return null; }
  }
  function applyTranslations(lang){
    const map = translations[lang] || translations['es'];
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (key && map && map[key]) el.textContent = map[key];
    });
    document.querySelectorAll('.btn-add').forEach(btn => {
      try { btn.textContent = (map && map['btn.add']) || btn.textContent; } catch(e){}
    });
    const names = { es:'Espa√±ol', en:'English', fr:'Fran√ßais' };
    if (langLabel) langLabel.textContent = names[lang] || names['es'];
    // refresh cart empty message
    updateMiniCartUI();
    updateCartPanel();
  }
  function setLang(l){
    if (!translations[l]) l = 'es';
    currentLang = l;
    try { localStorage.setItem('lixby_lang', l); } catch(e){}
    applyTranslations(l);
  }
  setLang(localStorage.getItem('lixby_lang') || currentLang);

  if (langBtn && langMenu){
    langBtn.addEventListener('click', ()=> {
      const isOpen = langMenu.getAttribute('aria-hidden') === 'false';
      langMenu.setAttribute('aria-hidden', String(!isOpen));
      langMenu.style.display = !isOpen ? 'flex' : 'none';
      langBtn.setAttribute('aria-expanded', String(!isOpen));
    });
    Array.from(langMenu.querySelectorAll('.lang-item')).forEach(btn => btn.addEventListener('click', ()=>{ const lang = btn.getAttribute('data-lang'); setLang(lang); langMenu.setAttribute('aria-hidden','true'); langMenu.style.display='none'; langBtn.setAttribute('aria-expanded','false'); }));    document.addEventListener('click', (e)=> { try { if (!langBtn.contains(e.target) && !langMenu.contains(e.target)) { langMenu.setAttribute('aria-hidden','true'); langMenu.style.display='none'; langBtn.setAttribute('aria-expanded','false'); }} catch(e){} });
  }

  // THEME
  const THEME_KEY = 'lixby_theme';
  const themeToggle = document.getElementById('themeToggle');
  if (localStorage.getItem(THEME_KEY) === 'light') document.documentElement.classList.add('light');
  if (themeToggle) themeToggle.addEventListener('click', ()=>{ const isLight = document.documentElement.classList.toggle('light'); try{ localStorage.setItem(THEME_KEY, isLight ? 'light' : 'dark'); }catch(e){} });

  // ---------- FALLBACK addToCart (si no hay script.js externo) ----------
  document.addEventListener('click', (ev) => {
    const closestFn = ev.target && ev.target.closest ? ev.target.closest.bind(ev.target) : (sel)=> {
      // simple fallback: walk up parents
      let n = ev.target;
      while(n && n.nodeType === 1) {
        if (n.matches && n.matches(sel)) return n;
        n = n.parentElement;
      }
      return null;
    };
    const btn = closestFn('.btn-add');
    if (!btn) return;
    const id = btn.getAttribute('data-id');
    const product = PRODUCTS_BRIEF[id];
    const payload = product ? product : { id: id, name: id, price: '0‚Ç¨', priceNum: 0, image: '' };
    if (typeof window.addToCart === 'function' && window.addToCart !== undefined) {
      window.addToCart(payload);
    } else {
      const existing = cart.find(i => i.id === payload.id);
      if (existing) existing.qty = (existing.qty||1) + 1;
      else cart.push({ id: payload.id, name: payload.name || 'Producto', price: payload.price || '0‚Ç¨', priceNum: payload.priceNum || 0, qty:1, image: payload.image || '' });
      saveCart(cart); updateMiniCartUI(); updateCartPanel();
      try { if (announcements) announcements.textContent = `${payload.name} a√±adido al carrito.`; } catch(e){}
    }
    const original = btn.textContent;
    btn.textContent = (translations[currentLang] && translations[currentLang]['btn.added']) || 'A√±adido';
    setTimeout(()=> btn.textContent = original, 900);
  });

  // ---------- CLICK EN TARJETA: navegar a producto (sin borrar handlers) ----------
  document.addEventListener('click', function(e){
    const closestFn = e.target && e.target.closest ? e.target.closest.bind(e.target) : (sel)=> {
      let n = e.target;
      while(n && n.nodeType === 1) {
        if (n.matches && n.matches(sel)) return n;
        n = n.parentElement;
      }
      return null;
    };
    const card = closestFn('.card');
    if (!card) return;
    if (closestFn('button, a')) return;
    const pid = card.dataset && card.dataset.product;
    if (!pid) return;
    window.location.href = 'producto.html?id=' + encodeURIComponent(pid);
  });

  // ---------- CONTACT: EmailJS lazy-load al enviar ----------
  async function ensureEmailJs(){
    if (window.emailjs && typeof window.emailjs.sendForm === 'function') return;
    await new Promise((res, rej) => {
      const s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js';
      s.crossOrigin = 'anonymous';
      s.onload = res;
      s.onerror = () => rej(new Error('EmailJS load failed'));
      document.head.appendChild(s);
    });
    try { if (window.emailjs && typeof emailjs.init === 'function') emailjs.init('xsKpaFjbRsS95AK3i'); } catch(e){ console.warn('EmailJS init failed', e); }
  }

  (function initContact(){
    const form = document.getElementById('contactForm');
    const sendBtn = document.getElementById('contactSend');
    const successEl = document.getElementById('contactSuccess');
    if (!form) return;
    async function sendEmail(e){
      e.preventDefault();
      const name = document.getElementById('contactName').value.trim();
      const email = document.getElementById('contactEmail').value.trim();
      const message = document.getElementById('contactMessage').value.trim();
      if (!name || !email || !message) { alert('Por favor completa todos los campos.'); return; }
      sendBtn.disabled = true;
      const prev = sendBtn.textContent; sendBtn.textContent = 'Enviando...';
      try {
        await ensureEmailJs();
        if (!window.emailjs || typeof window.emailjs.sendForm !== 'function') {
          throw new Error('EmailJS SDK no disponible');
        }
        await emailjs.sendForm('service_tagcpgm', 'template_l1e0go2', '#contactForm');
        successEl.style.display = 'block';
        form.reset();
        setTimeout(()=> successEl.style.display = 'none', 6000);
      } catch (err) {
        console.error('Error enviando con EmailJS:', err);
        alert('No se pudo enviar el mensaje. Intenta de nuevo m√°s tarde.');
      } finally {
        sendBtn.disabled = false; sendBtn.textContent = prev;
      }
    }
    form.addEventListener('submit', sendEmail);
  })();

  // export for other modules if needed
  window.lixby = window.lixby || {};
  window.lixby.cart = { load: loadCart, save: saveCart, getAll: () => cart };

})();
</script>

<!-- Mejoras: sanitizaci√≥n y accesibilidad del mini-cart (a√±adido, no borra nada) -->
<script>
(function(){
  'use strict';
  const CURRENCY = new Intl.NumberFormat('es-ES',{ style:'currency', currency:'EUR' });

  // 1) Sanitize mini-cart nodes produced by the inline script (prevenir innerHTML XSS)
  const miniCartItems = document.getElementById('miniCartItems');
  if (miniCartItems) {
    const sanitizeNode = (node) => {
      const meta = node.querySelector('.meta');
      if (!meta) return;
      // extraer texto seguro y recomponer elementos
      const nameText = meta.textContent || '';
      const parts = nameText.split('\n').map(s => s.trim()).filter(Boolean);
      const title = document.createElement('div'); title.style.fontWeight = '700'; title.textContent = parts[0] || '';
      const sub = document.createElement('div'); sub.style.color = 'var(--muted)'; sub.textContent = parts.slice(1).join(' ') || '';
      meta.innerHTML = '';
      meta.appendChild(title);
      meta.appendChild(sub);
    };

    const observer = new MutationObserver((muts) => {
      muts.forEach(m => {
        m.addedNodes.forEach(n => {
          if (n.nodeType !== 1) return;
          if (n.classList && n.classList.contains('mini-cart-item')) sanitizeNode(n);
          n.querySelectorAll && n.querySelectorAll('.mini-cart-item').forEach(el => sanitizeNode(el));
        });
      });
    });
    observer.observe(miniCartItems, { childList: true, subtree: true });
  }

  // 2) Mejorar foco y escape (cerrar mini-cart con Esc)
  const cartBtn = document.getElementById('cartBtn');
  const miniCart = document.getElementById('miniCart');
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (miniCart && miniCart.getAttribute('aria-hidden') === 'false') {
        miniCart.setAttribute('aria-hidden','true');
        miniCart.style.display = '';
        cartBtn && cartBtn.setAttribute('aria-expanded','false');
        cartBtn && cartBtn.focus();
      }
    }
  });
  // al abrir, focusar primer control del miniCart (delegado: cuando se haga visible)
  const showObserver = new MutationObserver(() => {
    try {
      if (miniCart && miniCart.getAttribute('aria-hidden') === 'false') {
        const focusable = miniCart.querySelector('button, [tabindex], a, input');
        if (focusable) focusable.focus();
      }
    } catch(e) {}
  });
  if (miniCart) showObserver.observe(miniCart, { attributes: true, attributeFilter: ['aria-hidden'] });

  // 3) Forzar formato monetario en el total del miniCart (si el script original escribe n√∫meros crudos)
  const miniCartTotal = document.getElementById('miniCartTotal');
  if (miniCartTotal) {
    const reformat = () => {
      const raw = miniCartTotal.textContent || '';
      const num = parseFloat(String(raw).replace(/[^\d.-]/g,'')) || 0;
      miniCartTotal.textContent = CURRENCY.format(num);
    };
    // formatear ahora y cada vez que cambie
    reformat();
    const totObs = new MutationObserver(reformat);
    totObs.observe(miniCartTotal, { childList: true, characterData: true, subtree: true });
  }
})();
</script>

<!-- ===== New: lightweight account/auth UI (localStorage-backed demo) ===== -->
<script>
(function(){
  // Demo auth behavior: stores minimal user in localStorage.lixby_user
  const ACCOUNT_KEY = 'lixby_user';
  const SEEN_KEY = 'lixby_seen_auth';
  const guestImg = 'https://ohsobserver.com/wp-content/uploads/2022/12/Guest-user.png';

  const accountContainer = document.getElementById('accountContainer');
  const accountBtn = document.getElementById('accountBtn');
  const authOverlay = document.getElementById('authOverlay');
  const authClose = document.getElementById('authClose');
  const btnAnonymous = document.getElementById('btnAnonymous');
  const btnGoogle = document.getElementById('btnGoogle');
  const btnGithub = document.getElementById('btnGitHub');
  const btnEmailSignIn = document.getElementById('btnEmailSignIn');
  const btnEmailSignUp = document.getElementById('btnEmailSignUp');
  const authEmailInput = document.getElementById('authEmail');
  const authPassInput = document.getElementById('authPass');

  function getLocalUser() {
    try { return JSON.parse(localStorage.getItem(ACCOUNT_KEY)); } catch(e){ return null; }
  }
  function setLocalUser(u) {
    try { localStorage.setItem(ACCOUNT_KEY, JSON.stringify(u)); } catch(e){}
    renderHeaderUser(u);
  }
  function clearLocalUser(){
    try { localStorage.removeItem(ACCOUNT_KEY); } catch(e){}
    renderHeaderUser(null);
  }

  function renderHeaderUser(user){
    // if no user -> show original account button
    const container = accountContainer;
    if (!container) return;
    container.innerHTML = '';
    if (!user) {
      // show 'Cuenta' button
      const btn = document.createElement('button');
      btn.id = 'accountBtn';
      btn.className = 'btn ghost';
      btn.setAttribute('type','button');
      btn.textContent = 'Cuenta';
      btn.addEventListener('click', () => openAuthOverlay());
      container.appendChild(btn);
      return;
    }
    // show avatar + name (click goes to cuenta.html)
    const wrapper = document.createElement('button');
    wrapper.className = 'account-holder-btn';
    wrapper.setAttribute('type','button');
    wrapper.addEventListener('click', () => {
      // go to cuenta.html (or open menu)
      location.href = 'cuenta.html';
    });
    const img = document.createElement('img');
    img.alt = (user.name || 'Usuario') + ' ‚Äî avatar';
    img.src = user.photoURL || guestImg;
    const span = document.createElement('span');
    span.className = 'name';
    span.textContent = user.name || (user.email ? user.email.split('@')[0] : 'Usuario');
    wrapper.appendChild(img);
    wrapper.appendChild(span);
    container.appendChild(wrapper);
  }

  function openAuthOverlay(){
    if (!authOverlay) return;
    authOverlay.style.display = 'block';
    authOverlay.setAttribute('aria-hidden','false');
    // focus first control
    setTimeout(()=> {
      (authEmailInput || document.querySelector('#btnAnonymous')).focus();
    }, 80);
  }
  function closeAuthOverlay(){
    if (!authOverlay) return;
    authOverlay.style.display = 'none';
    authOverlay.setAttribute('aria-hidden','true');
    // mark seen so it doesn't auto-open again
    try { localStorage.setItem(SEEN_KEY, '1'); } catch(e){}
  }

  // Wire initial render
  renderHeaderUser(getLocalUser());

  // Show auth overlay on first visit if no user and not seen
  try {
    const seen = localStorage.getItem(SEEN_KEY);
    const user = getLocalUser();
    if (!user && !seen) {
      // small delay so header paints first
      setTimeout(openAuthOverlay, 700);
    }
  } catch(e){}

  // handlers
  if (authClose) authClose.addEventListener('click', () => { closeAuthOverlay(); });
  if (btnAnonymous) btnAnonymous.addEventListener('click', async () => {
    // prefer appAuth if available
    if (window.appAuth && typeof window.appAuth.signInAnonymously === 'function') {
      try {
        const u = await window.appAuth.signInAnonymously();
        // appAuth.signInAnonymously should update UI via onAuthState; close overlay
        closeAuthOverlay();
        return;
      } catch(e){
        console.warn('appAuth anonymous failed', e);
      }
    }
    const user = { uid: 'guest_' + Date.now(), name: 'Invitado', email: null, photoURL: guestImg, isAnonymous: true };
    setLocalUser(user);
    closeAuthOverlay();
  });

  // Social buttons: prefer window.appAuth, fallback to demo local user (so modal still works)
  if (btnGoogle) btnGoogle.addEventListener('click', async () => {
    if (window.appAuth && typeof window.appAuth.signInWithGoogle === 'function') {
      try {
        await window.appAuth.signInWithGoogle();
        closeAuthOverlay();
        return;
      } catch (err) {
        console.warn('appAuth.google failed', err);
        // continue to fallback demo
      }
    }
    // fallback demo
    const user = { uid: 'google_' + Date.now(), name: 'Usuario Google', email: 'usuario@gmail.com', photoURL: 'https://via.placeholder.com/64x64?text=G' };
    setLocalUser(user); closeAuthOverlay();
  });

  if (btnGithub) btnGithub.addEventListener('click', async () => {
    if (window.appAuth && typeof window.appAuth.signInWithGitHub === 'function') {
      try {
        await window.appAuth.signInWithGitHub();
        closeAuthOverlay();
        return;
      } catch (err) {
        console.warn('appAuth.github failed', err);
        // fallback
      }
    }
    const user = { uid: 'gh_' + Date.now(), name: 'Usuario GH', email: 'usuario@github.com', photoURL: 'https://via.placeholder.com/64x64?text=GH' };
    setLocalUser(user); closeAuthOverlay();
  });

  // Email sign-in / sign-up: prefer appAuth methods if available
  if (btnEmailSignIn) btnEmailSignIn.addEventListener('click', async () => {
    const email = (document.getElementById('authEmail')||{}).value || '';
    const pass = (document.getElementById('authPass')||{}).value || '';
    if (!email || !pass) { alert('Introduce email y contrase√±a'); return; }

    if (window.appAuth && typeof window.appAuth.signInWithEmail === 'function') {
      try {
        await window.appAuth.signInWithEmail(email, pass);
        closeAuthOverlay();
        return;
      } catch (err) {
        console.warn('appAuth.emailSignIn failed', err);
        alert(err && err.message ? err.message : 'Error al iniciar sesi√≥n');
        return;
      }
    }

    // fallback demo
    const name = email ? email.split('@')[0] : 'Usuario';
    const user = { uid: 'email_' + Date.now(), name: name, email: email || null, photoURL: 'https://via.placeholder.com/64x64?text=U' };
    setLocalUser(user); closeAuthOverlay();
  });

  if (btnEmailSignUp) btnEmailSignUp.addEventListener('click', async () => {
    const email = (document.getElementById('authEmail')||{}).value || '';
    const pass = (document.getElementById('authPass')||{}).value || '';
    if (!email || !pass) { alert('Introduce email y contrase√±a'); return; }

    if (window.appAuth && typeof window.appAuth.createUserWithEmail === 'function') {
      try {
        await window.appAuth.createUserWithEmail(email, pass);
        closeAuthOverlay();
        return;
      } catch (err) {
        console.warn('appAuth.emailCreate failed', err);
        alert(err && err.message ? err.message : 'Error al registrarse');
        return;
      }
    }

    // fallback demo
    const name = email ? email.split('@')[0] : 'Nuevo';
    const user = { uid: 'email_' + Date.now(), name: name, email: email || null, photoURL: 'https://via.placeholder.com/64x64?text=N' };
    setLocalUser(user); closeAuthOverlay();
  });

  // allow clicking accountBtn to open auth overlay when unauthenticated
  document.addEventListener('click', (e) => {
    const target = e.target;
    // if original accountBtn exists and was clicked
    if (target && target.id === 'accountBtn') {
      e.preventDefault();
      const user = getLocalUser();
      if (!user) openAuthOverlay();
      else renderHeaderUser(user);
    }
  });

  // If appAuth not present, expose a signOut that clears local storage
  window.lixby = window.lixby || {};
  window.lixby.auth = {
    getUser: getLocalUser,
    signOut: async function(){
      // prefer appAuth signOut
      if (window.appAuth && typeof window.appAuth.signOut === 'function') {
        try { await window.appAuth.signOut(); return; } catch(e){ console.warn('appAuth.signOut failed', e); }
      }
      clearLocalUser();
      try { location.reload(); } catch(e){}
    }
  };

  // react to external auth changes (if some external module updates localStorage)
  window.addEventListener('storage', (e) => {
    if (e.key === ACCOUNT_KEY) {
      try { const u = JSON.parse(e.newValue); renderHeaderUser(u); } catch(e){}
    }
  });

})();
</script>

<!-- Footer: newsletter handling + back-to-top behaviour -->
<script>
(function(){
  const newsForm = document.getElementById('newsletterForm');
  const newsInput = document.getElementById('newsletterEmail');
  const newsBtn = document.getElementById('newsletterBtn');
  const newsMsg = document.getElementById('newsletterMsg');
  const storageKey = 'lixby_news_emails_v1';
  function validEmail(e){ return typeof e === 'string' && e.includes('@') && e.indexOf('.') > e.indexOf('@'); }

  if (newsForm && newsInput && newsBtn) {
    newsForm.addEventListener('submit', (ev) => {
      ev.preventDefault();
      const email = (newsInput.value || '').trim().toLowerCase();
      if (!validEmail(email)) {
        newsMsg.style.color = '#ffb4b4';
        newsMsg.textContent = 'Introduce un correo v√°lido.';
        newsInput.focus();
        return;
      }
      // store locally as demo
      try {
        const arr = JSON.parse(localStorage.getItem(storageKey) || '[]');
        if (!arr.includes(email)) arr.push(email);
        localStorage.setItem(storageKey, JSON.stringify(arr));
      } catch(e){}
      newsMsg.style.color = 'var(--accent)';
      newsMsg.textContent = '¬°Gracias! Ya est√°s suscrito.';
      newsInput.value = '';
      setTimeout(()=> { newsMsg.textContent = ''; }, 5000);
    });
  }

  // Back-to-top
  const back = document.getElementById('backToTop');
  function scrollHandler(){
    if (window.scrollY > 300) back.style.display = 'inline-flex'; else back.style.display = 'none';
  }
  if (back) {
    back.style.display = 'none';
    back.addEventListener('click', (e)=>{
      e.preventDefault();
      window.scrollTo({ top: 0, behavior: 'smooth' });
      setTimeout(()=> document.querySelector('.brand')?.focus(), 600);
    });
    document.addEventListener('scroll', scrollHandler, { passive:true });
    // initial
    scrollHandler();
  }

  // Ensure footer FAQ link navigates correctly (enhanced for analytics/event tracking)
  const footerFaq = document.getElementById('footerFaqLink');
  if (footerFaq) {
    footerFaq.addEventListener('click', (ev) => {
      // keep default anchor behavior but also provide a reliable navigation fallback/respect target
      try {
        const href = footerFaq.getAttribute('href') || 'faq.html';
        // example: could send analytics event here (omitted) then navigate:
        // prevent double navigation when href is same-origin and anchor default will handle it,
        // but to be explicit we use location.assign which keeps history.
        ev.preventDefault();
        // small timeout could be used if doing analytics, but we navigate immediately:
        location.assign(href);
      } catch(e){
        // fallback: do nothing special
      }
    });
  }
})();
</script>

<!-- ===== Soporte: script que maneja attachments, tickets y UI (a√±adido sin borrar nada) ===== -->
<script>
(function(){
  // Config
  const MAX_FILES = 5;
  const MAX_TOTAL_BYTES = 10 * 1024 * 1024; // 10MB
  const STORAGE_KEY = 'lixby_tickets_v1';

  // Elements
  const ticketForm = document.getElementById('ticketForm');
  const inputName = document.getElementById('t-name');
  const inputEmail = document.getElementById('t-email');
  const inputProduct = document.getElementById('t-product');
  const inputDesc = document.getElementById('t-desc');
  const fileInput = document.getElementById('fileInput');
  const dropzone = document.getElementById('dropzone');
  const attachmentsWrap = document.getElementById('attachments');
  const submitBtn = document.getElementById('submitTicket');
  const clearBtn = document.getElementById('clearForm');
  const attachLogBtn = document.getElementById('attachLog');
  const uploadProgressWrap = document.getElementById('uploadProgressWrap');
  const uploadProgressBar = document.getElementById('uploadProgressBar');
  const ticketsList = document.getElementById('ticketsList');
  const ticketSuccess = document.getElementById('ticketSuccess');
  const ticketIdSpan = document.getElementById('ticketId');
  const ticketInfo = document.getElementById('ticketInfo');

  // State: staged files array { file: File, dataUrl: string (optional) }
  let stagedFiles = [];

  // Utils
  function uid() {
    const d = new Date();
    const stamp = d.toISOString().replace(/\D/g,'').slice(0,14);
    const rand = Math.random().toString(36).slice(2,8).toUpperCase();
    return `LX-${stamp}-${rand}`;
  }

  function bytesToSize(bytes) {
    if (bytes === 0) return '0 B';
    const k = 1024, sizes = ['B','KB','MB','GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  function readFileAsDataURL(file) {
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = () => rej(new Error('read error'));
      r.readAsDataURL(file);
    });
  }

  function totalStagedBytes() {
    return stagedFiles.reduce((s, f) => s + (f.file.size || 0), 0);
  }

  function renderAttachments() {
    attachmentsWrap.innerHTML = '';
    if (stagedFiles.length === 0) return;
    stagedFiles.forEach((entry, idx) => {
      const item = document.createElement('div');
      item.className = 'attach-item';
      item.style.display = 'flex';
      item.style.justifyContent = 'space-between';
      item.style.alignItems = 'center';
      item.style.padding = '8px';
      item.style.borderRadius = '8px';
      item.style.background = 'rgba(255,255,255,0.01)';
      const left = document.createElement('div');
      left.style.display = 'flex';
      left.style.flexDirection = 'column';
      const name = document.createElement('div'); name.textContent = entry.file.name; name.style.fontWeight = '700';
      const meta = document.createElement('div'); meta.style.color = 'var(--muted)'; meta.style.fontSize = '0.9rem'; meta.textContent = bytesToSize(entry.file.size);
      left.appendChild(name); left.appendChild(meta);

      const right = document.createElement('div');
      right.style.display = 'flex';
      right.style.gap = '8px';
      const removeBtn = document.createElement('button'); removeBtn.type = 'button'; removeBtn.className = 'btn ghost'; removeBtn.textContent = 'Eliminar';
      removeBtn.addEventListener('click', () => { stagedFiles.splice(idx,1); renderAttachments(); validateAttachMeta(); });
      right.appendChild(removeBtn);

      item.appendChild(left);
      item.appendChild(right);
      attachmentsWrap.appendChild(item);
    });
  }

  function validateAttachMeta() {
    const count = stagedFiles.length;
    const totalBytes = totalStagedBytes();
    ticketInfo.textContent = `${count} archivo(s) ‚Äî ${bytesToSize(totalBytes)} (m√°x 5 archivos, 10MB)`;
    if (count > MAX_FILES) ticketInfo.textContent += ' ‚Äî L√≠mite de archivos excedido';
    if (totalBytes > MAX_TOTAL_BYTES) ticketInfo.textContent += ' ‚Äî Tama√±o total excedido';
    return (count <= MAX_FILES && totalBytes <= MAX_TOTAL_BYTES);
  }

  // Dropzone handlers
  if (dropzone) {
    dropzone.addEventListener('click', () => fileInput.click());
    dropzone.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });

    dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.style.opacity = '0.9'; });
    dropzone.addEventListener('dragleave', (e) => { e.preventDefault(); dropzone.style.opacity = '1'; });
    dropzone.addEventListener('drop', async (e) => {
      e.preventDefault(); dropzone.style.opacity = '1';
      const files = Array.from(e.dataTransfer.files || []);
      await handleNewFiles(files);
    });
  }

  if (fileInput) {
    fileInput.addEventListener('change', async (e) => {
      const files = Array.from(e.target.files || []);
      await handleNewFiles(files);
      fileInput.value = '';
    });
  }

  async function handleNewFiles(files) {
    for (const f of files) {
      if (stagedFiles.length >= MAX_FILES) break;
      stagedFiles.push({ file: f, dataUrl: null });
    }
    renderAttachments();
    validateAttachMeta();
  }

  // Attach log faux file
  if (attachLogBtn) attachLogBtn.addEventListener('click', async () => {
    const logText = [
      `LIXBY device log ‚Äî ${new Date().toISOString()}`,
      'uptime: 12h34m',
      'error: none',
      'network: connected (wifi)'
    ].join('\n');
    const blob = new Blob([logText], { type: 'text/plain' });
    const logFile = new File([blob], `lixby_log_${Date.now()}.log`, { type: 'text/plain' });
    stagedFiles.push({ file: logFile, dataUrl: null });
    renderAttachments();
    validateAttachMeta();
  });

  // Clear form
  if (clearBtn) clearBtn.addEventListener('click', () => {
    ticketForm.reset();
    stagedFiles = [];
    renderAttachments();
    validateAttachMeta();
    ticketSuccess.style.display = 'none';
    ticketIdSpan.textContent = '';
  });

  // Tickets storage & rendering
  function loadTickets() {
    try {
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    } catch (e) { return []; }
  }
  function saveTickets(arr) {
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); } catch(e) { console.warn('save tickets', e); }
  }

  function renderTickets() {
    const arr = loadTickets();
    ticketsList.innerHTML = '';
    if (!arr || arr.length === 0) {
      const empty = document.createElement('div'); empty.style.color = 'var(--muted)'; empty.textContent = 'No tienes tickets abiertos.';
      ticketsList.appendChild(empty); return;
    }
    // show most recent first
    arr.slice().reverse().forEach(t => {
      const card = document.createElement('div');
      card.className = 'ticket-card glass';
      card.style.padding = '12px';
      card.style.borderRadius = '10px';
      card.style.display = 'flex';
      card.style.flexDirection = 'column';
      card.style.gap = '8px';

      const top = document.createElement('div'); top.style.display='flex'; top.style.justifyContent='space-between'; top.style.alignItems='center';
      const leftTitle = document.createElement('div'); leftTitle.style.display='flex'; leftTitle.style.flexDirection='column';
      const title = document.createElement('div'); title.style.fontWeight='800'; title.textContent = `${t.id} ‚Äî ${t.product || 'Sin producto'}`;
      const meta = document.createElement('div'); meta.style.color='var(--muted)'; meta.style.fontSize='0.9rem'; meta.textContent = `${new Date(t.createdAt).toLocaleString()} ‚Äî ${t.status}`;
      leftTitle.appendChild(title); leftTitle.appendChild(meta);

      const actions = document.createElement('div');
      const toggleBtn = document.createElement('button'); toggleBtn.type = 'button'; toggleBtn.className='btn ghost'; toggleBtn.textContent = 'Ver';
      actions.appendChild(toggleBtn);
      top.appendChild(leftTitle); top.appendChild(actions);

      const body = document.createElement('div'); body.style.display='none'; body.style.color='var(--muted)';
      const desc = document.createElement('div'); desc.textContent = t.description;
      body.appendChild(desc);

      if (t.attachments && t.attachments.length) {
        const attWrap = document.createElement('div'); attWrap.style.display='flex'; attWrap.style.flexDirection='column'; attWrap.style.gap='6px';
        attWrap.style.marginTop = '8px';
        t.attachments.forEach(a => {
          const aRow = document.createElement('div'); aRow.style.display='flex'; aRow.style.justifyContent='space-between'; aRow.style.alignItems='center';
          const aLeft = document.createElement('div'); aLeft.textContent = `${a.name} (${bytesToSize(a.size)})`; aLeft.style.color='var(--muted)';
          const aRight = document.createElement('div');
          if (a.dataUrl) {
            const dl = document.createElement('a'); dl.href = a.dataUrl; dl.download = a.name; dl.className = 'btn ghost'; dl.textContent = 'Descargar';
            aRight.appendChild(dl);
          } else {
            const note = document.createElement('span'); note.style.color='var(--muted)'; note.textContent = 'Adjunto (no disponible)';
            aRight.appendChild(note);
          }
          aRow.appendChild(aLeft); aRow.appendChild(aRight); attWrap.appendChild(aRow);
        });
        body.appendChild(attWrap);
      }

      toggleBtn.addEventListener('click', () => {
        body.style.display = body.style.display === 'none' ? 'block' : 'none';
      });

      card.appendChild(top);
      card.appendChild(body);
      ticketsList.appendChild(card);
    });
  }

  // Submit ticket: read files as dataURL (if < limit) and save ticket to localStorage
  if (submitBtn) submitBtn.addEventListener('click', async () => {
    // basic validation
    if (!inputName.value.trim() || !inputEmail.value.trim() || !inputDesc.value.trim()) {
      alert('Completa nombre, email y descripci√≥n.');
      return;
    }
    if (!validateAttachMeta()) {
      alert('Revisa los archivos adjuntos: l√≠mite 5 archivos y 10MB total.');
      return;
    }

    // disable UI
    submitBtn.disabled = true;
    submitBtn.textContent = 'Creando...';
    uploadProgressWrap.style.display = 'block';
    uploadProgressBar.style.width = '6%';

    // read attachments to dataUrl (but if empty skip)
    const attachmentsData = [];
    let processedBytes = 0;
    for (let i = 0; i < stagedFiles.length; i++) {
      const entry = stagedFiles[i];
      try {
        // incremental fake progress
        uploadProgressBar.style.width = `${10 + (i / Math.max(1, stagedFiles.length)) * 60}%`;
        const dataUrl = await readFileAsDataURL(entry.file);
        attachmentsData.push({ name: entry.file.name, size: entry.file.size, type: entry.file.type, dataUrl: dataUrl });
        processedBytes += entry.file.size || 0;
      } catch (e) {
        attachmentsData.push({ name: entry.file.name, size: entry.file.size, type: entry.file.type, dataUrl: null });
      }
    }

    // finalizing progress
    uploadProgressBar.style.width = '92%';
    await new Promise(r => setTimeout(r, 300));

    // create ticket object
    const id = uid();
    const ticket = {
      id,
      name: inputName.value.trim(),
      email: inputEmail.value.trim(),
      product: inputProduct.value || '',
      description: inputDesc.value.trim(),
      attachments: attachmentsData,
      status: 'Abierto',
      createdAt: Date.now()
    };

    const arr = loadTickets();
    arr.push(ticket);
    saveTickets(arr);

    // success UI
    uploadProgressBar.style.width = '100%';
    ticketSuccess.style.display = 'block';
    ticketIdSpan.textContent = id;

    // reset staged files & form (but keep name/email for convenience)
    stagedFiles = [];
    renderAttachments();
    validateAttachMeta();
    inputDesc.value = '';

    // restore button
    submitBtn.disabled = false;
    submitBtn.textContent = 'Enviar ticket';
    setTimeout(()=> { uploadProgressWrap.style.display = 'none'; uploadProgressBar.style.width = '0%'; }, 400);

    // re-render list
    renderTickets();

    // optional: scroll to tickets list
    try { document.getElementById('ticketsList').scrollIntoView({ behavior:'smooth', block:'start' }); } catch(e){}
  });

  // init
  renderTickets();
  validateAttachMeta();

})();
</script>

<!-- tu script principal global (si existe) -->
<script src="script.js" defer></script>

</body>
</html>
