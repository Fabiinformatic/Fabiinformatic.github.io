<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LIXBY — Tecnología minimalista</title>
  <link rel="stylesheet" href="style.css" />
  <!-- small inline fallback styles for header-only overrides (kept minimal) -->
  <style>
    /* keep header fallback small in head so page doesn't flash without CSS file */
    :root{ --header-height:72px }
    body{ padding-top: var(--header-height); }
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="nav glass" role="banner">
    <div class="nav-inner">
      <!-- LEFT: logo -->
      <div class="nav-left">
        <div class="brand" role="button" aria-label="Ir al inicio" onclick="location.href='index.html'">LIXBY</div>
      </div>

      <!-- CENTER: nav links -->
      <nav id="navLinks" role="navigation" aria-label="Principal">
        <a href="#inicio" data-i18n="nav.inicio">Inicio</a>
        <a href="#productos" data-i18n="nav.productos">Productos</a>
        <a href="#contacto" data-i18n="nav.contacto">Contáctanos</a>
        <a href="#conocenos" data-i18n="nav.conocenos">Conócenos</a>
      </nav>

      <!-- RIGHT: controles en fila -->
      <div class="nav-right" aria-hidden="false">
        <!-- carrito (mini) -->
        <div class="cart-wrapper" style="position:relative;">
          <button id="cartBtn" class="icon-btn" aria-label="Ver carrito">🛒 <span id="cartCount" class="badge">0</span></button>

          <div id="miniCart" class="mini-cart glass" aria-hidden="true">
            <div class="mini-cart-header">
              <strong data-i18n="cart.title">Carrito</strong>
              <button id="clearCart" class="text-btn" data-i18n="cart.clear">Vaciar</button>
            </div>

            <div id="miniCartItems" class="mini-cart-items">
              <!-- items dinámicos -->
            </div>

            <div class="mini-cart-footer" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <div><strong data-i18n="cart.total">Total:</strong> <span id="miniCartTotal">0€</span></div>
                <div>
                  <button id="checkoutBtn" class="btn primary" data-i18n="cart.checkout">Pagar</button>
                </div>
              </div>
              <div style="display:flex;gap:8px;">
                <button id="viewCartBtn" class="btn ghost">Ver carrito</button>
              </div>
            </div>
          </div>
        </div>

        <!-- selector idioma -->
        <div class="lang-wrapper">
          <button id="langBtn" class="icon-btn" aria-haspopup="true" aria-expanded="false">
            🇪🇸 <span id="langLabel">Español</span> ▾
          </button>
          <div id="langMenu" class="lang-menu glass" aria-hidden="true">
            <button class="lang-item" data-lang="es">🇪🇸 Español</button>
            <button class="lang-item" data-lang="en">🇬🇧 English</button>
            <button class="lang-item" data-lang="fr">🇫🇷 Français</button>
          </div>
        </div>

        <!-- Account button (opens modal). Replaced by header avatar when logged in -->
        <button id="accountBtn" class="btn ghost" aria-label="Mi cuenta">Cuenta</button>

        <!-- toggle tema -->
        <button id="themeToggle" class="btn ghost" aria-label="Cambiar tema">◐</button>
      </div>
    </div>
  </header>

  <!-- AUTH / WELCOME MODAL -->
  <div id="authOverlay" aria-hidden="true" style="position:fixed;inset:0;z-index:9998;display:none;">
    <div id="authBackdrop"></div>

    <div id="authModal" class="glass" role="dialog" aria-labelledby="authTitle" style="position:relative;max-width:540px;margin:6vh auto;z-index:9999;">
      <h2 id="authTitle">Bienvenido a LIXBY</h2>
      <p>Inicia sesión para acceder a tu cuenta, pedidos y favoritos.</p>

      <div style="display:flex;gap:8px;margin-bottom:12px;">
        <button id="btnGoogle" class="auth-btn ghost" type="button" aria-label="Iniciar con Google">
          <img class="icon" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
          <span>Iniciar con Google</span>
        </button>

        <button id="btnGitHub" class="auth-btn ghost" type="button" aria-label="Iniciar con GitHub">
          <img class="icon" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" style="width:18px;height:18px;">
          <span>Iniciar con GitHub</span>
        </button>
      </div>

      <div style="display:flex;align-items:center;gap:8px;margin:8px 0;color:var(--muted)">
        <hr style="flex:1;border:none;height:1px;background:rgba(0,0,0,0.06)"/>
        <span style="font-size:0.9rem;color:#556">o con correo</span>
        <hr style="flex:1;border:none;height:1px;background:rgba(0,0,0,0.06)"/>
      </div>

      <form id="authEmailForm" style="display:flex;flex-direction:column;gap:8px">
        <input id="authEmail" type="email" placeholder="Correo" required style="padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
        <input id="authPass" type="password" placeholder="Contraseña" required style="padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
        <div style="display:flex;gap:8px;justify-content:space-between;align-items:center">
          <button type="button" id="btnEmailSignIn" class="btn primary">Iniciar sesión</button>
          <button type="button" id="btnEmailSignUp" class="btn ghost">Registrarse</button>
        </div>
      </form>

      <div style="text-align:center;margin-top:12px">
        <button id="btnAnonymous" class="btn ghost">Continuar como invitado</button>
      </div>

      <div style="display:flex;justify-content:center;margin-top:12px;font-size:0.9rem">
        <a id="authToAccount" href="cuenta.html" style="color:#556">Ya tienes cuenta? Ir a mi cuenta</a>
      </div>

      <button id="authClose" aria-label="Cerrar" style="position:absolute;right:12px;top:12px;background:transparent;border:0;font-size:18px">✕</button>
    </div>
  </div>
  <!-- END AUTH MODAL -->

  <main>
    <!-- HERO -->
    <section id="inicio" class="hero reveal" aria-labelledby="hero-title">
      <div class="hero-content">
        <h1 id="hero-title">La tecnología que te entiende</h1>
        <p>Innovación minimalista para tu día a día</p>
        <a href="#productos" class="btn primary" data-i18n="btn.explorar">Explorar</a>
      </div>
    </section>

    <!-- PRODUCTOS -->
    <section id="productos" class="section reveal" aria-labelledby="prod-title">
      <h2 id="prod-title">Productos</h2>
      <div class="grid">
        <!-- Lixby One Air -->
        <article class="card glass" data-product="lixby-one-air" role="button" tabindex="0" aria-label="Lixby One Air">
          <div class="thumb">
            <img src="https://m.media-amazon.com/images/I/61j5RD1d9KL._UF1000,1000_QL80_.jpg" alt="Lixby One Air">
          </div>
          <h3>Lixby One Air</h3>
          <p>Ultraligero y económico.</p>
          <span class="price">249€</span>
          <div class="actions">
            <button class="btn-view" onclick="location.href='producto.html?id=lixby-one-air'">Ver</button>
            <button class="btn-add" data-id="lixby-one-air">Añadir al carrito</button>
          </div>
        </article>

        <!-- Lixby One -->
        <article class="card glass" data-product="lixby-one" role="button" tabindex="0" aria-label="Lixby One">
          <div class="thumb">
            <img src="https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg" alt="Lixby One">
          </div>
          <h3>Lixby One</h3>
          <p>Ultraligero y potente.</p>
          <span class="price">349€</span>
          <div class="actions">
            <button class="btn-view" onclick="location.href='producto.html?id=lixby-one'">Ver</button>
            <button class="btn-add" data-id="lixby-one">Añadir al carrito</button>
          </div>
        </article>

        <!-- Lixby One Pro -->
        <article class="card glass" data-product="lixby-one-pro" role="button" tabindex="0" aria-label="Lixby One Pro">
          <div class="thumb">
            <img src="https://m.media-amazon.com/images/I/61rriyfRKwL.jpg" alt="Lixby One Pro">
          </div>
          <h3>Lixby One Pro</h3>
          <p>Audio de alta fidelidad.</p>
          <span class="price">899€</span>
          <div class="actions">
            <button class="btn-view" onclick="location.href='producto.html?id=lixby-one-pro'">Ver</button>
            <button class="btn-add" data-id="lixby-one-pro">Añadir al carrito</button>
          </div>
        </article>
      </div>
    </section>

    <!-- CONTACTO -->
    <section id="contacto" class="section contact-min glass reveal" aria-labelledby="contact-title">
      <div class="left">
        <h2 id="contact-title">Contáctanos</h2>
        <p class="lead">Déjanos una duda o sugerencias y te responderemos lo antes posible.</p>
      </div>

      <form id="contactForm" class="form" aria-label="Formulario de contacto" onsubmit="return false;">
        <input id="contactName" name="from_name" type="text" placeholder="Nombre" required autocomplete="name">
        <input id="contactEmail" name="from_email" type="email" placeholder="Correo" required autocomplete="email">
        <textarea id="contactMessage" name="message" placeholder="Tu mensaje" required></textarea>

        <div class="actions">
          <button type="button" class="btn ghost" onclick="document.getElementById('contactForm').reset();">Borrar</button>
          <button type="submit" id="contactSend" class="btn primary">Enviar</button>
        </div>

        <div id="contactSuccess" class="contact-success" role="status" aria-live="polite">Mensaje enviado. ¡Gracias! Te contestaremos pronto.</div>
      </form>
    </section>

    <!-- CONÓCENOS -->
    <section id="conocenos" class="section reveal" aria-labelledby="about-title">
      <h2 id="about-title">Conócenos</h2>
      <p>En LIXBY creemos en el equilibrio perfecto entre diseño y funcionalidad. Creamos productos que no solo funcionan, sino que también inspiran.</p>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="footer glass" style="text-align:center;padding:24px;margin-top:40px;">
    <p>© <span id="year"></span> LIXBY — Todos los derechos reservados</p>
  </footer>

  <!-- Cart panel (estático) + backdrop -->
  <div id="cartBackdrop" class="cart-backdrop" aria-hidden="true"></div>
  <aside id="cartPanel" class="cart-panel" aria-hidden="true">
    <div class="cart-panel-inner glass" role="dialog" aria-label="Carrito">
      <div class="cart-header">
        <strong data-i18n="cart.title">Carrito</strong>
        <button id="cartPanelClose" class="text-btn" aria-label="Cerrar">✕</button>
      </div>

      <div id="cartPanelItems" class="cart-list">
        <!-- items dinámicos -->
      </div>

      <div class="cart-footer">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <strong>Total</strong>
          <span id="cartPanelTotal">0€</span>
        </div>
        <div style="display:flex;gap:8px;">
          <button id="cartPanelCheckout" class="btn primary" data-i18n="cart.checkout">Pagar</button>
          <button id="cartPanelClear" class="btn ghost" data-i18n="cart.clear">Vaciar</button>
        </div>
      </div>
    </div>
  </aside>

  <noscript style="display:block;background:#fffb; padding:10px; text-align:center;">
    JavaScript está desactivado o ha ocurrido un error. Si la página no carga correctamente, abre la consola (F12 → Console).
  </noscript>

  <!-- small fallback script -->
  <script>
    (function(){
      function adjustPadding(){
        try {
          const header = document.querySelector('.nav');
          if(!header) return;
          const pad = Math.round(header.getBoundingClientRect().height + 12);
          document.body.style.paddingTop = pad + 'px';
        } catch(e){}
      }
      adjustPadding();
      window.addEventListener('resize', adjustPadding);

      const viewBtn = document.getElementById('viewCartBtn');
      const cartPanel = document.getElementById('cartPanel');
      const cartBackdrop = document.getElementById('cartBackdrop');
      const cartPanelClose = document.getElementById('cartPanelClose');

      function setPanel(open){
        if(!cartPanel || !cartBackdrop) return;
        cartPanel.classList.toggle('open', !!open);
        cartBackdrop.classList.toggle('open', !!open);
        cartPanel.setAttribute('aria-hidden', String(!open));
        cartBackdrop.setAttribute('aria-hidden', String(!open));
      }
      if (viewBtn) viewBtn.addEventListener('click', ()=> setPanel(true));
      if (cartBackdrop) cartBackdrop.addEventListener('click', ()=> setPanel(false));
      if (cartPanelClose) cartPanelClose.addEventListener('click', ()=> setPanel(false));
    })();
  </script>

  <!-- OVERRIDE: cart button redirect -->
  <script>
    (function(){
      function goToCart(e){
        e.preventDefault();
        if (e.stopImmediatePropagation) e.stopImmediatePropagation();
        window.location.href = 'carrito.html';
      }
      const cartBtn = document.getElementById('cartBtn');
      if (cartBtn) cartBtn.addEventListener('click', goToCart, {capture:true});

      const viewBtn = document.getElementById('viewCartBtn');
      if (viewBtn) viewBtn.addEventListener('click', function(e){ e.preventDefault(); if (e.stopImmediatePropagation) e.stopImmediatePropagation(); window.location.href='carrito.html'; }, {capture:true});
    })();
  </script>

  <!-- FALLBACK addToCart -->
  <script>
    (function(){
      const KEY = 'lixby_cart_v1';
      function parsePrice(s){ if (s === undefined || s === null) return 0; return Number(String(s).replace(/[^\d.,-]/g,'').replace(',', '.')) || 0; }
      const PRODUCTS_BRIEF = {
        'lixby-one-air': { id:'lixby-one-air', name: 'Lixby One Air', price: '249€', priceNum: 249, image: 'https://m.media-amazon.com/images/I/61j5RD1d9KL._UF1000,1000_QL80_.jpg' },
        'lixby-one': { id:'lixby-one', name: 'Lixby One', price: '349€', priceNum: 349, image: 'https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg' },
        'lixby-one-pro': { id:'lixby-one-pro', name: 'Lixby One Pro', price: '899€', priceNum: 899, image: 'https://m.media-amazon.com/images/I/61rriyfRKwL.jpg' }
      };

      function fallbackAdd(product){
        try {
          const raw = localStorage.getItem(KEY);
          const cart = raw ? JSON.parse(raw) : [];
          const existing = cart.find(i => i.id === product.id);
          if (existing) existing.qty = (existing.qty||1) + 1;
          else cart.push({
            id: product.id,
            name: product.name || 'Producto',
            price: product.price || (product.priceNum ? (product.priceNum + '€') : '0€'),
            priceNum: product.priceNum !== undefined ? Number(product.priceNum) : parsePrice(product.price),
            qty: 1,
            image: product.image || ''
          });
          localStorage.setItem(KEY, JSON.stringify(cart));
          window.dispatchEvent(new Event('cartUpdated'));
          const mini = document.getElementById('miniCart');
          if (mini) { mini.setAttribute('aria-hidden','false'); setTimeout(()=> mini.setAttribute('aria-hidden','true'), 1800); }
        } catch(e){ console.warn('fallbackAdd error', e); }
      }

      document.addEventListener('click', (ev) => {
        const btn = ev.target.closest && ev.target.closest('.btn-add');
        if (!btn) return;
        const id = btn.getAttribute('data-id');
        const product = PRODUCTS_BRIEF[id];
        const payload = product ? product : { id: id, name: id, price: '0€', priceNum: 0, image: '' };
        if (typeof window.addToCart === 'function' && window.addToCart !== fallbackAdd) {
          window.addToCart(payload);
        } else {
          fallbackAdd(payload);
        }
        btn.textContent = 'Añadido';
        setTimeout(()=> btn.textContent = 'Añadir al carrito', 900);
      });
    })();
  </script>

  <!-- LOAD AUTH MODULE (asegúrate de tener /auth-firebase.js en la raíz) -->
  <script type="module" src="/auth-firebase.js"></script>

  <!-- EMAILJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js" crossorigin="anonymous"
    onload="(function(){ try { if (window.emailjs && typeof emailjs.init === 'function') { emailjs.init('xsKpaFjbRsS95AK3i'); } } catch(e){ console.warn('EmailJS init', e); } })()"></script>

  <!-- contact handler -->
  <script>
    (function(){
      const SERVICE_ID = 'service_tagcpgm';
      const TEMPLATE_ID = 'template_l1e0go2';
      const form = document.getElementById('contactForm');
      const sendBtn = document.getElementById('contactSend');
      const successEl = document.getElementById('contactSuccess');
      if (!form) return;
      async function sendEmail(e){
        e.preventDefault();
        const name = document.getElementById('contactName').value.trim();
        const email = document.getElementById('contactEmail').value.trim();
        const message = document.getElementById('contactMessage').value.trim();
        if (!name || !email || !message) { alert('Por favor completa todos los campos.'); return; }
        sendBtn.disabled = true;
        const previousText = sendBtn.textContent; sendBtn.textContent = 'Enviando...';
        if (!window.emailjs || typeof window.emailjs.sendForm !== 'function') { alert('Servicio de correo no disponible ahora mismo.'); sendBtn.disabled=false; sendBtn.textContent=previousText; return; }
        try {
          await emailjs.sendForm(SERVICE_ID, TEMPLATE_ID, '#contactForm');
          successEl.style.display = 'block';
          form.reset();
          setTimeout(()=> successEl.style.display = 'none', 6000);
        } catch (err) { console.error('EmailJS error', err); alert('No se pudo enviar el mensaje.'); }
        sendBtn.disabled = false; sendBtn.textContent = previousText;
      }
      form.addEventListener('submit', sendEmail);
    })();
  </script>

  <!-- principal (opcional) -->
  <script src="script.js" defer></script>

  <script> try { document.getElementById('year').textContent = new Date().getFullYear(); } catch(e){} </script>
</body>
</html>
