<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LIXBY ‚Äî Tecnolog√≠a minimalista</title>

  <!-- PERF: preconnect para reducir latencia en recursos externos -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://images.weserv.nl" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

  <link rel="stylesheet" href="style.css" />
  <!-- Overrides locales para header y comportamiento consistente -->
  <style>
    /* Header compacto, l√≠nea recta, minimal */
    .nav { position: fixed; top: 0; left: 0; right: 0; z-index: 120; padding: 10px 24px; background: rgba(255,255,255,0.02); backdrop-filter: blur(8px) saturate(120%); -webkit-backdrop-filter: blur(8px) saturate(120%); border-bottom: 1px solid rgba(255,255,255,0.03); border-radius: 0; box-shadow: none; }
    .nav-inner { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 16px; min-height: 64px; padding: 0 6px; }
    .nav-left { display:flex; align-items:center; gap:8px; flex:0 0 auto; }
    #navLinks { display:flex; gap:18px; align-items:center; justify-content:center; flex: 1 1 auto; padding: 8px 12px; white-space: nowrap; }
    .nav-right { display:flex; gap:10px; align-items:center; justify-content:flex-end; flex: 0 0 auto; flex-direction: row !important; }
    .cart-wrapper { position:relative; }
    .mini-cart { right:18px; top:56px; width:320px; box-sizing:border-box; z-index:140; display:none; flex-direction:column; }
    .lang-menu { right:18px; top:56px; box-sizing:border-box; z-index:140; }
    main { padding-top: calc(64px + 12px); }
    .card .actions { display:flex; gap:8px; align-items:center; margin-top:8px; }
    .btn-add { padding:8px 12px; border-radius:8px; border: none; cursor:pointer; background:linear-gradient(180deg,var(--accent), color-mix(in oklab, var(--accent) 60%, #fff 40%)); color:#00121a; font-weight:700; }
    .btn-view { padding:8px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:var(--text); cursor:pointer; }
    .contact-min { max-width: 1100px; margin: 28px auto; padding: 30px; display:flex; gap:24px; align-items:center; justify-content:space-between; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border:1px solid rgba(255,255,255,0.03); box-sizing:border-box; }
    .contact-min .form { flex:0 0 360px; display:flex; flex-direction:column; gap:10px }
    .contact-success { display:none; color:var(--accent); font-weight:600; margin-top:8px }
    #authOverlay { display:none; }
    #authOverlay[aria-hidden="false"] { display:block; }
    #authModal .btn { min-width:120px; }

    /* ligero hover animation global */
    .btn-add, .btn-fav, .icon-btn, .btn { transition: transform .16s cubic-bezier(.2,.9,.3,1), box-shadow .16s ease; }
    .btn-add:hover, .btn-fav:hover, .icon-btn:hover, .btn:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 10px 22px rgba(2,6,12,0.12); }

    /* skip link visible cuando tiene foco */
    .skip-link {
      position: absolute;
      left: 12px;
      top: 8px;
      padding: 8px 12px;
      background: #07101a;
      color: #fff;
      border-radius: 6px;
      z-index: 99999;
      transform: translateY(-120%);
      transition: transform .18s ease;
    }
    .skip-link:focus { transform: translateY(0); }

    /* pantalla oculta para lectores */
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
    @media (max-width:900px){
      .contact-min { flex-direction:column; } .contact-min .form{ width:100% }
    }
  </style>

  <!-- A√±adir: glass util (liquid glass styling consistente) -->
  <style id="lixby-glass-style">
    .glass {
      background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      backdrop-filter: blur(10px) saturate(120%);
      box-shadow: 0 6px 26px rgba(2,6,12,0.48);
      color: inherit;
    }
    .btn, .icon-btn {
      transition: transform .14s cubic-bezier(.2,.9,.3,1), box-shadow .14s ease;
    }
    .btn:focus, .icon-btn:focus, button:focus { outline: 3px solid rgba(10,132,255,0.14); outline-offset: 3px; }
  </style>
</head>
<body>
  <!-- skip link para accesibilidad -->
  <a class="skip-link" href="#maincontent">Saltar al contenido</a>

<!-- NAV -->
<header class="nav glass" role="banner">
  <div class="nav-inner">
    <!-- LEFT: logo -->
    <div class="nav-left">
      <div class="brand" role="button" aria-label="Ir al inicio" onclick="location.href='index.html'">LIXBY</div>
    </div>
    <!-- CENTER: nav links -->
    <nav id="navLinks" role="navigation" aria-label="Principal">
      <a href="#inicio" data-i18n="nav.inicio">Inicio</a>
      <a href="#productos" data-i18n="nav.productos">Productos</a>
      <a href="#contacto" data-i18n="nav.contacto">Cont√°ctanos</a>
      <a href="#conocenos" data-i18n="nav.conocenos">Con√≥cenos</a>
    </nav>
    <!-- RIGHT: controles en fila -->
    <div class="nav-right" aria-hidden="false">
      <div class="cart-wrapper" style="position:relative;">
        <!-- A√±adido aria-controls y aria-expanded para accesibilidad -->
        <button id="cartBtn" class="icon-btn" aria-label="Ver carrito" aria-controls="miniCart" aria-expanded="false" type="button">üõí <span id="cartCount" class="badge">0</span></button>
        <div id="miniCart" class="mini-cart glass" aria-hidden="true" role="region" aria-label="Mini carrito">
          <div class="mini-cart-header" style="display:flex;justify-content:space-between;align-items:center;">
            <strong data-i18n="cart.title">Carrito</strong>
            <button id="clearCart" class="text-btn" data-i18n="cart.clear" type="button">Vaciar</button>
          </div>
          <div id="miniCartItems" class="mini-cart-items" tabindex="0" aria-live="polite" style="max-height:220px;overflow:auto;">
            <!-- items din√°micos -->
          </div>
          <div class="mini-cart-footer" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div><strong data-i18n="cart.total">Total:</strong> <span id="miniCartTotal">0‚Ç¨</span></div>
              <div><button id="checkoutBtn" class="btn primary" data-i18n="cart.checkout" type="button">Pagar</button></div>
            </div>
            <div style="display:flex;gap:8px;"><button id="viewCartBtn" class="btn ghost" type="button">Ver carrito</button></div>
          </div>
        </div>
      </div>

      <div class="lang-wrapper">
        <button id="langBtn" class="icon-btn" aria-haspopup="true" aria-expanded="false" type="button"> üá™üá∏ <span id="langLabel">Espa√±ol</span> ‚ñæ </button>
        <div id="langMenu" class="lang-menu glass" aria-hidden="true" style="display:none;flex-direction:column;gap:6px;padding:8px;width:160px;">
          <button class="lang-item" data-lang="es" type="button">üá™üá∏ Espa√±ol</button>
          <button class="lang-item" data-lang="en" type="button">üá¨üáß English</button>
          <button class="lang-item" data-lang="fr" type="button">üá´üá∑ Fran√ßais</button>
        </div>
      </div>

      <button id="accountBtn" class="btn ghost" aria-label="Mi cuenta" type="button">Cuenta</button>
      <button id="themeToggle" class="btn ghost" aria-label="Cambiar tema" type="button">‚óê</button>
    </div>
  </div>
</header>

<!-- AUTH / WELCOME MODAL (mantengo tu HTML, sin borrar) -->
<div id="authOverlay" aria-hidden="true" style="position:fixed;inset:0;z-index:9998;display:none;">
  <div id="authBackdrop" style="position:absolute;inset:0;background:rgba(0,0,0,0.45);backdrop-filter:blur(4px)"></div>
  <div id="authModal" class="glass" role="dialog" aria-labelledby="authTitle" style="position:relative;max-width:540px;margin:6vh auto;padding:22px;border-radius:12px;z-index:9999;">
    <h2 id="authTitle" style="margin:0 0 8px">Bienvenido a LIXBY</h2>
    <p style="margin:0 0 18px;color:var(--muted)">Inicia sesi√≥n para acceder a tu cuenta, pedidos y favoritos.</p>
    <div style="display:flex;gap:8px;margin-bottom:12px;">
      <button id="btnGoogle" class="btn ghost" style="flex:1" type="button">Iniciar con Google</button>
      <button id="btnGitHub" class="btn ghost" style="flex:1" type="button">Iniciar con GitHub</button>
    </div>
    <div style="display:flex;align-items:center;gap:8px;margin:8px 0;color:var(--muted)">
      <hr style="flex:1;border:none;height:1px;background:rgba(255,255,255,0.04)"/>
      <span style="font-size:0.9rem">o con correo</span>
      <hr style="flex:1;border:none;height:1px;background:rgba(255,255,255,0.04)"/>
    </div>
    <form id="authEmailForm" style="display:flex;flex-direction:column;gap:8px" onsubmit="return false;">
      <input id="authEmail" type="email" placeholder="Correo" required style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)"/>
      <input id="authPass" type="password" placeholder="Contrase√±a" required style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)"/>
      <div style="display:flex;gap:8px;justify-content:space-between;align-items:center">
        <button type="button" id="btnEmailSignIn" class="btn primary">Iniciar sesi√≥n</button>
        <button type="button" id="btnEmailSignUp" class="btn ghost">Registrarse</button>
      </div>
    </form>
    <div style="text-align:center;margin-top:12px">
      <button id="btnAnonymous" class="btn ghost" type="button">Continuar como invitado</button>
    </div>
    <div style="display:flex;justify-content:center;margin-top:12px;font-size:0.9rem">
      <a id="authToAccount" href="cuenta.html" style="color:var(--muted)">Ya tienes cuenta? Ir a mi cuenta</a>
    </div>
    <button id="authClose" aria-label="Cerrar" style="position:absolute;right:12px;top:12px;background:transparent;border:0;font-size:18px" type="button">‚úï</button>
  </div>
</div>
<!-- END AUTH -->

<main id="maincontent">
  <!-- HERO -->
  <section id="inicio" class="hero reveal" aria-labelledby="hero-title">
    <div class="hero-content">
      <h1 id="hero-title">La tecnolog√≠a que te entiende</h1>
      <p>Innovaci√≥n minimalista para tu d√≠a a d√≠a</p>
      <a href="#productos" class="btn primary" data-i18n="btn.explorar">Explorar</a>
    </div>
  </section>

  <!-- PRODUCTOS -->
  <section id="productos" class="section reveal" aria-labelledby="prod-title">
    <h2 id="prod-title">Productos</h2>
    <div class="grid">
      <!-- Lixby One Air -->
      <article class="card glass" data-product="lixby-one-air" role="button" tabindex="0" aria-label="Lixby One Air">
        <div class="thumb">
          <!-- mantuvimos loading lazy y dimensiones -->
          <img src="https://m.media-amazon.com/images/I/61j5RD1d9KL._UF1000,1000_QL80_.jpg" alt="Lixby One Air"
               loading="lazy" decoding="async" width="600" height="600">
        </div>
        <h3>Lixby One Air</h3>
        <p>Ultraligero y econ√≥mico.</p>
        <span class="price">249‚Ç¨</span>
        <div class="actions">
          <button class="btn-view" onclick="location.href='producto.html?id=lixby-one-air'" type="button">Ver</button>
          <button class="btn-add" data-id="lixby-one-air" type="button">A√±adir al carrito</button>
        </div>
      </article>

      <!-- Lixby One -->
      <article class="card glass" data-product="lixby-one" role="button" tabindex="0" aria-label="Lixby One">
        <div class="thumb">
          <img src="https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg" alt="Lixby One"
               loading="lazy" decoding="async" width="600" height="600">
        </div>
        <h3>Lixby One</h3>
        <p>Ultraligero y potente.</p>
        <span class="price">349‚Ç¨</span>
        <div class="actions">
          <button class="btn-view" onclick="location.href='producto.html?id=lixby-one'" type="button">Ver</button>
          <button class="btn-add" data-id="lixby-one" type="button">A√±adir al carrito</button>
        </div>
      </article>

      <!-- Lixby One Pro -->
      <article class="card glass" data-product="lixby-one-pro" role="button" tabindex="0" aria-label="Lixby One Pro">
        <div class="thumb">
          <img src="https://m.media-amazon.com/images/I/61rriyfRKwL.jpg" alt="Lixby One Pro"
               loading="lazy" decoding="async" width="600" height="600">
        </div>
        <h3>Lixby One Pro</h3>
        <p>Audio de alta fidelidad.</p>
        <span class="price">899‚Ç¨</span>
        <div class="actions">
          <button class="btn-view" onclick="location.href='producto.html?id=lixby-one-pro'" type="button">Ver</button>
          <button class="btn-add" data-id="lixby-one-pro" type="button">A√±adir al carrito</button>
        </div>
      </article>
    </div>
  </section>

  <!-- CONTACTO -->
  <section id="contacto" class="section contact-min glass reveal" aria-labelledby="contact-title">
    <div class="left">
      <h2 id="contact-title">Cont√°ctanos</h2>
      <p class="lead">D√©janos una duda o sugerencias y te responderemos lo antes posible.</p>
    </div>

    <form id="contactForm" class="form" aria-label="Formulario de contacto" onsubmit="return false;">
      <input id="contactName" name="from_name" type="text" placeholder="Nombre" required autocomplete="name">
      <input id="contactEmail" name="from_email" type="email" placeholder="Correo" required autocomplete="email">
      <textarea id="contactMessage" name="message" placeholder="Tu mensaje" required></textarea>
      <div class="actions">
        <button type="button" class="btn ghost" onclick="document.getElementById('contactForm').reset();">Borrar</button>
        <button type="submit" id="contactSend" class="btn primary">Enviar</button>
      </div>
      <div id="contactSuccess" class="contact-success" role="status" aria-live="polite">Mensaje enviado. ¬°Gracias! Te contestaremos pronto.</div>
    </form>
  </section>

  <!-- CON√ìCENOS -->
  <section id="conocenos" class="section reveal" aria-labelledby="about-title">
    <h2 id="about-title">Con√≥cenos</h2>
    <p>En LIXBY creemos en el equilibrio perfecto entre dise√±o y funcionalidad. Creamos productos que no solo funcionan, sino que tambi√©n inspiran.</p>
  </section>
</main>

<!-- debug (oculto a usuarios, √∫til para showDebug) -->
<div id="debug" style="display:none;max-width:1100px;margin:12px auto;color:var(--muted);white-space:pre-wrap;"></div>

<footer class="footer glass" style="text-align:center;padding:24px;margin-top:40px;">
  <p>¬© <span id="year"></span> LIXBY ‚Äî Todos los derechos reservados</p>
</footer>

<!-- Cart panel (est√°tico) + backdrop -->
<div id="cartBackdrop" class="cart-backdrop" aria-hidden="true"></div>
<aside id="cartPanel" class="cart-panel" aria-hidden="true">
  <div class="cart-panel-inner glass" role="dialog" aria-label="Carrito">
    <div class="cart-header" style="display:flex;justify-content:space-between;align-items:center;">
      <strong data-i18n="cart.title">Carrito</strong>
      <button id="cartPanelClose" class="text-btn" aria-label="Cerrar" type="button">‚úï</button>
    </div>
    <div id="cartPanelItems" class="cart-list" style="max-height:60vh;overflow:auto;padding:12px"></div>
    <div class="cart-footer" style="padding:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <strong>Total</strong>
        <span id="cartPanelTotal">0‚Ç¨</span>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button id="cartPanelCheckout" class="btn primary" data-i18n="cart.checkout" type="button">Pagar</button>
        <button id="cartPanelClear" class="btn ghost" data-i18n="cart.clear" type="button">Vaciar</button>
      </div>
    </div>
  </div>
</aside>

<!-- Live region for screen-reader announcements (used when adding to cart, etc.) -->
<div id="announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<noscript style="display:block;background:#fffb; padding:10px; text-align:center;">
  JavaScript est√° desactivado o ha ocurrido un error. Si la p√°gina no carga correctamente, abre la consola (F12 ‚Üí Console).
</noscript>

<!-- ===========================
     SCRIPTS (todo inline para que copies directo)
     =========================== -->
<script>
(function(){
  // -------------------------
  // Helpers y estado
  // -------------------------
  const KEY = 'lixby_cart_v1';
  // Formateador consistente (es-ES)
  const CURRENCY = new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' });

  function parsePrice(s){ if (s === undefined || s === null) return 0; return Number(String(s).replace(/[^\d.,-]/g,'').replace(',', '.')) || 0; }
  function saveCart(c){ try { localStorage.setItem(KEY, JSON.stringify(c)); } catch(e){} }
  function loadCart(){ try { return JSON.parse(localStorage.getItem(KEY))||[]; } catch(e){ return []; } }
  function formatPriceNum(num){ return CURRENCY.format(Number(num) || 0); }
  function showDebug(msg){ const el=document.getElementById('debug'); if(!el) return; el.style.display='block'; el.textContent += msg + "\n"; console.log('DEBUG',msg); }

  // performance: proxiedUrl (menor tama√±o)
  function proxiedUrl(originalUrl){
    if (!originalUrl) return '';
    const stripped = String(originalUrl).replace(/^https?:\/\//,'');
    return `https://images.weserv.nl/?url=${encodeURIComponent(stripped)}&w=900&q=80`;
  }

  // set year
  try { document.getElementById('year').textContent = new Date().getFullYear(); } catch(e){}

  // product brief (igual que antes)
  const PRODUCTS_BRIEF = {
    'lixby-one-air': { id:'lixby-one-air', name: 'Lixby One Air', price: '249‚Ç¨', priceNum: 249, image: 'https://m.media-amazon.com/images/I/61j5RD1d9KL._UF1000,1000_QL80_.jpg' },
    'lixby-one': { id:'lixby-one', name: 'Lixby One', price: '349‚Ç¨', priceNum: 349, image: 'https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg' },
    'lixby-one-pro': { id:'lixby-one-pro', name: 'Lixby One Pro', price: '899‚Ç¨', priceNum: 899, image: 'https://m.media-amazon.com/images/I/61rriyfRKwL.jpg' }
  };

  // CART
  let cart = loadCart();
  const cartBtn = document.getElementById('cartBtn');
  const miniCart = document.getElementById('miniCart');
  const miniCartItems = document.getElementById('miniCartItems');
  const miniCartTotal = document.getElementById('miniCartTotal');
  const cartCount = document.getElementById('cartCount');
  const clearCartBtn = document.getElementById('clearCart');
  const checkoutBtn = document.getElementById('checkoutBtn');
  const announcements = document.getElementById('announcements');

  function updateMiniCartUI(){
    if (!cartCount) return;
    const totalQty = cart.reduce((s,i)=>s+(i.qty||0),0);
    cartCount.textContent = totalQty;
    if (!miniCartItems) return;
    miniCartItems.innerHTML = '';
    if (cart.length === 0) {
      miniCartItems.innerHTML = '<div style="padding:8px;color:var(--muted)">Tu carrito est√° vac√≠o.</div>';
      if (miniCartTotal) miniCartTotal.textContent = formatPriceNum(0);
      return;
    }
    let total = 0;
    // fragment para menor reflow
    const frag = document.createDocumentFragment();
    cart.forEach((it, idx) => {
      const item = document.createElement('div');
      item.className = 'mini-cart-item';
      item.style.display = 'flex'; item.style.gap='10px'; item.style.alignItems='center'; item.style.padding='8px'; item.style.borderRadius='8px';
      const img = document.createElement('img'); img.src = it.image || 'https://via.placeholder.com/80x80?text=Img'; img.alt = it.name; img.style.width='44px'; img.style.height='44px'; img.style.objectFit='cover'; img.style.borderRadius='6px';
      img.loading='lazy'; img.decoding='async';
      const meta = document.createElement('div'); meta.className='meta';
      // RENDER SEGURO: no usar innerHTML con contenido din√°mico
      const title = document.createElement('div'); title.style.fontWeight = '700'; title.textContent = it.name || '';
      const subtitle = document.createElement('div'); subtitle.style.color = 'var(--muted)'; subtitle.textContent = `${formatPriceNum(it.priceNum || parsePrice(it.price))} √ó ${it.qty||1}`;
      meta.appendChild(title); meta.appendChild(subtitle);

      const remove = document.createElement('button'); remove.className='remove'; remove.textContent='‚úï'; remove.style.background='transparent'; remove.style.border='none'; remove.style.cursor='pointer';
      remove.setAttribute('type','button');
      remove.addEventListener('click', (e)=>{ e.stopPropagation(); cart.splice(idx,1); saveCart(cart); updateMiniCartUI(); });
      item.appendChild(img); item.appendChild(meta); item.appendChild(remove);
      frag.appendChild(item);
      total += (it.priceNum || parsePrice(it.price)) * (it.qty||1);
    });
    miniCartItems.appendChild(frag);
    if (miniCartTotal) miniCartTotal.textContent = formatPriceNum(total);
  }

  // ensure miniCart style reflects aria-hidden initially
  if (miniCart) {
    if (miniCart.getAttribute('aria-hidden') === 'false') miniCart.style.display = 'flex';
    else miniCart.style.display = '';
  }

  if (cartBtn && miniCart) {
    cartBtn.addEventListener('click', (e) => {
      const shown = miniCart.getAttribute('aria-hidden') === 'false';
      const newState = !shown;
      miniCart.setAttribute('aria-hidden', String(!shown));
      try { cartBtn.setAttribute('aria-expanded', String(newState)); } catch(e){}
      // ensure visible/hidden visually
      if (newState) miniCart.style.display = 'flex';
      else miniCart.style.display = '';
    });
    document.addEventListener('click', (e) => {
      try {
        if (!cartBtn.contains(e.target) && !miniCart.contains(e.target)) {
          miniCart.setAttribute('aria-hidden','true');
          miniCart.style.display = '';
          try { cartBtn.setAttribute('aria-expanded', 'false'); } catch(e){}
        }
      } catch(e){}
    });
  }
  if (clearCartBtn) clearCartBtn.addEventListener('click', () => { cart=[]; saveCart(cart); updateMiniCartUI(); });
  if (checkoutBtn) checkoutBtn.addEventListener('click', () => { if (cart.length===0) return alert('El carrito est√° vac√≠o'); alert('Simulaci√≥n de checkout: ' + cart.reduce((s,i)=>s+(i.qty||0),0) + ' items'); });

  window.addToCart = function(product){
    const existing = cart.find(p => p.id === product.id);
    if (existing) existing.qty = (existing.qty||1) + 1;
    else cart.push({ id: product.id, name: product.name, price: product.price, priceNum: Number(product.priceNum || parsePrice(product.price) || 0), qty:1, image: product.image });
    saveCart(cart);
    updateMiniCartUI();
    if (miniCart) { miniCart.setAttribute('aria-hidden','false'); miniCart.style.display = 'flex'; try { cartBtn.setAttribute('aria-expanded','true'); } catch(e){} setTimeout(()=>{ if (miniCart) { miniCart.setAttribute('aria-hidden','true'); miniCart.style.display = ''; try { cartBtn.setAttribute('aria-expanded','false'); } catch(e){} } }, 2200); }
    // announce for screen readers
    try { if (announcements) announcements.textContent = `${product.name} a√±adido al carrito.`; } catch(e){}
  };

  updateMiniCartUI();

  // LANG / I18N (simple)
  const langBtn = document.getElementById('langBtn'), langMenu = document.getElementById('langMenu'), langLabel = document.getElementById('langLabel');
  const translations = {
    es: { "nav.inicio":"Inicio","nav.productos":"Productos","nav.contacto":"Cont√°ctanos","nav.conocenos":"Con√≥cenos","cart.title":"Carrito","cart.clear":"Vaciar","cart.total":"Total:","cart.checkout":"Pagar","btn.add":"A√±adir al carrito","btn.added":"A√±adido","btn.explorar":"Explorar","btn.enviar":"Enviar","theme.toggle":"Cambiar tema","cart.empty":"Tu carrito est√° vac√≠o." },
    en: { "nav.inicio":"Home","nav.productos":"Products","nav.contacto":"Contact","nav.conocenos":"About","cart.title":"Cart","cart.clear":"Clear","cart.total":"Total:","cart.checkout":"Checkout","btn.add":"Add to cart","btn.added":"Added","btn.explorar":"Explore","btn.enviar":"Send","theme.toggle":"Toggle theme","cart.empty":"Your cart is empty." },
    fr: { "nav.inicio":"Accueil","nav.productos":"Produits","nav.contacto":"Contact","nav.conocenos":"√Ä propos","cart.title":"Panier","cart.clear":"Vider","cart.total":"Total:","cart.checkout":"Payer","btn.add":"Ajouter au panier","btn.added":"Ajout√©","btn.explorar":"Explorer","btn.enviar":"Envoyer","theme.toggle":"Changer el th√®me","cart.empty":"Votre panier est vide." }
  };
  let currentLang = localStorage.getItem('lixby_lang') || 'es';
  function applyTranslations(lang){
    const map = translations[lang] || translations['es'];
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (key && map && map[key]) el.textContent = map[key];
    });
    document.querySelectorAll('.btn-add').forEach(btn => {
      try { btn.textContent = (map && map['btn.add']) || btn.textContent; } catch(e){}
    });
    const names = { es:'Espa√±ol', en:'English', fr:'Fran√ßais' };
    if (langLabel) langLabel.textContent = names[lang] || names['es'];
  }
  function setLang(l){
    if (!translations[l]) l = 'es';
    currentLang = l;
    try { localStorage.setItem('lixby_lang', l); } catch(e){}
    applyTranslations(l);
  }
  setLang(localStorage.getItem('lixby_lang') || currentLang);

  if (langBtn && langMenu){
    langBtn.addEventListener('click', ()=> {
      const isOpen = langMenu.getAttribute('aria-hidden') === 'false';
      langMenu.setAttribute('aria-hidden', String(!isOpen));
      langMenu.style.display = !isOpen ? 'flex' : 'none';
      langBtn.setAttribute('aria-expanded', String(!isOpen));
    });
    Array.from(langMenu.querySelectorAll('.lang-item')).forEach(btn => btn.addEventListener('click', ()=>{ const lang = btn.getAttribute('data-lang'); setLang(lang); langMenu.setAttribute('aria-hidden','true'); langMenu.style.display='none'; langBtn.setAttribute('aria-expanded','false'); }));
    document.addEventListener('click', (e)=> { try { if (!langBtn.contains(e.target) && !langMenu.contains(e.target)) { langMenu.setAttribute('aria-hidden','true'); langMenu.style.display='none'; langBtn.setAttribute('aria-expanded','false'); }} catch(e){} });
  }

  // THEME
  const THEME_KEY = 'lixby_theme';
  const themeToggle = document.getElementById('themeToggle');
  if (localStorage.getItem(THEME_KEY) === 'light') document.documentElement.classList.add('light');
  if (themeToggle) themeToggle.addEventListener('click', ()=>{ const isLight = document.documentElement.classList.toggle('light'); try{ localStorage.setItem(THEME_KEY, isLight ? 'light' : 'dark'); }catch(e){} });

  // ---------- FALLBACK addToCart (si no hay script.js externo) ----------
  document.addEventListener('click', (ev) => {
    const closestFn = ev.target && ev.target.closest ? ev.target.closest.bind(ev.target) : (sel)=> {
      // simple fallback: walk up parents
      let n = ev.target;
      while(n && n.nodeType === 1) {
        if (n.matches && n.matches(sel)) return n;
        n = n.parentElement;
      }
      return null;
    };
    const btn = closestFn('.btn-add');
    if (!btn) return;
    const id = btn.getAttribute('data-id');
    const product = PRODUCTS_BRIEF[id];
    const payload = product ? product : { id: id, name: id, price: '0‚Ç¨', priceNum: 0, image: '' };
    if (typeof window.addToCart === 'function' && window.addToCart !== undefined) {
      window.addToCart(payload);
    } else {
      const existing = cart.find(i => i.id === payload.id);
      if (existing) existing.qty = (existing.qty||1) + 1;
      else cart.push({ id: payload.id, name: payload.name || 'Producto', price: payload.price || '0‚Ç¨', priceNum: payload.priceNum || 0, qty:1, image: payload.image || '' });
      saveCart(cart); updateMiniCartUI();
      try { if (announcements) announcements.textContent = `${payload.name} a√±adido al carrito.`; } catch(e){}
    }
    const original = btn.textContent;
    btn.textContent = (translations[currentLang] && translations[currentLang]['btn.added']) || 'A√±adido';
    setTimeout(()=> btn.textContent = original, 900);
  });

  // ---------- CLICK EN TARJETA: navegar a producto (sin borrar handlers) ----------
  document.addEventListener('click', function(e){
    const closestFn = e.target && e.target.closest ? e.target.closest.bind(e.target) : (sel)=> {
      let n = e.target;
      while(n && n.nodeType === 1) {
        if (n.matches && n.matches(sel)) return n;
        n = n.parentElement;
      }
      return null;
    };
    const card = closestFn('.card');
    if (!card) return;
    if (closestFn('button, a')) return;
    const pid = card.dataset && card.dataset.product;
    if (!pid) return;
    window.location.href = 'producto.html?id=' + encodeURIComponent(pid);
  });

  // ---------- CONTACT: EmailJS lazy-load al enviar ----------
  async function ensureEmailJs(){
    if (window.emailjs && typeof window.emailjs.sendForm === 'function') return;
    await new Promise((res, rej) => {
      const s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js';
      s.crossOrigin = 'anonymous';
      s.onload = res;
      s.onerror = () => rej(new Error('EmailJS load failed'));
      document.head.appendChild(s);
    });
    try { if (window.emailjs && typeof emailjs.init === 'function') emailjs.init('xsKpaFjbRsS95AK3i'); } catch(e){ console.warn('EmailJS init failed', e); }
  }

  (function initContact(){
    const form = document.getElementById('contactForm');
    const sendBtn = document.getElementById('contactSend');
    const successEl = document.getElementById('contactSuccess');
    if (!form) return;
    async function sendEmail(e){
      e.preventDefault();
      const name = document.getElementById('contactName').value.trim();
      const email = document.getElementById('contactEmail').value.trim();
      const message = document.getElementById('contactMessage').value.trim();
      if (!name || !email || !message) { alert('Por favor completa todos los campos.'); return; }
      sendBtn.disabled = true;
      const prev = sendBtn.textContent; sendBtn.textContent = 'Enviando...';
      try {
        await ensureEmailJs();
        if (!window.emailjs || typeof window.emailjs.sendForm !== 'function') {
          throw new Error('EmailJS SDK no disponible');
        }
        await emailjs.sendForm('service_tagcpgm', 'template_l1e0go2', '#contactForm');
        successEl.style.display = 'block';
        form.reset();
        setTimeout(()=> successEl.style.display = 'none', 6000);
      } catch (err) {
        console.error('Error enviando con EmailJS:', err);
        alert('No se pudo enviar el mensaje. Intenta de nuevo m√°s tarde.');
      } finally {
        sendBtn.disabled = false; sendBtn.textContent = prev;
      }
    }
    form.addEventListener('submit', sendEmail);
  })();

  // small fallback panel toggle
  (function panelToggle(){
    const viewBtn = document.getElementById('viewCartBtn');
    const cartPanel = document.getElementById('cartPanel');
    const cartBackdrop = document.getElementById('cartBackdrop');
    const cartPanelClose = document.getElementById('cartPanelClose');
    function setPanel(open){
      if(!cartPanel || !cartBackdrop) return;
      cartPanel.classList.toggle('open', !!open);
      cartBackdrop.classList.toggle('open', !!open);
      cartPanel.setAttribute('aria-hidden', String(!open));
      cartBackdrop.setAttribute('aria-hidden', String(!open));
    }
    if (viewBtn) viewBtn.addEventListener('click', ()=> setPanel(true));
    if (cartBackdrop) cartBackdrop.addEventListener('click', ()=> setPanel(false));
    if (cartPanelClose) cartPanelClose.addEventListener('click', ()=> setPanel(false));
  })();

  // ---- A√ëADIDO: hacer que "Ver carrito" lleve a carrito.html sin borrar el bot√≥n original ----
  (function enableViewCartNavigation(){
    try {
      const orig = document.getElementById('viewCartBtn');
      if (!orig) return;
      // Si ya es un enlace <a>, no tocar
      if (orig.tagName.toLowerCase() === 'a') return;
      // clonamos sin listeners
      const clone = orig.cloneNode(true);
      if (!clone.hasAttribute('type')) clone.setAttribute('type','button');
      clone.addEventListener('click', (e) => {
        window.location.href = 'carrito.html';
      });
      orig.parentNode.replaceChild(clone, orig);
    } catch (err) {
      console.warn('No se pudo habilitar navegaci√≥n a carrito:', err);
    }
  })();

  // export for other modules if needed
  window.lixby = window.lixby || {};
  window.lixby.cart = { load: loadCart, save: saveCart, getAll: () => cart };

})();
</script>

<!-- Mejoras: sanitizaci√≥n y accesibilidad del mini-cart (a√±adido, no borra nada) -->
<script>
(function(){
  'use strict';
  const CURRENCY = new Intl.NumberFormat('es-ES',{ style:'currency', currency:'EUR' });

  // 1) Sanitize mini-cart nodes produced by the inline script (prevenir innerHTML XSS)
  const miniCartItems = document.getElementById('miniCartItems');
  if (miniCartItems) {
    const sanitizeNode = (node) => {
      const meta = node.querySelector('.meta');
      if (!meta) return;
      // extraer texto seguro y recomponer elementos
      const nameText = meta.textContent || '';
      const parts = nameText.split('\n').map(s => s.trim()).filter(Boolean);
      const title = document.createElement('div'); title.style.fontWeight = '700'; title.textContent = parts[0] || '';
      const sub = document.createElement('div'); sub.style.color = 'var(--muted)'; sub.textContent = parts.slice(1).join(' ') || '';
      meta.innerHTML = '';
      meta.appendChild(title);
      meta.appendChild(sub);
    };

    const observer = new MutationObserver((muts) => {
      muts.forEach(m => {
        m.addedNodes.forEach(n => {
          if (n.nodeType !== 1) return;
          if (n.classList && n.classList.contains('mini-cart-item')) sanitizeNode(n);
          n.querySelectorAll && n.querySelectorAll('.mini-cart-item').forEach(el => sanitizeNode(el));
        });
      });
    });
    observer.observe(miniCartItems, { childList: true, subtree: true });
  }

  // 2) Mejorar foco y escape (cerrar mini-cart con Esc)
  const cartBtn = document.getElementById('cartBtn');
  const miniCart = document.getElementById('miniCart');
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (miniCart && miniCart.getAttribute('aria-hidden') === 'false') {
        miniCart.setAttribute('aria-hidden','true');
        miniCart.style.display = '';
        cartBtn && cartBtn.setAttribute('aria-expanded','false');
        cartBtn && cartBtn.focus();
      }
    }
  });
  // al abrir, focusar primer control del miniCart (delegado: cuando se haga visible)
  const showObserver = new MutationObserver(() => {
    try {
      if (miniCart && miniCart.getAttribute('aria-hidden') === 'false') {
        const focusable = miniCart.querySelector('button, [tabindex], a, input');
        if (focusable) focusable.focus();
      }
    } catch(e) {}
  });
  if (miniCart) showObserver.observe(miniCart, { attributes: true, attributeFilter: ['aria-hidden'] });

  // 3) Forzar formato monetario en el total del miniCart (si el script original escribe n√∫meros crudos)
  const miniCartTotal = document.getElementById('miniCartTotal');
  if (miniCartTotal) {
    const reformat = () => {
      const raw = miniCartTotal.textContent || '';
      const num = parseFloat(String(raw).replace(/[^\d.-]/g,'')) || 0;
      miniCartTotal.textContent = CURRENCY.format(num);
    };
    // formatear ahora y cada vez que cambie
    reformat();
    const totObs = new MutationObserver(reformat);
    totObs.observe(miniCartTotal, { childList: true, characterData: true, subtree: true });
  }
})();
</script>

<!-- tu script principal global (hover preview, account behavior, etc.) -->
<script src="script.js" defer></script>

</body>
</html>
