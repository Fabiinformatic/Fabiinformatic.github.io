<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="meta.title">LIXBY — Tecnología minimalista</title>

  <!-- PERF: preconnect para reducir latencia en recursos externos -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://images.weserv.nl" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

  <link rel="stylesheet" href="style.css" />
  <!-- Pequeños overrides y utilidades inline (NO BORRAR: conservadas y combinadas) -->
  <style>
    /* adjustments: make header/controls a bit more rounded & minimal */
    :root { --radius-md: 12px; --radius-lg: 16px; --accent: #0a84ff; --muted: #8a8f98; --text: #0b0f19; --card-bg: #ffffff; --card-bg-2: #fafafa; --border: rgba(10,10,10,0.06); --page-bg: #ffffff; }
    /* Dark theme variables (auto) */
    html:not(.light) { --text: #ffffff; --muted: #b5bdc9; --accent: #0a84ff; --card-bg: #0f1422; --card-bg-2: #0b0f19; --border: rgba(255,255,255,0.08); --page-bg: #0b0f19; }
    body { background: var(--page-bg); color: var(--text); }

    .nav-inner { min-height: 64px; gap:12px; display:flex; align-items:center; justify-content:space-between; padding:10px 20px; }
    .btn { border-radius: var(--radius-md); color: var(--text); }
    html:not(.light) .btn { color:#fff; border-color: rgba(255,255,255,0.12); }
    .brand img { border-radius: 10px; }

    /* PRO button style (kept here so HTML is copy/paste-ready) */
    .btn-pro {
      padding:8px 14px;
      font-weight:800;
      border-radius:999px;
      border: 1px solid rgba(255,255,255,0.06);
      background: linear-gradient(90deg, rgba(10,132,255,0.14), rgba(10,132,255,0.28));
      color: #fff;
      box-shadow: 0 6px 18px rgba(10,132,255,0.06);
      position:relative;
      overflow:hidden;
    }
    .btn-pro:before {
      content: "";
      position: absolute;
      inset: -120% -40% -120% -40%;
      background: linear-gradient(90deg, rgba(255,255,255,0.16), rgba(10,132,255,0.28), rgba(255,255,255,0.16));
      transform: rotate(20deg);
      opacity: .6;
      transition: transform .9s ease;
      filter: blur(8px);
    }
    .btn-pro:hover:before { transform: translateX(18%) rotate(20deg); opacity: .95; }
    .btn-pro:focus { box-shadow: 0 8px 28px rgba(10,132,255,0.18); outline: none; }

    /* make mini language & cart menus more rounded */
    .mini-cart, .lang-menu { border-radius: 14px; }

    /* small responsive tweak so PRO button doesn't crowd */
    @media (max-width:720px) { .btn-pro { display:none; } }

    /* --- ADICIONES: Botón PRO y Discover (no borra nada) --- */
    .btn-pro {
      margin-left:8px;
      padding:8px 12px;
      border-radius:12px;
      font-weight:800;
      letter-spacing:0.02em;
      background: linear-gradient(90deg, rgba(10,132,255,0.14) 0%, rgba(10,84,255,0.95) 50%, rgba(10,132,255,0.14) 100%);
      color: white;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 6px 20px rgba(10,132,255,0.08);
      transition: transform .22s ease, box-shadow .22s ease, background .6s ease;
    }
    .btn-pro:hover { transform: translateY(-3px); box-shadow: 0 14px 36px rgba(10,132,255,0.12); }

    /* animated subtle gradient shift */
    @keyframes proShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .btn-pro { background-size: 200% 200%; animation: proShift 6s ease infinite; }

    /* discover button (single CTA on product cards) */
    .btn-discover {
      width:100%;
      display:inline-flex;
      justify-content:center;
      padding:10px 12px;
      border-radius:10px;
      border: none;
      font-weight:700;
      cursor:pointer;
      background: linear-gradient(180deg,var(--accent), color-mix(in oklab, var(--accent) 60%, #fff 40%));
      color:#00121a;
      box-shadow: 0 8px 18px rgba(10,132,255,0.06);
    }
    html:not(.light) .btn-discover {
      background: linear-gradient(180deg, var(--accent), color-mix(in oklab, var(--accent) 35%, #000 65%));
      color:#fff;
      box-shadow: 0 8px 18px rgba(10,132,255,0.18);
      border: 1px solid rgba(255,255,255,0.08);
    }
    @media (max-width:900px) {
      .btn-discover { padding:10px; font-size:0.95rem; }
    }

    /* download button style */
    .btn-download {
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      background:transparent;
      cursor:pointer;
      font-weight:700;
      color: var(--text);
    }
    html:not(.light) .btn-download { border-color: rgba(255,255,255,0.14); color:#fff; }

    /* ======================
       ADICIONES: HERO VIDEO (estilo tipo Apple)
       ====================== */
    .hero {
      position: relative;
      overflow: hidden;
      min-height: 100vh; /* full screen */
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 48px 24px;
    }
    .hero video.hero-bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -2;
      pointer-events: none;
      filter: brightness(0.6) saturate(0.98);
      will-change: transform;
    }
    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.18) 0%, rgba(0,0,0,0.35) 100%);
      z-index: -1;
      pointer-events: none;
    }
    .hero-content { position: relative; z-index: 1; text-align:center; max-width:1100px; color:#fff; }
    .hero-content h1 { font-size: clamp(2.4rem, 6vw, 4.6rem); margin-bottom: 10px; }
    .hero-cta { display:flex; gap:12px; justify-content:center; margin-top:14px; }
    .hero-cta .btn { padding:12px 16px; border-radius:12px; font-weight:800; }

    /* ======================
       NUEVA SECCIÓN: promo-row (Apple-like square cards)
       ====================== */
    .promo-row {
      padding: 40px 20px;
      max-width: 1200px;
      margin: 0 auto 48px;
    }
    .promo-title {
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:12px;
      margin-bottom:18px;
    }
    .promo-title h2 { margin:0; font-size:1.6rem; color:var(--text); }
    .promo-cards {
      display:flex;
      gap:20px;
      overflow-x:auto;
      padding-bottom:6px;
      -webkit-overflow-scrolling: touch;
    }
    .promo-card {
      flex: 0 0 320px;
      height: 420px;
      min-width: 280px;
      border-radius: 20px;
      background: linear-gradient(180deg, var(--card-bg), var(--card-bg-2));
      border: 1px solid var(--border);
      box-shadow: 0 12px 30px rgba(2,6,12,0.06);
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      overflow:hidden;
      position:relative;
      padding:18px;
      transition: transform .28s cubic-bezier(.2,.9,.3,1), box-shadow .28s ease;
      cursor: pointer;
      scroll-snap-align: start;
    }
    html:not(.light) .promo-card { box-shadow: 0 12px 30px rgba(0,0,0,0.28); }

    .promo-card:focus { outline: none; box-shadow: 0 0 0 6px rgba(10,132,255,0.18); }
    .promo-card:hover { transform: translateY(-8px); box-shadow: 0 24px 60px rgba(2,6,12,0.12); }

    .promo-media {
      flex: 1 1 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius: 12px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01));
      margin-bottom:12px;
    }

    .promo-media img {
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .promo-meta {
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .promo-kicker { font-size:0.85rem; color:var(--muted); font-weight:600; letter-spacing:0.02em; text-transform:uppercase; }
    .promo-title-lg { font-size:1.25rem; line-height:1.08; margin:0; font-weight:800; color:var(--text); }
    .promo-cta-row { display:flex; gap:8px; align-items:center; margin-top:6px; }

    .promo-btn {
      padding:10px 12px;
      border-radius: 10px;
      border: none;
      font-weight:800;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      color: var(--text);
    }
    html:not(.light) .promo-btn { color:#fff; }

    .promo-btn.pro-cta {
      background: linear-gradient(90deg,#ffd07a,#ff9b6b);
      color: #00121a;
      box-shadow: 0 8px 22px rgba(255,154,78,0.12);
    }
    html:not(.light) .promo-btn.pro-cta { color:#1a0a00; }

    .promo-btn.discover-cta {
      background: transparent;
      border: 1px solid rgba(10,10,10,0.06);
      color: var(--text);
    }
    html:not(.light) .promo-btn.discover-cta { border-color: rgba(255,255,255,0.12); color:#fff; }

    .promo-mini {
      position:absolute;
      right:12px;
      bottom:12px;
      background: rgba(0,0,0,0.06);
      width:38px;
      height:38px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:var(--text);
      backdrop-filter: blur(4px);
    }
    html:not(.light) .promo-mini { background: rgba(255,255,255,0.08); color:#fff; }

    @media (max-width:900px){
      .promo-card { flex: 0 0 84%; height: 380px; min-width: 260px; }
      .promo-row { padding: 22px 12px; margin-bottom:22px; }
    }

    /* ======================
       FOOTER & GRID tweaks (conservadas)
       ====================== */
    .footer { padding-top: 28px; }
    .footer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 28px;
      align-items: start;
      padding: 32px 40px;
      max-width: 1200px;
      margin: 0 auto;
      color: var(--text);
    }

    /* Mobile header menu: aseguramos que el botón abra el menú */
    #mobileMenuToggle { display:none; background:transparent; border:none; padding:6px; border-radius:10px; cursor:pointer; }
    #mobileMenuToggle img { display:block; pointer-events:none; }
    #mobileMenu {
      display:none;
      position:absolute;
      right:12px;
      top:64px;
      z-index:9999;
      min-width: 68vw;
      max-width: 88vw;
      padding:12px;
      border-radius:14px;
      background: linear-gradient(180deg, var(--card-bg), var(--card-bg-2));
      border:1px solid var(--border);
    }
    #mobileMenu a, #mobileMenu button {
      display:flex;
      width:100%;
      text-align:left;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, var(--card-bg), var(--card-bg-2));
      color: var(--text);
      margin-bottom:8px;
      cursor:pointer;
    }
    @media (max-width:720px){
      #navLinks { display:none !important; }
      .nav-right > *:not(#mobileMenuToggle) { display:none !important; }
      #mobileMenuToggle { display:inline-flex; align-items:center; justify-content:center; }
    }

    /* ======================
       NUEVAS SECCIONES: estructura solicitada
       ====================== */
    .featured {
      max-width:1200px; margin: 40px auto; padding: 0 20px; display:grid; grid-template-columns: 1.1fr 1fr; gap:24px; align-items:center;
    }
    .featured .img-wrap { border-radius:20px; overflow:hidden; border:1px solid var(--border); background: linear-gradient(180deg, var(--card-bg), var(--card-bg-2)); }
    .featured .img-wrap img { width:100%; height:auto; display:block; }
    .featured h2 { font-size: clamp(1.8rem, 4.4vw, 3rem); margin:0 0 8px; }
    .featured p { color:var(--muted); margin:0 0 14px; }
    .featured .cta { display:flex; gap:10px; }

    @media (max-width:900px){ .featured { grid-template-columns: 1fr; } }

    .features {
      max-width:1200px; margin: 20px auto 40px; padding: 0 20px;
    }
    .features h3 { font-size:1.4rem; margin-bottom: 14px; }
    .features-grid { display:grid; grid-template-columns: repeat(4, 1fr); gap:14px; }
    .feature-item { border:1px solid var(--border); border-radius:14px; padding:16px; background: linear-gradient(180deg, var(--card-bg), var(--card-bg-2)); text-align:center; }
    .feature-item .icon { font-size: 26px; margin-bottom:8px; }
    .feature-item .txt { font-weight:800; }
    @media (max-width:900px){ .features-grid { grid-template-columns: repeat(2,1fr); } }
    @media (max-width:520px){ .features-grid { grid-template-columns: 1fr; } }

    .visual {
      position: relative; overflow:hidden; margin: 40px 0;
    }
    .visual .strip {
      display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; max-width:1200px; margin:0 auto; padding: 0 20px;
    }
    .visual .strip img { width:100%; height:320px; object-fit:cover; border-radius:16px; border:1px solid var(--border); }
    @media (max-width:900px){ .visual .strip { grid-template-columns: 1fr; } .visual .strip img { height:240px; } }

    .compare {
      max-width:1200px; margin: 20px auto 40px; padding: 0 20px;
    }
    .compare h3 { font-size:1.4rem; margin-bottom: 14px; }
    .compare-grid { display:grid; grid-template-columns: repeat(3,1fr); gap:12px; }
    .compare-item { border:1px solid var(--border); border-radius:14px; padding:16px; background: linear-gradient(180deg, var(--card-bg), var(--card-bg-2)); }
    .compare-item strong { display:block; margin-bottom:6px; }
    @media (max-width:900px){ .compare-grid { grid-template-columns: 1fr; } }

    .testimonials {
      max-width:900px; margin: 20px auto 40px; padding: 0 20px; text-align:center;
    }
    .quote { font-size: clamp(1.1rem, 2.6vw, 1.6rem); color:var(--muted); margin: 8px 0; }

    .final-cta {
      max-width:1200px; margin: 30px auto 60px; padding: 40px 20px; text-align:center; border-radius:20px; border:1px solid var(--border);
      background: linear-gradient(180deg, var(--card-bg), var(--card-bg-2));
    }
    .final-cta h2 { font-size: clamp(2rem, 5vw, 3rem); margin: 0 0 10px; }
    .final-cta .btn { padding:12px 16px; border-radius:12px; font-weight:800; }
  </style>
</head>
<body>

<!-- NAV -->
<header class="nav glass" role="banner" style="position:relative;">
  <div class="nav-inner">
    <!-- LEFT: logo -->
    <div class="nav-left" style="display:flex;align-items:center;gap:12px;">
      <div class="brand"
           role="link"
           tabindex="0"
           aria-label="Ir al inicio"
           onclick="location.href='index.html'"
           onkeydown="if(event.key==='Enter' || event.key===' ') { event.preventDefault(); location.href='index.html'; }"
           style="display:flex;align-items:center;gap:10px;">
        <img src="https://i.imgur.com/dOCYmkx.jpeg" alt="LIXBY logo" width="44" height="44">
        <div class="title" style="font-weight:800;font-size:1rem;">LIXBY</div>
      </div>
    </div>

    <!-- CENTER: nav links -->
    <nav id="navLinks" role="navigation" aria-label="Principal">
      <a href="#inicio" data-i18n="nav.inicio">Inicio</a>
      <a href="#productos" data-i18n="nav.productos">Productos</a>
      <a href="soporte.html">Soporte</a>
      <a href="#conocenos" data-i18n="nav.conocenos">Conócenos</a>
      <a href="productos.html">Tienda</a>
      <a href="#cta-final" class="btn" style="border:1px solid var(--border); padding:8px 12px;">Comprar</a>
    </nav>

    <!-- RIGHT: controles en fila -->
    <div class="nav-right" aria-hidden="false" style="display:flex;align-items:center;gap:12px;position:relative;">
      <!-- Mobile toggle -->
      <button id="mobileMenuToggle" class="icon-btn" aria-label="Abrir menú" aria-haspopup="true" aria-expanded="false" type="button">
        <img src="https://www.shutterstock.com/image-vector/menu-icon-trendy-flat-style-600nw-432264136.jpg" alt="Menú" width="28" height="28" style="border-radius:6px;object-fit:cover;">
      </button>
      <div id="mobileMenu" class="glass" role="menu" aria-hidden="true" aria-label="Menú móvil">
        <a href="#inicio" role="menuitem">Inicio</a>
        <a href="productos.html" role="menuitem">Tienda</a>
        <a href="soporte.html" role="menuitem">Soporte</a>
        <a href="#conocenos" role="menuitem">Conócenos</a>
        <a href="#productos" role="menuitem">Productos</a>
        <a href="lixbycare.html" role="menuitem">LixbyCare+</a>
        <a href="carrito.html" role="menuitem">Carrito</a>
        <button id="mobileAccount" type="button" role="menuitem">Cuenta</button>
        <button id="mobileTheme" type="button" role="menuitem">Cambiar tema</button>
      </div>

      <div class="cart-wrapper" style="position:relative;">
        <button id="cartBtn" class="icon-btn" aria-label="Ver carrito" aria-controls="miniCart" aria-expanded="false" type="button">🛒 <span id="cartCount" class="badge">0</span></button>

        <div id="miniCart" class="mini-cart glass" aria-hidden="true" role="region" aria-label="Mini carrito">
          <div class="mini-cart-header" style="display:flex;justify-content:space-between;align-items:center;">
            <strong data-i18n="cart.title">Carrito</strong>
            <button id="clearCart" class="text-btn" data-i18n="cart.clear" type="button">Vaciar</button>
          </div>
          <div id="miniCartItems" class="mini-cart-items" tabindex="0" aria-live="polite" style="max-height:220px;overflow:auto;">
            <!-- items dinámicos -->
          </div>
          <div class="mini-cart-footer" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div><strong data-i18n="cart.total">Total:</strong> <span id="miniCartTotal">0€</span></div>
              <div><button id="checkoutBtn" class="btn primary" data-i18n="cart.checkout" type="button">Pagar</button></div>
            </div>
            <div style="display:flex;gap:8px;">
              <button id="viewCartBtn" class="btn ghost" type="button" data-i18n="cart.view">Ver carrito</button>
            </div>
          </div>
        </div>
      </div>

      <div class="lang-wrapper" style="position:relative;">
        <button id="langBtn" class="icon-btn" aria-haspopup="true" aria-expanded="false" type="button"> <span id="langFlag">🇪🇸</span> <span id="langLabel">Español</span> ▾ </button>
        <div id="langMenu" class="lang-menu glass" aria-hidden="true" style="display:none;flex-direction:column;gap:6px;padding:8px;width:220px;position:absolute;right:0;top:44px;">
          <button class="lang-item" data-lang="es" type="button">🇪🇸 Español</button>
          <button class="lang-item" data-lang="en" type="button">🇬🇧 English</button>
          <button class="lang-item" data-lang="fr" type="button">🇫🇷 Français</button>
          <button class="lang-item" data-lang="de" type="button">🇩🇪 Deutsch</button>
          <button class="lang-item" data-lang="it" type="button">🇮🇹 Italiano</button>
          <button class="lang-item" data-lang="pt" type="button">🇵🇹 Português</button>
          <button class="lang-item" data-lang="nl" type="button">🇳🇱 Nederlands</button>
          <button class="lang-item" data-lang="zh" type="button">🇨🇳 中文</button>
          <button class="lang-item" data-lang="ja" type="button">🇯🇵 日本語</button>
        </div>
      </div>

      <div id="accountContainer" style="display:flex;align-items:center;gap:8px;">
        <div id="accountPreview" style="display:none;align-items:center;gap:8px;cursor:pointer;" role="button" tabindex="0" aria-label="Ir a mi cuenta">
          <img id="accountAvatar" src="" alt="Avatar" width="36" height="36" style="border-radius:10px;object-fit:cover;">
          <strong id="accountName" style="font-size:0.95rem"></strong>
        </div>

        <button id="accountBtn" class="btn ghost" aria-label="Mi cuenta" type="button">Cuenta</button>

        <button id="proBtn" class="btn btn-pro" type="button" aria-label="Pásate al Pro" data-i18n="pro.cta">PÁSATE AL PRO</button>
      </div>

      <button id="themeToggle" class="btn ghost" aria-label="Cambiar tema" type="button">◐</button>
    </div>
  </div>
</header>

<main id="maincontent">
  <!-- HERO -->
  <section id="inicio" class="hero reveal" aria-labelledby="hero-title">
    <video class="hero-bg" autoplay muted loop playsinline preload="auto" aria-hidden="true">
      <source src="Bienvenido.mp4" type="video/mp4">
    </video>

    <div class="hero-content">
      <h1 id="hero-title" data-i18n="hero.title">La tecnología que te entiende</h1>
      <p id="hero-subtitle" data-i18n="hero.subtitle">Innovación minimalista para tu día a día</p>
      <div class="hero-cta">
        <a href="#destacado" class="btn" style="border:1px solid rgba(255,255,255,0.28);color:#fff">Descúbrelo</a>
        <a href="#cta-final" class="btn" style="background:#fff;color:#00121a;font-weight:800;border:1px solid rgba(255,255,255,0.2)">Comprar</a>
      </div>
    </div>
  </section>

  <!-- NUEVA SECCIÓN: Producto destacado -->
  <section id="destacado" class="featured reveal" aria-labelledby="feat-title">
    <div class="img-wrap">
      <img src="https://images.unsplash.com/photo-1510557880182-3d4d3cba35a5?q=80&w=1200&auto=format&fit=crop" alt="Producto destacado LIXBY">
    </div>
    <div>
      <h2 id="feat-title">Potencia. Diseño. Libertad.</h2>
      <p>Lo mejor de LIXBY concentrado en una pieza icónica. Rendimiento sin esfuerzo y estética minimalista.</p>
      <div class="cta">
        <a href="#productos" class="btn" style="border:1px solid var(--border);">Ver productos</a>
        <a href="producto.html?id=lixby-one-pro" class="btn" style="background:var(--accent);color:#00121a;">Comprar</a>
      </div>
    </div>
  </section>

  <!-- NUEVA SECCIÓN: Features -->
  <section class="features reveal" aria-labelledby="features-title">
    <h3 id="features-title">Características principales</h3>
    <div class="features-grid">
      <div class="feature-item">
        <div class="icon">🪶</div>
        <div class="txt">Diseño ligero</div>
      </div>
      <div class="feature-item">
        <div class="icon">🔋</div>
        <div class="txt">Batería increíble</div>
      </div>
      <div class="feature-item">
        <div class="icon">🌈</div>
        <div class="txt">Pantalla única</div>
      </div>
      <div class="feature-item">
        <div class="icon">🔒</div>
        <div class="txt">LixbyCare+</div>
      </div>
    </div>
  </section>

  <!-- NUEVA SECCIÓN: Visual/Galería -->
  <section class="visual reveal" aria-label="Galería">
    <div class="strip">
      <img src="https://images.unsplash.com/photo-1520975922215-cf2f4c12bd89?q=80&w=1200&auto=format&fit=crop" alt="Detalle 1">
      <img src="https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=1200&auto=format&fit=crop" alt="Detalle 2">
      <img src="https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=1200&auto=format&fit=crop" alt="Detalle 3">
    </div>
  </section>

  <!-- NUEVA SECCIÓN: Comparativa/beneficios -->
  <section class="compare reveal" aria-labelledby="compare-title">
    <h3 id="compare-title">El futuro como tú lo quieres</h3>
    <div class="compare-grid">
      <div class="compare-item">
        <strong>Lixby One Air</strong>
        <div>Ligero y accesible. Ideal para moverte.</div>
      </div>
      <div class="compare-item">
        <strong>Lixby One</strong>
        <div>Equilibrio perfecto entre potencia y precio.</div>
      </div>
      <div class="compare-item">
        <strong>Lixby One Pro</strong>
        <div>Máximo rendimiento y audio de alta fidelidad.</div>
      </div>
    </div>
  </section>

  <!-- NUEVA SECCIÓN: Testimonios -->
  <section class="testimonials reveal" aria-labelledby="testimonials-title">
    <h3 id="testimonials-title" style="margin-bottom:6px;">Lo que dicen</h3>
    <p class="quote">“El minimalismo de LIXBY hace que todo parezca más fácil.” — Prensa</p>
    <p class="quote">“No vuelvo atrás. Es fluido, silencioso y precioso.” — Usuario</p>
  </section>

  <!-- NUEVA SECCIÓN: Llamada final (CTA) -->
  <section id="cta-final" class="final-cta reveal" aria-labelledby="final-title">
    <h2 id="final-title">Empieza hoy</h2>
    <p style="color:var(--muted);margin:0 0 12px;">Da el salto a una experiencia limpia y potente.</p>
    <a href="productos.html" class="btn" style="background:var(--accent);color:#00121a;">Comprar</a>
  </section>

  <!-- NUEVA SECCIÓN: Apple-like square promo cards (se mantiene) -->
  <section class="promo-row" aria-labelledby="promo-title" role="region">
    <div class="promo-title">
      <h2 id="promo-title">Descubre</h2>
      <div style="color:var(--muted);font-size:0.95rem">Seleccionado por LIXBY — minimal, claro y directo</div>
    </div>

    <div class="promo-cards" role="list">
      <article class="promo-card" role="listitem" tabindex="0" aria-labelledby="pro-card-title" data-card="pro">
        <div class="promo-media" aria-hidden="true">
          <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=8b2a1b2a3f3a9b3e" alt="Pro">
        </div>
        <div class="promo-meta">
          <div class="promo-kicker">Exclusivo</div>
          <h3 id="pro-card-title" class="promo-title-lg">PÁSATE AL PRO</h3>
          <p style="margin:0;color:var(--muted)">Funciones avanzadas, soporte prioritario y materiales premium.</p>
          <div class="promo-cta-row">
            <button class="promo-btn pro-cta" id="goProBtn" type="button" aria-label="Pásate al Pro">PÁSATE AL PRO →</button>
            <button class="promo-btn discover-cta" id="learnProBtn" type="button" aria-label="Más info Pro">Más info</button>
          </div>
        </div>
        <div class="promo-mini" aria-hidden="true">PRO</div>
      </article>

      <article class="promo-card" role="listitem" tabindex="0" aria-labelledby="discover-card-title" data-card="discover">
        <div class="promo-media" aria-hidden="true">
          <img src="https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=7f6f6ad9d4f8c4c8" alt="Productos">
        </div>
        <div class="promo-meta">
          <div class="promo-kicker">Colección</div>
          <h3 id="discover-card-title" class="promo-title-lg">DESCUBRE NUESTROS PRODUCTOS</h3>
          <p style="margin:0;color:var(--muted)">Explora el catálogo y encuentra el LIXBY que mejor encaja contigo.</p>
          <div class="promo-cta-row">
            <a href="#productos" class="promo-btn discover-cta" role="button" aria-label="Descubre nuestros productos">DESCUBRIR</a>
            <button class="promo-btn" id="openCatalogBtn" aria-label="Ver catálogo">Ver catálogo</button>
          </div>
        </div>
        <div class="promo-mini" aria-hidden="true">✚</div>
      </article>

      <article class="promo-card" role="listitem" tabindex="0" aria-labelledby="garantia-card-title" data-card="garantia">
        <div class="promo-media" aria-hidden="true">
          <img src="https://cdn-icons-png.flaticon.com/512/985/985723.png" alt="LixbyCare+">
        </div>
        <div class="promo-meta">
          <div class="promo-kicker">Seguridad</div>
          <h3 id="garantia-card-title" class="promo-title-lg">LixbyCare+</h3>
          <p style="margin:0;color:var(--muted)">2 años de garantía oficial y 30 días para devoluciones sin preguntas.</p>
          <div class="promo-cta-row">
            <a class="btn-discover" id="garantiaBtn" href="lixbycare.html" aria-label="Descubrir LixbyCare+">DESCUBRIR</a>
            <a class="promo-btn discover-cta" id="garantiaFaqBtn" href="faq.html#garantia" aria-label="Preguntas sobre LixbyCare+">Preguntas</a>
          </div>
        </div>
        <div class="promo-mini" aria-hidden="true">✔</div>
      </article>

      <article class="promo-card" role="listitem" tabindex="0" aria-labelledby="eco-card-title" data-card="eco">
        <div class="promo-media" aria-hidden="true">
          <img src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=9a2b3c4d5e6f7a8b" alt="Sostenible">
        </div>
        <div class="promo-meta">
          <div class="promo-kicker">Medio ambiente</div>
          <h3 id="eco-card-title" class="promo-title-lg">ECO & SOSTENIBLE</h3>
          <p style="margin:0;color:var(--muted)">Materiales reciclados y programa de reciclaje al comprar.</p>
          <div class="promo-cta-row">
            <button class="promo-btn discover-cta" id="ecoBtn" type="button" aria-label="Más sobre sostenibilidad">Más</button>
          </div>
        </div>
        <div class="promo-mini" aria-hidden="true">♻</div>
      </article>
    </div>
  </section>

  <!-- PRODUCTOS -->
  <section id="productos" class="section reveal" aria-labelledby="prod-title">
    <h2 id="prod-title" data-i18n="section.products">Productos</h2>
    <div class="grid">
      <article class="card glass" data-product="lixby-one-air" role="button" tabindex="0" aria-label="Lixby One Air">
        <div class="thumb">
          <img src="https://m.media-amazon.com/images/I/61j5RD1d9KL._UF1000,1000_QL80_.jpg" alt="Lixby One Air" loading="lazy" decoding="async" width="600" height="600">
        </div>
        <h3 class="prod-title" data-i18n="product.lixby-one-air.title">Lixby One Air</h3>
        <p class="prod-desc" data-i18n="product.lixby-one-air.desc">Ultraligero y económico.</p>
        <span class="price" data-i18n="product.lixby-one-air.price">249€</span>
        <div class="actions"></div>
      </article>

      <article class="card glass" data-product="lixby-one" role="button" tabindex="0" aria-label="Lixby One">
        <div class="thumb">
          <img src="https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg" alt="Lixby One" loading="lazy" decoding="async" width="600" height="600">
        </div>
        <h3 class="prod-title" data-i18n="product.lixby-one.title">Lixby One</h3>
        <p class="prod-desc" data-i18n="product.lixby-one.desc">Ultraligero y potente.</p>
        <span class="price" data-i18n="product.lixby-one.price">349€</span>
        <div class="actions"></div>
      </article>

      <article class="card glass" data-product="lixby-one-pro" role="button" tabindex="0" aria-label="Lixby One Pro">
        <div class="thumb">
          <img src="https://m.media-amazon.com/images/I/61rriyfRKwL.jpg" alt="Lixby One Pro" loading="lazy" decoding="async" width="600" height="600">
        </div>
        <h3 class="prod-title" data-i18n="product.lixby-one-pro.title">Lixby One Pro</h3>
        <p class="prod-desc" data-i18n="product.lixby-one-pro.desc">Audio de alta fidelidad.</p>
        <span class="price" data-i18n="product.lixby-one-pro.price">899€</span>
        <div class="actions"></div>
      </article>
    </div>
  </section>

  <!-- CONTACTO -->
  <section id="contacto" class="section contact-min glass reveal" aria-labelledby="contact-title">
    <div class="left">
      <h2 id="contact-title" data-i18n="contact.title">Contáctanos</h2>
      <p class="lead" data-i18n="contact.lead">Déjanos una duda o sugerencias y te responderemos lo antes posible.</p>
    </div>

    <form id="contactForm" class="form" aria-label="Formulario de contacto" onsubmit="return false;">
      <input id="contactName" name="from_name" type="text" placeholder="Nombre" data-i18n-placeholder="contact.placeholder.name" required autocomplete="name">
      <input id="contactEmail" name="from_email" type="email" placeholder="Correo" data-i18n-placeholder="contact.placeholder.email" required autocomplete="email">
      <textarea id="contactMessage" name="message" placeholder="Tu mensaje" data-i18n-placeholder="contact.placeholder.message" required></textarea>

      <input id="ticketId" type="hidden" name="ticket_id" value="">

      <div class="actions">
        <button type="button" class="btn ghost" onclick="document.getElementById('contactForm').reset();" data-i18n="btn.clear">Borrar</button>
        <button type="submit" id="contactSend" class="btn primary" data-i18n="btn.enviar">Enviar</button>
      </div>
      <div id="contactSuccess" class="contact-success" role="status" aria-live="polite" data-i18n="contact.success">Mensaje enviado. ¡Gracias! Te contestaremos pronto.</div>
    </form>
  </section>

  <!-- CONÓCENOS -->
  <section id="conocenos" class="section reveal" aria-labelledby="about-title">
    <h2 id="about-title" data-i18n="about.title">Conócenos</h2>
    <p data-i18n="about.text">En LIXBY creemos en el equilibrio perfecto entre diseño y funcionalidad. Creamos productos que no solo funcionan, sino que también inspiran.</p>
  </section>
</main>

<!-- debug -->
<div id="debug" style="display:none;max-width:1100px;margin:12px auto;color:var(--muted);white-space:pre-wrap;"></div>

<!-- Footer (con traducciones aplicables) -->
<footer class="footer glass" role="contentinfo" aria-labelledby="footer-heading">
  <div class="footer-grid" id="footerGrid">
    <div class="footer-col">
      <div class="footer-brand">LIXBY</div>
      <p data-i18n="footer.description">Diseño minimalista, tecnología que acompaña tu día a día. Síguenos para novedades y lanzamientos.</p>
      <div class="social-links" aria-label="Redes sociales">
        <a href="#" title="Twitter" aria-label="Twitter" rel="noopener">...</a>
        <a href="#" title="Instagram" aria-label="Instagram" rel="noopener">...</a>
        <a href="#" title="YouTube" aria-label="YouTube" rel="noopener">...</a>
      </div>
    </div>

    <div class="footer-col">
      <h4 data-i18n="footer.links">Enlaces</h4>
      <div class="footer-links" role="navigation" aria-label="Enlaces rápidos">
        <a href="explorar.html" data-i18n="footer.explore">Explorar</a>
        <a href="productos.html" data-i18n="footer.catalog">Catálogo</a>
        <a href="carrito.html" data-i18n="footer.cart">Carrito</a>
        <a href="cuenta.html" data-i18n="footer.account">Mi cuenta</a>
      </div>
    </div>

    <div class="footer-col">
      <h4 data-i18n="footer.help">Ayuda</h4>
      <div class="footer-links">
        <a href="contacto.html" data-i18n="footer.contact">Contacto</a>
        <a href="faq.html" id="footerFaqLink">Preguntas frecuentes</a>
        <a href="envios.html" data-i18n="footer.shipping">Envíos y devoluciones</a>
        <a href="soporte.html" data-i18n="footer.support">Soporte técnico</a>
      </div>
    </div>

    <div class="footer-col" aria-label="Newsletter">
      <h4 data-i18n="footer.subscribe">Suscríbete</h4>
      <p data-i18n="footer.subscribe_text">Recibe novedades, ofertas exclusivas y lanzamientos.</p>
      <form id="newsletterForm" class="newsletter-form" onsubmit="return false;" aria-label="Formulario newsletter">
        <input id="newsletterEmail" type="email" placeholder="tu@correo.com" data-i18n-placeholder="newsletter.placeholder" aria-label="Correo electrónico para newsletter" required>
        <button id="newsletterBtn" type="submit" aria-label="Suscribirse" data-i18n="btn.subscribe">Suscribir</button>
      </form>
      <div style="margin-top:8px;">
        <a id="downloadBtn" class="btn-download" href="download/guide-es.pdf" download data-i18n="btn.download">Descargar</a>
      </div>
      <div id="newsletterMsg" role="status" aria-live="polite" style="margin-top:8px;color:var(--muted);font-size:0.95rem"></div>
    </div>
  </div>

  <div class="footer-bottom">
    <div class="legal-left">
      <small>© <span id="year"></span> LIXBY — Todos los derechos reservados</small>
      <div class="legal-links" style="margin-left:12px;">
        <a href="privacidad.html" data-i18n="footer.privacy">Política de privacidad</a>
        <a href="terminos.html" data-i18n="footer.terms">Términos y condiciones</a>
        <a id="accessibilityLink" href="accessibility.html" aria-label="Ir a la página de accesibilidad" data-i18n="footer.accessibility">Accesibilidad</a>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:12px;">
      <button id="backToTop" class="back-to-top" aria-label="Volver arriba" title="Volver arriba">↑ Volver arriba</button>
      <small style="color:var(--muted)">Versión demo</small>
    </div>
  </div>
</footer>

<!-- Cart panel (estático) + backdrop (se mantiene funcional) -->
<div id="cartBackdrop" class="cart-backdrop" aria-hidden="true"></div>
<aside id="cartPanel" class="cart-panel" aria-hidden="true">
  <div class="cart-panel-inner glass" role="dialog" aria-label="Carrito">
    <div class="cart-header" style="display:flex;justify-content:space-between;align-items:center;">
      <strong data-i18n="cart.title">Carrito</strong>
      <button id="cartPanelClose" class="text-btn" aria-label="Cerrar" type="button">✕</button>
    </div>
    <div id="cartPanelItems" class="cart-list" style="max-height:60vh;overflow:auto;padding:12px"></div>
    <div class="cart-footer" style="padding:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <strong>Total</strong>
        <span id="cartPanelTotal">0€</span>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button id="cartPanelCheckout" class="btn primary" data-i18n="cart.checkout" type="button">Pagar</button>
        <button id="cartPanelClear" class="btn ghost" data-i18n="cart.clear" type="button">Vaciar</button>
      </div>
    </div>
  </div>
</aside>

<!-- Live region for screen-reader announcements -->
<div id="announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<noscript style="display:block;background:#fffb; padding:10px; text-align:center;">
  JavaScript está desactivado o ha ocurrido un error. Si la página no carga correctamente, abre la consola (F12 → Console).
</noscript>

<!-- ===========================
     SCRIPTS (inline para copiar directo)
     =========================== -->
<script>
(function(){
  const KEY = 'lixby_cart_v1';
  const CURRENCY = new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' });
  function parsePrice(s){ if (s === undefined || s === null) return 0; return Number(String(s).replace(/[^\d.,-]/g,'').replace(',', '.')) || 0; }
  function saveCart(c){ try { localStorage.setItem(KEY, JSON.stringify(c)); } catch(e){} }
  function loadCart(){ try { return JSON.parse(localStorage.getItem(KEY))||[]; } catch(e){ return []; } }
  function formatPriceNum(num){ return CURRENCY.format(Number(num) || 0); }
  function showDebug(msg){ const el=document.getElementById('debug'); if(!el) return; el.style.display='block'; el.textContent += msg + "\n"; console.log('DEBUG',msg); }

  try { document.getElementById('year').textContent = new Date().getFullYear(); } catch(e){}

  const PRODUCTS_BRIEF = {
    'lixby-one-air': { id:'lixby-one-air', name: 'Lixby One Air', price: '249€', priceNum: 249, image: 'https://m.media-amazon.com/images/I/61j5RD1d9KL._UF1000,1000_QL80_.jpg' },
    'lixby-one': { id:'lixby-one', name: 'Lixby One', price: '349€', priceNum: 349, image: 'https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg' },
    'lixby-one-pro': { id:'lixby-one-pro', name: 'Lixby One Pro', price: '899€', priceNum: 899, image: 'https://m.media-amazon.com/images/I/61rriyfRKwL.jpg' }
  };

  let cart = loadCart();
  const cartBtn = document.getElementById('cartBtn');
  const miniCart = document.getElementById('miniCart');
  const miniCartItems = document.getElementById('miniCartItems');
  const miniCartTotal = document.getElementById('miniCartTotal');
  const cartCount = document.getElementById('cartCount');
  const clearCartBtn = document.getElementById('clearCart');
  const checkoutBtn = document.getElementById('checkoutBtn');
  const announcements = document.getElementById('announcements');

  const cartPanel = document.getElementById('cartPanel');
  const cartBackdrop = document.getElementById('cartBackdrop');
  const cartPanelClose = document.getElementById('cartPanelClose');
  const cartPanelItems = document.getElementById('cartPanelItems');
  const cartPanelTotal = document.getElementById('cartPanelTotal');
  const cartPanelClear = document.getElementById('cartPanelClear');

  function updateMiniCartUI(){
    if (!cartCount) return;
    const totalQty = cart.reduce((s,i)=>s+(i.qty||0),0);
    cartCount.textContent = totalQty;
    if (!miniCartItems) return;
    miniCartItems.innerHTML = '';
    if (cart.length === 0) {
      miniCartItems.innerHTML = '<div style="padding:8px;color:var(--muted)">' + (getTranslation('cart.empty') || 'Tu carrito está vacío.') + '</div>';
      if (miniCartTotal) miniCartTotal.textContent = formatPriceNum(0);
      return;
    }
    let total = 0;
    const frag = document.createDocumentFragment();
    cart.forEach((it, idx) => {
      const item = document.createElement('div');
      item.className = 'mini-cart-item';
      item.style.display = 'flex'; item.style.gap='10px'; item.style.alignItems='center'; item.style.padding='8px'; item.style.borderRadius='8px';
      const img = document.createElement('img'); img.src = it.image || 'https://via.placeholder.com/80x80?text=Img'; img.alt = it.name; img.style.width='44px'; img.style.height='44px'; img.style.objectFit='cover'; img.style.borderRadius='6px';
      img.loading='lazy'; img.decoding='async';
      const meta = document.createElement('div'); meta.className='meta';
      const title = document.createElement('div'); title.style.fontWeight = '700'; title.textContent = it.name || '';
      const subtitle = document.createElement('div'); subtitle.style.color = 'var(--muted)'; subtitle.textContent = `${formatPriceNum(it.priceNum || parsePrice(it.price))} × ${it.qty||1}`;
      meta.appendChild(title); meta.appendChild(subtitle);
      const remove = document.createElement('button'); remove.className='remove'; remove.textContent='✕'; remove.style.background='transparent'; remove.style.border='none'; remove.style.cursor='pointer';
      remove.setAttribute('type','button');
      remove.addEventListener('click', (e)=>{ e.stopPropagation(); cart.splice(idx,1); saveCart(cart); updateMiniCartUI(); updateCartPanel(); });
      item.appendChild(img); item.appendChild(meta); item.appendChild(remove);
      frag.appendChild(item);
      total += (it.priceNum || parsePrice(it.price)) * (it.qty||1);
    });
    miniCartItems.appendChild(frag);
    if (miniCartTotal) miniCartTotal.textContent = formatPriceNum(total);
  }

  function updateCartPanel(){
    if (!cartPanelItems) return;
    cartPanelItems.innerHTML = '';
    if (cart.length === 0) {
      cartPanelItems.innerHTML = '<div style="padding:12px;color:var(--muted)">' + (getTranslation('cart.empty') || 'Tu carrito está vacío.') + '</div>';
      if (cartPanelTotal) cartPanelTotal.textContent = formatPriceNum(0);
      return;
    }
    let total = 0;
    const frag = document.createDocumentFragment();
    cart.forEach((it, idx) => {
      const row = document.createElement('div');
      row.style.display='flex'; row.style.gap='12px'; row.style.alignItems='center'; row.style.padding='10px 0'; row.style.borderBottom='1px solid rgba(255,255,255,0.03)';
      const img = document.createElement('img'); img.src = it.image || ''; img.alt = it.name; img.style.width='64px'; img.style.height='64px'; img.style.objectFit='cover'; img.style.borderRadius='8px';
      const meta = document.createElement('div'); meta.style.flex='1';
      const title = document.createElement('div'); title.style.fontWeight='700'; title.textContent = it.name || '';
      const qty = document.createElement('div'); qty.style.color='var(--muted)'; qty.textContent = `× ${it.qty || 1} — ${formatPriceNum(it.priceNum || parsePrice(it.price))}`;
      meta.appendChild(title); meta.appendChild(qty);
      const remove = document.createElement('button'); remove.className='text-btn'; remove.textContent='Eliminar'; remove.setAttribute('type','button');
      remove.addEventListener('click', ()=> { cart.splice(idx,1); saveCart(cart); updateMiniCartUI(); updateCartPanel(); });
      row.appendChild(img); row.appendChild(meta); row.appendChild(remove);
      frag.appendChild(row);
      total += (it.priceNum || parsePrice(it.price)) * (it.qty||1);
    });
    cartPanelItems.appendChild(frag);
    if (cartPanelTotal) cartPanelTotal.textContent = formatPriceNum(total);
  }

  if (miniCart) {
    if (miniCart.getAttribute('aria-hidden') === 'false') miniCart.style.display = 'flex';
    else miniCart.style.display = '';
  }

  (function wireCartHoverAndClick(){
    const wrapper = document.querySelector('.cart-wrapper');
    let hideTimeout = null;

    function showMini(){
      if (!miniCart) return;
      miniCart.setAttribute('aria-hidden','false');
      miniCart.style.display = 'flex';
      try { cartBtn.setAttribute('aria-expanded','true'); } catch(e){}
    }
    function hideMini(){
      if (!miniCart) return;
      miniCart.setAttribute('aria-hidden','true');
      miniCart.style.display = '';
      try { cartBtn.setAttribute('aria-expanded','false'); } catch(e){}
    }

    if (wrapper) {
      wrapper.addEventListener('mouseenter', (e) => {
        clearTimeout(hideTimeout);
        showMini();
      });
      wrapper.addEventListener('mouseleave', (e) => {
        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(() => {
          if (cartPanel && cartPanel.classList.contains('open')) return;
          hideMini();
        }, 220);
      });
    }
    if (miniCart) {
      miniCart.addEventListener('mouseenter', () => { clearTimeout(hideTimeout); showMini(); });
      miniCart.addEventListener('mouseleave', () => {
        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(() => {
          if (cartPanel && cartPanel.classList.contains('open')) return;
          hideMini();
        }, 220);
      });
    }

    if (cartBtn) {
      cartBtn.addEventListener('click', (e) => {
        if (e.metaKey || e.ctrlKey) {
          openCartPanel();
          return;
        }
        window.location.href = 'carrito.html';
      });
    }

    const viewBtn = document.getElementById('viewCartBtn');
    if (viewBtn) viewBtn.addEventListener('click', (e) => openCartPanel());
  })();

  function openCartPanel(){
    if (!cartPanel || !cartBackdrop) return;
    cartPanel.classList.add('open');
    cartBackdrop.classList.add('open');
    cartPanel.setAttribute('aria-hidden','false');
    cartBackdrop.setAttribute('aria-hidden','false');
    if (miniCart) { miniCart.setAttribute('aria-hidden','true'); miniCart.style.display = ''; try { cartBtn.setAttribute('aria-expanded','false'); } catch(e){} }
    updateCartPanel();
  }
  function closeCartPanel(){
    if (!cartPanel || !cartBackdrop) return;
    cartPanel.classList.remove('open');
    cartBackdrop.classList.remove('open');
    cartPanel.setAttribute('aria-hidden','true');
    cartBackdrop.setAttribute('aria-hidden','true');
  }
  if (cartBackdrop) cartBackdrop.addEventListener('click', closeCartPanel);
  if (cartPanelClose) cartPanelClose.addEventListener('click', closeCartPanel);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { if (cartPanel && cartPanel.classList.contains('open')) closeCartPanel(); } });

  if (clearCartBtn) clearCartBtn.addEventListener('click', () => { cart=[]; saveCart(cart); updateMiniCartUI(); updateCartPanel(); });
  if (cartPanelClear) cartPanelClear.addEventListener('click', () => { cart=[]; saveCart(cart); updateMiniCartUI(); updateCartPanel(); });

  if (checkoutBtn) checkoutBtn.addEventListener('click', () => { if (cart.length===0) return alert(getTranslation('cart.empty') || 'El carrito está vacío'); alert('Simulación de checkout: ' + cart.reduce((s,i)=>s+(i.qty||0),0) + ' items'); });
  if (document.getElementById('cartPanelCheckout')) document.getElementById('cartPanelCheckout').addEventListener('click', () => { if (cart.length===0) return alert(getTranslation('cart.empty') || 'El carrito está vacío'); alert('Simulación de checkout desde panel: ' + cart.reduce((s,i)=>s+(i.qty||0),0) + ' items'); });

  window.addToCart = function(product){
    const existing = cart.find(p => p.id === product.id);
    if (existing) existing.qty = (existing.qty||1) + 1;
    else cart.push({ id: product.id, name: product.name, price: product.price, priceNum: Number(product.priceNum || parsePrice(product.price) || 0), qty:1, image: product.image });
    saveCart(cart);
    updateMiniCartUI();
    updateCartPanel();
    if (miniCart) { miniCart.setAttribute('aria-hidden','false'); miniCart.style.display = 'flex'; try { cartBtn.setAttribute('aria-expanded','true'); } catch(e){} setTimeout(()=>{ if (miniCart) { miniCart.setAttribute('aria-hidden','true'); miniCart.style.display = ''; try { cartBtn.setAttribute('aria-expanded','false'); } catch(e){} } }, 2200); }
    try { if (announcements) announcements.textContent = `${product.name} añadido al carrito.`; } catch(e){}
  };

  updateMiniCartUI();
  updateCartPanel();

  const langBtn = document.getElementById('langBtn'), langMenu = document.getElementById('langMenu'), langLabel = document.getElementById('langLabel'), langFlag = document.getElementById('langFlag');
  const translations = {
    es: {
      "meta.title":"LIXBY — Tecnología minimalista",
      "nav.inicio":"Inicio","nav.productos":"Productos","nav.contacto":"Contáctanos","nav.conocenos":"Conócenos",
      "hero.title":"La tecnología que te entiende","hero.subtitle":"Innovación minimalista para tu día a día",
      "section.products":"Productos",
      "product.lixby-one-air.title":"Lixby One Air","product.lixby-one-air.desc":"Ultraligero y económico.","product.lixby-one-air.price":"249€",
      "product.lixby-one.title":"Lixby One","product.lixby-one.desc":"Ultraligero y potente.","product.lixby-one.price":"349€",
      "product.lixby-one-pro.title":"Lixby One Pro","product.lixby-one-pro.desc":"Audio de alta fidelidad.","product.lixby-one-pro.price":"899€",
      "btn.explorar":"Explorar","btn.view":"Ver","btn.add":"Añadir al carrito","btn.added":"Añadido","btn.enviar":"Enviar","btn.clear":"Borrar","btn.subscribe":"Suscribir",
      "btn.descubrir":"Descubrir",
      "btn.download":"Descargar",
      "contact.title":"Contáctanos","contact.lead":"Déjanos una duda o sugerencias y te responderemos lo antes posible.","contact.placeholder.name":"Nombre","contact.placeholder.email":"Correo","contact.placeholder.message":"Tu mensaje","contact.success":"Mensaje enviado. ¡Gracias! Te contestaremos pronto.",
      "cart.title":"Carrito","cart.clear":"Vaciar","cart.total":"Total:","cart.checkout":"Pagar","cart.empty":"Tu carrito está vacío.","cart.view":"Ver carrito",
      "footer.description":"Diseño minimalista, tecnología que acompaña tu día a día. Síguenos para novedades y lanzamientos.",
      "footer.links":"Enlaces","footer.explore":"Explorar","footer.catalog":"Catálogo","footer.cart":"Carrito","footer.account":"Mi cuenta",
      "footer.help":"Ayuda","footer.contact":"Contacto","footer.faq":"Preguntas frecuentes","footer.shipping":"Envíos y devoluciones","footer.support":"Soporte técnico",
      "footer.subscribe":"Suscríbete","footer.subscribe_text":"Recibe novedades, ofertas exclusivas y lanzamientos.","newsletter.placeholder":"tu@correo.com",
      "footer.privacy":"Política de privacidad","footer.terms":"Términos y condiciones","footer.accessibility":"Accesibilidad",
      "pro.cta":"PÁSATE AL PRO",
      "about.text":"En LIXBY creemos en el equilibrio perfecto entre diseño y funcionalidad. Creamos productos que no solo funcionan, sino que también inspiran."
    },
    en: {
      "meta.title":"LIXBY — Minimal technology",
      "nav.inicio":"Home","nav.productos":"Products","nav.contacto":"Contact","nav.conocenos":"About",
      "hero.title":"Technology that understands you","hero.subtitle":"Minimal innovations for your day-to-day",
      "section.products":"Products",
      "product.lixby-one-air.title":"Lixby One Air","product.lixby-one-air.desc":"Ultralight and affordable.","product.lixby-one-air.price":"249€",
      "product.lixby-one.title":"Lixby One","product.lixby-one.desc":"Ultralight and powerful.","product.lixby-one.price":"349€",
      "product.lixby-one-pro.title":"Lixby One Pro","product.lixby-one-pro.desc":"High-fidelity audio.","product.lixby-one-pro.price":"899€",
      "btn.explorar":"Explore","btn.view":"View","btn.add":"Add to cart","btn.added":"Added","btn.enviar":"Send","btn.clear":"Clear","btn.subscribe":"Subscribe",
      "btn.descubrir":"Discover",
      "btn.download":"Download",
      "contact.title":"Contact","contact.lead":"Leave us a question or suggestion and we'll reply soon.","contact.placeholder.name":"Name","contact.placeholder.email":"Email","contact.placeholder.message":"Your message","contact.success":"Message sent. Thanks!",
      "cart.title":"Cart","cart.clear":"Clear","cart.total":"Total:","cart.checkout":"Checkout","cart.empty":"Your cart is empty.","cart.view":"View cart",
      "footer.description":"Minimal design, technology that accompanies your everyday life. Follow us for updates and launches.",
      "pro.cta":"GO PRO",
      "about.text":"At LIXBY we believe in the perfect balance between design and functionality. We create products that not only work, but inspire."
    }
  };

  let currentLang = localStorage.getItem('lixby_lang') || (navigator.language ? navigator.language.slice(0,2) : 'es');
  if (!translations[currentLang]) currentLang = 'es';

  function getTranslation(key, lang){
    try {
      const map = translations[lang || currentLang] || translations['es'];
      return (map && map[key]) ? map[key] : null;
    } catch(e){ return null; }
  }

  function setElementTextSafe(el, text){
    if (!el) return;
    try {
      const textNodes = Array.from(el.childNodes).filter(n => n.nodeType === 3);
      if (textNodes.length > 0) {
        textNodes[0].nodeValue = text;
        for (let i = 1; i < textNodes.length; i++) textNodes[i].nodeValue = '';
        return;
      }
      const candidate = el.querySelector('.i18n-text, [data-i18n-text]');
      if (candidate) { candidate.textContent = text; return; }
      el.appendChild(document.createTextNode(text));
    } catch(e){ try { el.textContent = text; } catch(err){} }
  }

  function translateVisibleTextNodes(lang){
    try {
      const base = translations['es'] || {};
      const target = translations[lang] || base;
      const rev = {};
      Object.keys(base).forEach(k => { const s = base[k]; const t = target[k]; if (s && t) rev[s.trim()] = t; });
      const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, {
        acceptNode: function(node){
          if (!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
          const parent = node.parentElement;
          if (!parent) return NodeFilter.FILTER_REJECT;
          const tag = parent.tagName.toLowerCase();
          if (['script','style','textarea','code','pre'].includes(tag)) return NodeFilter.FILTER_REJECT;
          if (node.nodeValue.trim().length > 200) return NodeFilter.FILTER_REJECT;
          return NodeFilter.FILTER_ACCEPT;
        }
      }, false);
      const toReplace = [];
      while(walker.nextNode()){
        const txt = walker.currentNode.nodeValue.trim();
        if (rev[txt]) toReplace.push({node: walker.currentNode, from: txt, to: rev[txt]});
      }
      toReplace.forEach(item => { item.node.nodeValue = item.to; });
    } catch(e){ console.warn('translateVisibleTextNodes failed', e); }
  }

  function applyTranslations(lang){
    if (!translations[lang]) lang = 'es';
    currentLang = lang;
    try { document.documentElement.lang = lang; } catch(e){}
    try { const metaTitle = getTranslation('meta.title', lang); if (metaTitle) document.title = metaTitle; } catch(e){}
    document.querySelectorAll('[data-i18n]').forEach(el => {
      try {
        const key = el.getAttribute('data-i18n');
        if (!key) return;
        const text = getTranslation(key, lang) || el.textContent || '';
        setElementTextSafe(el, text);
      } catch(err){ console.warn('i18n element fail', err); }
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
      try {
        const key = el.getAttribute('data-i18n-placeholder');
        if (!key) return;
        const text = getTranslation(key, lang) || el.getAttribute('placeholder') || '';
        el.setAttribute('placeholder', text);
      } catch(err){ console.warn('i18n placeholder fail', err); }
    });

    try {
      const heroTitle = document.getElementById('hero-title');
      const heroSub = document.getElementById('hero-subtitle');
      if (heroTitle) setElementTextSafe(heroTitle, getTranslation('hero.title', lang) || heroTitle.textContent);
      if (heroSub) setElementTextSafe(heroSub, getTranslation('hero.subtitle', lang) || heroSub.textContent);
    } catch(e){}

    try {
      document.querySelectorAll('.card[data-product]').forEach(card => {
        const pid = card.dataset.product;
        if (!pid) return;
        const titleEl = card.querySelector('.prod-title') || card.querySelector('h3');
        const descEl = card.querySelector('.prod-desc') || card.querySelector('p');
        const priceEl = card.querySelector('.price');
        const keyTitle = `product.${pid}.title`;
        const keyDesc = `product.${pid}.desc`;
        const keyPrice = `product.${pid}.price`;
        const t = getTranslation(keyTitle, lang) || (titleEl && titleEl.textContent) || PRODUCTS_BRIEF[pid] && PRODUCTS_BRIEF[pid].name || '';
        const d = getTranslation(keyDesc, lang) || (descEl && descEl.textContent) || '';
        const p = getTranslation(keyPrice, lang) || (priceEl && priceEl.textContent) || '';
        if (titleEl) setElementTextSafe(titleEl, t);
        if (descEl) setElementTextSafe(descEl, d);
        if (priceEl) setElementTextSafe(priceEl, p);
      });
    } catch(e){ console.warn('i18n products fail', e); }

    try {
      const aboutText = getTranslation('about.text', lang);
      const aboutEl = document.querySelector('[data-i18n="about.text"]') || document.querySelector('#conocenos p');
      if (aboutText && aboutEl) setElementTextSafe(aboutEl, aboutText);
    } catch(e){}

    try {
      const proBtn = document.getElementById('proBtn');
      if (proBtn) setElementTextSafe(proBtn, getTranslation('pro.cta', lang) || proBtn.textContent);
    } catch(e){}

    try { translateVisibleTextNodes(lang); } catch(e){}

    try {
      const flagMap = { es:'🇪🇸', en:'🇬🇧', fr:'🇫🇷', de:'🇩🇪', it:'🇮🇹', pt:'🇵🇹', nl:'🇳🇱', zh:'🇨🇳', ja:'🇯🇵' };
      const nameMap = { es:'Español', en:'English', fr:'Français', de:'Deutsch', it:'Italiano', pt:'Português', nl:'Nederlands', zh:'中文', ja:'日本語' };
      if (langFlag) langFlag.textContent = flagMap[lang] || '🏳️';
      if (langLabel) langLabel.textContent = nameMap[lang] || lang;
    } catch(e){}
    updateMiniCartUI();
    updateCartPanel();
  }

  function setLang(l){
    try {
      if (!translations[l]) l = 'es';
      localStorage.setItem('lixby_lang', l);
    } catch(e){}
    try { applyTranslations(l); } catch(err){ console.warn('setLang apply failed', err); }
  }

  try {
    setLang(localStorage.getItem('lixby_lang') || currentLang);
    if (langBtn && langMenu){
      langBtn.addEventListener('click', ()=> {
        try {
          const isOpen = langMenu.getAttribute('aria-hidden') === 'false';
          langMenu.setAttribute('aria-hidden', String(!isOpen));
          langMenu.style.display = !isOpen ? 'flex' : 'none';
          langBtn.setAttribute('aria-expanded', String(!isOpen));
        } catch(e){}
      });
      Array.from(langMenu.querySelectorAll('.lang-item')).forEach(btn => btn.addEventListener('click', ()=> {
        try {
          const lang = btn.getAttribute('data-lang');
          if (!lang) return;
          setLang(lang);
          langMenu.setAttribute('aria-hidden','true');
          langMenu.style.display='none';
          langBtn.setAttribute('aria-expanded','false');
        } catch(e){ console.warn(e); }
      }));
      document.addEventListener('click', (e)=> {
        try {
          if (!langBtn.contains(e.target) && !langMenu.contains(e.target)) {
            langMenu.setAttribute('aria-hidden','true');
            langMenu.style.display='none';
            langBtn.setAttribute('aria-expanded','false');
          }
        } catch(e){}
      });
    }
  } catch(err){ console.warn('lang wiring failed', err); }

  /* THEME: auto-detección */
  const THEME_KEY = 'lixby_theme';
  const themeToggle = document.getElementById('themeToggle');
  const mq = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)');
  function applyThemeClass(val){
    if (val === 'light') document.documentElement.classList.add('light');
    else document.documentElement.classList.remove('light');
  }
  (function initTheme(){
    const stored = localStorage.getItem(THEME_KEY);
    if (stored === 'light' || stored === 'dark') {
      applyThemeClass(stored);
    } else {
      const systemLight = mq ? mq.matches : false;
      applyThemeClass(systemLight ? 'light' : 'dark');
    }
    if (mq && mq.addEventListener) {
      mq.addEventListener('change', (e) => {
        const setting = localStorage.getItem(THEME_KEY);
        if (setting !== 'light' && setting !== 'dark') {
          applyThemeClass(e.matches ? 'light' : 'dark');
        }
      });
    }
  })();
  if (themeToggle) themeToggle.addEventListener('click', ()=>{
    const isLight = document.documentElement.classList.toggle('light');
    try{ localStorage.setItem(THEME_KEY, isLight ? 'light' : 'dark'); }catch(e){}
  });

  /* PRODUCT CTA único */
  function replaceProductActions(){
    try {
      document.querySelectorAll('.card[data-product]').forEach(card => {
        const pid = card.dataset.product;
        if (!pid) return;
        const actions = card.querySelector('.actions');
        if (!actions) return;
        actions.innerHTML = '';
        const discover = document.createElement('button');
        discover.className = 'btn-discover';
        discover.type = 'button';
        discover.setAttribute('data-id', pid);
        discover.textContent = getTranslation('btn.explorar', currentLang) || getTranslation('btn.descubrir', currentLang) || 'Explorar';
        discover.addEventListener('click', (e) => {
          e.stopPropagation();
          window.location.href = 'producto.html?id=' + encodeURIComponent(pid);
        });
        actions.appendChild(discover);
      });
    } catch(e){ console.warn('replaceProductActions failed', e); }
  }
  replaceProductActions();

  /* Cuenta / PRO */
  try {
    const accountBtn = document.getElementById('accountBtn');
    const accountPreview = document.getElementById('accountPreview');
    const accountAvatar = document.getElementById('accountAvatar');
    const accountName = document.getElementById('accountName');

    function showAccountPreviewIfAvailable(){
      try {
        const storedRaw = localStorage.getItem('lixby_user');
        if (!storedRaw) { accountPreview.style.display = 'none'; accountBtn.style.display = ''; return false; }
        const stored = JSON.parse(storedRaw);
        if (!stored || !stored.uid) { accountPreview.style.display = 'none'; accountBtn.style.display=''; return false; }
        accountAvatar.src = stored.avatar || stored.photoURL || 'https://i.imgur.com/dOCYmkx.jpeg';
        accountName.textContent = stored.displayName || stored.name || 'Usuario';
        accountPreview.style.display = 'flex';
        accountBtn.style.display = 'none';
        return true;
      } catch(e){ accountPreview.style.display = 'none'; accountBtn.style.display=''; return false; }
    }

    if (accountPreview) {
      accountPreview.addEventListener('click', ()=> { window.location.href = 'cuenta.html'; });
      accountPreview.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); window.location.href='cuenta.html'; }});
    }

    if (accountBtn) {
      accountBtn.addEventListener('click', (e) => {
        e.preventDefault();
        try {
          const storedRaw = localStorage.getItem('lixby_user');
          const stored = storedRaw ? JSON.parse(storedRaw) : null;
          const firebaseUser = (window.appAuth && window.appAuth._rawAuth && window.appAuth._rawAuth.currentUser) ? window.appAuth._rawAuth.currentUser : null;
          if (stored && stored.uid) { window.location.href = 'cuenta.html'; return; }
          if (firebaseUser) { window.location.href = 'cuenta.html'; return; }
          if (window.lixbyAuth && typeof window.lixbyAuth.show === 'function') { window.lixbyAuth.show(); return; }
          const ov = document.getElementById('lixbyAuthOverlay');
          if (ov) { ov.style.display='flex'; ov.setAttribute('aria-hidden','false'); return; }
          window.location.href = 'login.html';
        } catch(err) { console.warn('accountBtn handler err', err); window.location.href = 'login.html'; }
      });
    }
    showAccountPreviewIfAvailable();

    const proBtn = document.getElementById('proBtn');
    if (proBtn) {
      proBtn.addEventListener('click', ()=> { window.location.href = 'pro.html'; });
      proBtn.textContent = getTranslation('pro.cta') || proBtn.textContent;
    }
  } catch(e){ console.warn('accountBtn attach err', e); }

  /* Download link + traducciones dinámicas */
  function updateDownloadLink(lang){
    try {
      const dl = document.getElementById('downloadBtn');
      if (!dl) return;
      const label = getTranslation('btn.download', lang) || dl.textContent || 'Descargar';
      setElementTextSafe(dl, label);
      const safeLang = (lang && typeof lang === 'string') ? lang.slice(0,2) : 'es';
      const href = 'download/guide-' + encodeURIComponent(safeLang) + '.pdf';
      dl.setAttribute('href', href);
      dl.setAttribute('download', '');
    } catch(e){ console.warn('updateDownloadLink err', e); }
  }

  const origSetLang = setLang;
  setLang = function(l){ origSetLang(l); replaceProductActions(); updateDownloadLink(l); };

  /* Promo cards interactions */
  (function promoWiring(){
    document.getElementById('goProBtn')?.addEventListener('click', ()=> window.location.href='pro.html');
    document.getElementById('learnProBtn')?.addEventListener('click', ()=> {
      document.getElementById('productos')?.scrollIntoView({ behavior:'smooth' });
      const proCard = document.querySelector('[data-product="lixby-one-pro"]');
      if (proCard) { proCard.animate([{ transform:'translateY(-6px)'},{ transform:'translateY(0)'}], { duration: 450 }); }
    });
    document.getElementById('openCatalogBtn')?.addEventListener('click', ()=> window.location.href='#productos');
    document.getElementById('garantiaBtn')?.addEventListener('click', (e)=> { e.preventDefault(); window.location.href='lixbycare.html'; });
    document.getElementById('garantiaFaqBtn')?.addEventListener('click', ()=> window.location.href='faq.html#garantia');
    document.getElementById('ecoBtn')?.addEventListener('click', ()=> window.location.href='sostenibilidad.html');
    document.querySelectorAll('.promo-card').forEach(card => {
      card.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          const btn = card.querySelector('.promo-btn, a[role="button"], a, .btn-discover');
          if(btn) btn.click();
        }
      });
    });
  })();

  /* Mobile menu: arreglo definitivo del dropdown */
  (function mobileMenu(){
    const toggle = document.getElementById('mobileMenuToggle');
    const menu = document.getElementById('mobileMenu');
    const accountBtn = document.getElementById('accountBtn');
    const accountPreview = document.getElementById('accountPreview');
    const themeBtn = document.getElementById('mobileTheme');
    const accountEntry = document.getElementById('mobileAccount');
    if (!toggle || !menu) return;

    function openMenu(){ menu.style.display='block'; menu.setAttribute('aria-hidden','false'); toggle.setAttribute('aria-expanded','true'); }
    function closeMenu(){ menu.style.display='none'; menu.setAttribute('aria-hidden','true'); toggle.setAttribute('aria-expanded','false'); }

    toggle.addEventListener('click', (e)=> {
      e.stopPropagation();
      const isOpen = menu.style.display === 'block';
      if (isOpen) closeMenu(); else openMenu();
    });
    document.addEventListener('click', (e)=> {
      if (!menu.contains(e.target) && !toggle.contains(e.target)) closeMenu();
    });
    document.addEventListener('keydown', (e)=> {
      if (e.key === 'Escape') closeMenu();
    });

    if (accountEntry)
      accountEntry.addEventListener('click', ()=> {
if (accountPreview && accountPreview.style.display === 'flex') window.location.href='cuenta.html';
else if (accountBtn) accountBtn.click();
closeMenu();
});
}
if (themeBtn) themeBtn.addEventListener('click', ()=> { document.getElementById('themeToggle')?.click(); closeMenu(); });
})();
/* Contact form (EmailJS) /
async function ensureEmailJs(){
if (window.emailjs && typeof window.emailjs.sendForm === 'function') return;
await new Promise((res, rej) => {
const s = document.createElement('script');
s.src = 'https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js';
s.crossOrigin = 'anonymous';
s.onload = res;
s.onerror = () => rej(new Error('EmailJS load failed'));
document.head.appendChild(s);
});
try { if (window.emailjs && typeof emailjs.init === 'function') emailjs.init('xsKpaFjbRsS95AK3i'); } catch(e){ console.warn('EmailJS init failed', e); }
}
(function initContact(){
const form = document.getElementById('contactForm');
const sendBtn = document.getElementById('contactSend');
const successEl = document.getElementById('contactSuccess');
const ticketHidden = document.getElementById('ticketId');
if (!form) return;
function generateTicketId(){
const t = 'LIXBY-' + Date.now().toString(36) + '-' + Math.random().toString(36).slice(2,8).toUpperCase();
return t;
}
async function sendEmail(e){
e.preventDefault();
const name = document.getElementById('contactName').value.trim();
const email = document.getElementById('contactEmail').value.trim();
const message = document.getElementById('contactMessage').value.trim();
if (!name || !email || !message) { alert(getTranslation('contact.fill') || 'Por favor completa todos los campos.'); return; }
const ticket = generateTicketId();
if (ticketHidden) ticketHidden.value = ticket;
sendBtn.disabled = true;
const prev = sendBtn.textContent; sendBtn.textContent = getTranslation('btn.enviar') || 'Enviando...';
try {
await ensureEmailJs();
if (!window.emailjs || typeof window.emailjs.sendForm !== 'function') {
throw new Error('EmailJS SDK no disponible');
}
await emailjs.sendForm('service_tagcpgm', 'template_l1e0go2', '#contactForm');
successEl.style.display = 'block';
form.reset();
try {
const key = 'lixby_tickets_v1';
const arr = JSON.parse(localStorage.getItem(key) || '[]');
arr.push({ ticket_id: ticket, name: name, email: email, message: message, created_at: new Date().toISOString(), status: 'sent' });
localStorage.setItem(key, JSON.stringify(arr));
} catch (errLocal) { /* no crítico / }
setTimeout(()=> successEl.style.display = 'none', 6000);
} catch (err) {
console.error('Error enviando con EmailJS:', err);
try {
const key = 'lixby_tickets_v1';
const arr = JSON.parse(localStorage.getItem(key) || '[]');
arr.push({ ticket_id: ticket, name: name, email: email, message: message, created_at: new Date().toISOString(), status: 'failed', error: String(err) });
localStorage.setItem(key, JSON.stringify(arr));
} catch (errLocal) { console.warn('Fallback save failed', errLocal); }
alert('No se pudo enviar el mensaje vía EmailJS. Hemos guardado una copia local del ticket y puedes reintentar más tarde.');
} finally {
sendBtn.disabled = false; sendBtn.textContent = prev;
}
}
form.addEventListener('submit', sendEmail);
})();
/* Smooth scroll para enlaces internos /
document.querySelectorAll('a[href^="#"]').forEach(link => {
link.addEventListener('click', (e) => {
const targetId = link.getAttribute('href').substring(1);
const target = document.getElementById(targetId);
if (target) {
e.preventDefault();
target.scrollIntoView({ behavior: 'smooth', block: 'start' });
}
});
});
/* Back to top /
const backToTop = document.getElementById('backToTop');
if (backToTop) {
backToTop.addEventListener('click', () => {
window.scrollTo({ top: 0, behavior: 'smooth' });
});
}
/* Newsletter form /
const newsletterForm = document.getElementById('newsletterForm');
const newsletterBtn = document.getElementById('newsletterBtn');
const newsletterMsg = document.getElementById('newsletterMsg');
if (newsletterForm && newsletterBtn) {
newsletterForm.addEventListener('submit', (e) => {
e.preventDefault();
const email = document.getElementById('newsletterEmail').value.trim();
if (!email) return;
newsletterBtn.disabled = true;
newsletterBtn.textContent = 'Suscribiendo...';
setTimeout(() => {
newsletterMsg.textContent = '¡Gracias por suscribirte!';
newsletterMsg.style.color = 'var(--accent)';
newsletterForm.reset();
newsletterBtn.disabled = false;
newsletterBtn.textContent = getTranslation('btn.subscribe') || 'Suscribir';
setTimeout(() => {
newsletterMsg.textContent = '';
}, 3000);
}, 1000);
});
}
/* Expose for debugging /
window.lixby = window.lixby || {};
window.lixby.setLang = setLang;
window.lixby.getTranslation = getTranslation;
window.lixby.showAccountPreviewIfAvailable = showAccountPreviewIfAvailable;
})();
</script>
<!-- Mejoras: sanitización y accesibilidad del mini-cart -->
<script>
(function(){
'use strict';
const CURRENCY = new Intl.NumberFormat('es-ES',{ style:'currency', currency:'EUR' });
const miniCartItems = document.getElementById('miniCartItems');
if (miniCartItems) {
const sanitizeNode = (node) => {
const meta = node.querySelector('.meta');
if (!meta) return;
const nameText = meta.textContent || '';
const parts = nameText.split('\n').map(s => s.trim()).filter(Boolean);
const title = document.createElement('div'); title.style.fontWeight = '700'; title.textContent = parts[0] || '';
const sub = document.createElement('div'); sub.style.color = 'var(--muted)'; sub.textContent = parts.slice(1).join(' ') || '';
meta.innerHTML = '';
meta.appendChild(title);
meta.appendChild(sub);
};
const observer = new MutationObserver((muts) => {
muts.forEach(m => {
m.addedNodes.forEach(n => {
if (n.nodeType !== 1) return;
if (n.classList && n.classList.contains('mini-cart-item')) sanitizeNode(n);
n.querySelectorAll && n.querySelectorAll('.mini-cart-item').forEach(el => sanitizeNode(el));
});
});
});
observer.observe(miniCartItems, { childList: true, subtree: true });
}
const cartBtn = document.getElementById('cartBtn');
const miniCart = document.getElementById('miniCart');
document.addEventListener('keydown', (e) => {
if (e.key === 'Escape') {
if (miniCart && miniCart.getAttribute('aria-hidden') === 'false') {
miniCart.setAttribute('aria-hidden','true');
miniCart.style.display = '';
cartBtn && cartBtn.setAttribute('aria-expanded','false');
cartBtn && cartBtn.focus();
}
}
});
const showObserver = new MutationObserver(() => {
try {
if (miniCart && miniCart.getAttribute('aria-hidden') === 'false') {
const focusable = miniCart.querySelector('button, [tabindex], a, input');
if (focusable) focusable.focus();
}
} catch(e) {}
});
if (miniCart) showObserver.observe(miniCart, { attributes: true, attributeFilter: ['aria-hidden'] });
const miniCartTotal = document.getElementById('miniCartTotal');
if (miniCartTotal) {
const reformat = () => {
const raw = miniCartTotal.textContent || '';
const num = parseFloat(String(raw).replace(/[^\d.-]/g,'')) || 0;
miniCartTotal.textContent = CURRENCY.format(num);
};
reformat();
const totObs = new MutationObserver(reformat);
totObs.observe(miniCartTotal, { childList: true, characterData: true, subtree: true });
}
})();
</script>
</body>
</html>
