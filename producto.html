<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LIXBY ‚Äî Detalle de producto</title>
  <link rel="stylesheet" href="style.css">
  <meta name="description" content="Ficha del producto Lixby ‚Äî detalles, precio y especificaciones." />
  <style>
    /* Minimal product UI overrides (redondeado + minimal) */
    .options { gap:18px; display:flex; flex-direction:column; }
    .option-title { font-weight:700; font-size:1.02rem; color:color-mix(in oklab, var(--text) 88%, var(--muted) 12%); margin-bottom:8px; }
    .colors { display:flex; gap:12px; align-items:center; }
    .color-dot {
      width:40px;height:40px;border-radius:50%;border:1px solid rgba(255,255,255,0.06);
      display:inline-flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .14s ease,box-shadow .14s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,0.02) inset; outline:none;
    }
    .color-dot[data-color="blue"]{ background:#2f6bff }
    .color-dot[data-color="green"]{ background:#9fe0d4 }
    .color-dot[data-color="pink"]{ background:#f1b6d9 }
    .color-dot[data-color="white"]{ background:#f7f7f7; border:1px solid rgba(0,0,0,0.08) }
    .color-dot[data-color="black"]{ background:#3d3f42 }
    .color-dot.active{ transform:scale(1.03); box-shadow: 0 18px 36px rgba(10,132,255,0.08); border-color:var(--accent); }
    .color-dot:focus{ box-shadow: 0 0 0 6px rgba(10,132,255,0.12); }

    .capacities { display:flex; gap:12px; flex-wrap:wrap; align-items:stretch; }
    .cap-card {
      min-width:150px;padding:14px 16px;border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border:1px solid rgba(255,255,255,0.04); cursor:pointer; display:flex; justify-content:space-between; align-items:center;
      transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
      box-shadow: 0 6px 18px rgba(2,6,12,0.04);
    }
    .cap-card.active{ border-color:var(--accent); transform:translateY(-6px); box-shadow:0 20px 40px rgba(10,132,255,0.06) }
    .cap-card:focus{ outline:none; box-shadow: 0 0 0 6px rgba(10,132,255,0.08); }

    .summary { margin-top:12px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03); display:flex;justify-content:space-between;align-items:center; }
    .big { font-weight:800; font-size:1.28rem; color:var(--accent); }
    .muted { color:var(--muted); font-size:0.95rem; }

    .pay-options { display:flex; gap:10px; align-items:center; }
    .pay-card { padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.04); cursor:pointer; min-width:140px; text-align:center; }
    .pay-card.active { border-color:var(--accent); box-shadow:0 12px 30px rgba(10,132,255,0.06); transform:translateY(-4px); }

    .care-row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .care-input { display:inline-flex; gap:8px; align-items:center; cursor:pointer; }

    @media (max-width:700px) {
      .color-dot { width:34px;height:34px; }
      .cap-card { min-width:48%; padding:12px;border-radius:12px; }
      .big { font-size:1.08rem; }
    }

    /* Mini-cart show/hide safety */
    .mini-cart[aria-hidden="true"] { display:none !important; pointer-events:none; }
    .mini-cart[aria-hidden="false"] { display:flex !important; pointer-events:auto; }
  </style>
</head>
<body>
  <header class="nav glass" role="banner">
    <div class="nav-inner">
      <div class="brand" role="button" onclick="location.href='index.html'">LIXBY</div>
      <nav id="navLinks" aria-label="Principal">
        <a href="index.html#inicio">Inicio</a>
        <a href="index.html#productos">Productos</a>
        <a href="index.html#contacto">Cont√°ctanos</a>
      </nav>
      <div class="nav-right">
        <div class="cart-wrapper" style="position:relative">
          <button id="cartBtn" class="icon-btn" aria-label="Ver carrito" aria-controls="miniCart" aria-expanded="false">üõí <span id="cartCount" class="badge">0</span></button>
          <div id="miniCart" class="mini-cart glass" aria-hidden="true" role="region" aria-label="Mini carrito" style="flex-direction:column;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
              <strong>Carrito</strong>
              <button id="miniClear" class="text-btn">Vaciar</button>
            </div>
            <div id="miniCartItems" style="max-height:220px;overflow:auto;"></div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
              <div><strong>Total:</strong> <span id="miniCartTotal">0‚Ç¨</span></div>
              <div><button id="checkoutBtn" class="btn primary">Pagar</button></div>
            </div>
          </div>
        </div>
        <button id="themeToggle" class="btn ghost" aria-label="Cambiar tema">‚óê</button>
      </div>
    </div>
  </header>

  <main>
    <div id="productDetail" class="product-detail glass" aria-live="polite" style="display:flex;gap:22px;max-width:1100px;margin:28px auto;padding:20px;">
      <div style="flex:1;padding:18px;">Cargando producto‚Ä¶</div>
    </div>
  </main>

  <footer class="footer glass" style="text-align:center;padding:20px;margin-top:32px;">
    <p>¬© <span id="year"></span> LIXBY ‚Äî Todos los derechos reservados</p>
  </footer>

  <!-- Script: render product + price logic (LixbyCare + pago √∫nico / plazos) -->
  <script>
  (function(){
    'use strict';
    // Helpers
    const $ = sel => document.querySelector(sel);
    const nf = v => (Math.round((Number(v)||0)*100)/100).toFixed(2).replace('.',',') + ' ‚Ç¨';
    const proxied = url => { try { return 'https://images.weserv.nl/?url=' + encodeURIComponent(url.replace(/^https?:\/\//,'')) + '&w=900&q=80'; } catch(e){ return url; } };

    // Mocked product list (puedes sustituir por tu fuente real)
    const products = {
      "lixby-one": {
        id:'lixby-one', name:'Lixby One',
        mini:'Ultraligero, potente',
        image:'https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg',
        colors:['blue','green','pink','white','black'],
        storage:{ '128':349, '256':429, '512':549, '1024':699 }
      }
    };

    // Care pricing (base monthly). We'll treat single-payment care as monthly*12 upfront approx.
    const CARE = {
      none: { id:'none', label:'Sin LixbyCare+', monthly:0 },
      standard: { id:'standard', label:'LixbyCare+ (est√°ndar)', monthly:3.00 },
      theft: { id:'theft', label:'LixbyCare+ (robo y p√©rdida)', monthly:5.00 }
    };

    // Terms available for monthly financing
    const TERMS = [6,12,18,24];

    // Cart (localStorage)
    const CART_KEY = 'lixby_cart_v1';
    function loadCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY))||[]; } catch(e){ return []; } }
    function saveCart(c){ try { localStorage.setItem(CART_KEY, JSON.stringify(c)); } catch(e){} }

    // Mini-cart elements
    let cart = loadCart();
    const cartBtn = document.getElementById('cartBtn');
    const miniCart = document.getElementById('miniCart');
    const miniCartItems = document.getElementById('miniCartItems');
    const miniCartTotal = document.getElementById('miniCartTotal');
    const cartCount = document.getElementById('cartCount');
    const miniClear = document.getElementById('miniClear');
    const checkoutBtn = document.getElementById('checkoutBtn');

    function updateMiniCartUI(){
      try {
        if (!miniCartItems) return;
        miniCartItems.innerHTML = '';
        if (!cart || cart.length === 0) {
          miniCartItems.innerHTML = '<div style="padding:8px;color:var(--muted)">Tu carrito est√° vac√≠o.</div>';
          miniCartTotal.textContent = '0 ‚Ç¨';
          if (cartCount) cartCount.textContent = '0';
          return;
        }
        let total = 0; let qty = 0;
        cart.forEach((it, idx) => {
          const row = document.createElement('div'); row.style.display='flex'; row.style.gap='10px'; row.style.padding='8px'; row.style.alignItems='center';
          const img = document.createElement('img'); img.src = it.image || 'https://via.placeholder.com/80'; img.alt = it.name || ''; img.style.width='44px'; img.style.height='44px'; img.style.objectFit='cover'; img.style.borderRadius='6px';
          const meta = document.createElement('div'); meta.style.flex='1'; meta.innerHTML = `<div style="font-weight:700">${it.name}</div><div style="color:var(--muted)">${it.price} √ó ${it.qty||1}</div>`;
          const remove = document.createElement('button'); remove.textContent='‚úï'; remove.style.background='transparent'; remove.style.border='none'; remove.style.cursor='pointer';
          remove.addEventListener('click', ()=>{ cart.splice(idx,1); saveCart(cart); updateMiniCartUI(); });
          row.appendChild(img); row.appendChild(meta); row.appendChild(remove);
          miniCartItems.appendChild(row);
          total += (it.priceNum || 0) * (it.qty||1);
          qty += (it.qty||1);
        });
        miniCartTotal.textContent = nf(total);
        if (cartCount) cartCount.textContent = qty;
      } catch(e){ console.warn('mini update err', e); }
    }
    updateMiniCartUI();

    if (cartBtn && miniCart) {
      cartBtn.addEventListener('click', () => {
        const shown = miniCart.getAttribute('aria-hidden') === 'false';
        miniCart.setAttribute('aria-hidden', String(shown));
        cartBtn.setAttribute('aria-expanded', String(!shown));
      });
      document.addEventListener('click', (ev) => {
        const tg = ev.target;
        if (!tg || !tg.closest) return;
        if (!cartBtn.contains(tg) && !miniCart.contains(tg)) {
          miniCart.setAttribute('aria-hidden','true');
          cartBtn.setAttribute('aria-expanded','false');
        }
      });
    }
    if (miniClear) miniClear.addEventListener('click', ()=> { cart=[]; saveCart(cart); updateMiniCartUI(); });
    if (checkoutBtn) checkoutBtn.addEventListener('click', ()=> { if (!cart.length) return alert('El carrito est√° vac√≠o'); alert('Simulaci√≥n checkout ‚Äî ' + cart.reduce((s,i)=>s+(i.qty||0),0) + ' items'); });

    // Expose addToCart
    window.addToCart = function(product){
      try {
        if (!product) return;
        product.priceNum = product.priceNum || Number(String(product.price||'0').replace(/[^\d.-]/g,'').replace(',', '.')) || 0;
        product.qty = Number(product.qty || 1);
        const existing = cart.find(p => p.id === product.id && p.storage === product.storage && p.color === product.color && p.care === product.care && p.term === product.term);
        if (existing) existing.qty = (existing.qty||1) + product.qty;
        else cart.push(Object.assign({}, product));
        saveCart(cart);
        updateMiniCartUI();
        // show mini cart briefly
        try { miniCart.setAttribute('aria-hidden','false'); cartBtn.setAttribute('aria-expanded','true'); setTimeout(()=>{ miniCart.setAttribute('aria-hidden','true'); cartBtn.setAttribute('aria-expanded','false'); }, 2200); } catch(e){}
      } catch(e){ console.error('addToCart err', e); }
    };

    // Product renderer + UI logic
    function getProductIdFromUrl(){
      try { const p = new URLSearchParams(location.search).get('id'); if (p) return p; } catch(e){}
      return 'lixby-one';
    }

    function renderProduct(){
      const id = getProductIdFromUrl();
      const p = products[id] || Object.values(products)[0];
      const container = document.getElementById('productDetail');
      if (!container) return;
      container.innerHTML = '';

      // image
      const wrap = document.createElement('div'); wrap.className = 'image-wrap';
      const img = document.createElement('img'); img.className='product-image'; img.alt = p.name; img.src = proxied(p.image); img.loading='eager';
      img.addEventListener('error', ()=>{ img.src = p.image; });
      wrap.appendChild(img);

      // info
      const info = document.createElement('div'); info.className='product-info';
      const title = document.createElement('h1'); title.textContent = p.name;
      const mini = document.createElement('p'); mini.textContent = p.mini || '';
      const priceEl = document.createElement('div'); priceEl.className='price'; priceEl.textContent = nf(Object.values(p.storage)[0]);

      // options container
      const options = document.createElement('div'); options.className='options';

      // Colors
      const colWrap = document.createElement('div'); const colTitle = document.createElement('div'); colTitle.className='option-title'; colTitle.textContent='Acabado. Elige tu favorito.'; colWrap.appendChild(colTitle);
      const colorsRow = document.createElement('div'); colorsRow.className='colors';
      const selColor = document.createElement('input'); selColor.type='hidden'; selColor.id='selColor';
      const savedColorKey = 'lixby_sel_color_' + p.id;
      const savedColor = localStorage.getItem(savedColorKey);
      (p.colors||[]).forEach((c, i) => {
        const b = document.createElement('button'); b.className='color-dot'; b.setAttribute('data-color', c); b.setAttribute('aria-label', c); b.tabIndex=0;
        if (savedColor ? savedColor === c : i===0) b.classList.add('active');
        b.addEventListener('click', function(){
          colorsRow.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
          this.classList.add('active'); selColor.value = this.dataset.color; localStorage.setItem(savedColorKey, this.dataset.color); updateSummary();
        });
        b.addEventListener('keydown', ev => { if (ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); b.click(); }});
        colorsRow.appendChild(b);
      });
      colWrap.appendChild(colorsRow); colWrap.appendChild(selColor); options.appendChild(colWrap);

      // Capacities
      const capWrap = document.createElement('div'); const capTitle = document.createElement('div'); capTitle.className='option-title'; capTitle.textContent='Capacidad. ¬øCu√°nto espacio necesitas?'; capWrap.appendChild(capTitle);
      const capRow = document.createElement('div'); capRow.className='capacities';
      const selCap = document.createElement('input'); selCap.type='hidden'; selCap.id='selCap';
      const keys = Object.keys(p.storage).sort((a,b)=>Number(a)-Number(b));
      const savedCapKey = 'lixby_sel_cap_' + p.id;
      const savedCap = localStorage.getItem(savedCapKey);
      keys.forEach((sz, idx) => {
        const card = document.createElement('div'); card.className='cap-card'; card.setAttribute('data-cap', sz); card.tabIndex=0;
        if (savedCap ? savedCap === sz : idx===0) card.classList.add('active');
        const left = document.createElement('div'); left.textContent = (sz==='1024' ? '1 TB' : sz + ' GB'); left.style.fontWeight='700';
        const right = document.createElement('div'); right.innerHTML = `${nf(p.storage[sz])}<div class="muted" style="margin-top:6px">o ${nf(Math.round((p.storage[sz]/24)*100)/100)} /mes (24 meses)</div>`;
        card.appendChild(left); card.appendChild(right);
        card.addEventListener('click', ()=>{ capRow.querySelectorAll('.cap-card').forEach(c=>c.classList.remove('active')); card.classList.add('active'); selCap.value = sz; localStorage.setItem(savedCapKey, sz); updateSummary(); });
        card.addEventListener('keydown', ev => { if (ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); card.click(); }});
        capRow.appendChild(card);
      });
      capWrap.appendChild(capRow); capWrap.appendChild(selCap); options.appendChild(capWrap);

      // Payment options (Pago √∫nico / Pagos mensuales)
      const payWrap = document.createElement('div'); const payTitle = document.createElement('div'); payTitle.className='option-title'; payTitle.textContent='Opciones de pago. Elige lo que m√°s te convenga.'; payWrap.appendChild(payTitle);
      const payRow = document.createElement('div'); payRow.className='pay-options';
      const paySingle = document.createElement('div'); paySingle.className='pay-card active'; paySingle.setAttribute('data-pay','single'); paySingle.textContent='Pago √∫nico';
      const payPlazo = document.createElement('div'); payPlazo.className='pay-card'; payPlazo.setAttribute('data-pay','plazo'); payPlazo.textContent='Pagos mensuales';
      payRow.appendChild(paySingle); payRow.appendChild(payPlazo);
      const selTerm = document.createElement('input'); selTerm.type='hidden'; selTerm.id='selTerm'; selTerm.value = '1';
      payWrap.appendChild(payRow); payWrap.appendChild(selTerm); options.appendChild(payWrap);

      // months modal (created on demand)
      function createMonthsModal(){
        if (document.getElementById('monthsModal')) return;
        const bd = document.createElement('div'); bd.id='monthsModal'; bd.className='modal-backdrop';
        bd.innerHTML = `<div class="modal" role="dialog" aria-modal="true" aria-labelledby="monthsTitle">
            <h3 id="monthsTitle">Elige la duraci√≥n del pago a plazo</h3>
            <div class="months" id="monthsContainer" style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap"></div>
            <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:14px">
              <button id="monthsCancel" class="text-btn">Cancelar</button>
            </div>
          </div>`;
        document.body.appendChild(bd);
        const container = bd.querySelector('#monthsContainer');
        TERMS.forEach(m => {
          const btn = document.createElement('button'); btn.type='button'; btn.className='month-btn'; btn.dataset.month = m; btn.textContent = `${m} meses`;
          btn.addEventListener('click', function(){ selTerm.value = String(m); payRow.querySelectorAll('.pay-card').forEach(c=>c.classList.remove('active')); payPlazo.classList.add('active'); closeMonthsModal(); updateSummary(); });
          container.appendChild(btn);
        });
        bd.addEventListener('click', (ev)=>{ if (ev.target === bd) closeMonthsModal(); });
        bd.querySelector('#monthsCancel').addEventListener('click', closeMonthsModal);
      }
      function openMonthsModal(){ createMonthsModal(); document.getElementById('monthsModal').classList.add('open'); }
      function closeMonthsModal(){ const m = document.getElementById('monthsModal'); if (m) m.classList.remove('open'); }

      paySingle.addEventListener('click', ()=> { payRow.querySelectorAll('.pay-card').forEach(c=>c.classList.remove('active')); paySingle.classList.add('active'); selTerm.value='1'; updateSummary(); });
      payPlazo.addEventListener('click', ()=> { openMonthsModal(); });

      // LixbyCare / AppleCare selection (checkbox style)
      const careWrap = document.createElement('div'); const careTitle = document.createElement('div'); careTitle.className='option-title'; careTitle.textContent='AppleCare+. Protege tu nuevo Lixby.'; careWrap.appendChild(careTitle);
      const careRow = document.createElement('div'); careRow.className='care-row';
      const careSelect = document.createElement('select'); careSelect.id='selCare'; const optNone = document.createElement('option'); optNone.value='none'; optNone.textContent='Sin LixbyCare+'; careSelect.appendChild(optNone);
      const optStd = document.createElement('option'); optStd.value='standard'; optStd.textContent='LixbyCare+ (est√°ndar) ‚Äî 3,00 ‚Ç¨ / mes (estim.)'; careSelect.appendChild(optStd);
      const optTheft = document.createElement('option'); optTheft.value='theft'; optTheft.textContent='LixbyCare+ (robo y p√©rdida) ‚Äî 5,00 ‚Ç¨ / mes (estim.)'; careSelect.appendChild(optTheft);
      careRow.appendChild(careSelect);
      const careCheckboxDiv = document.createElement('label'); careCheckboxDiv.className='care-input'; const careCheckbox = document.createElement('input'); careCheckbox.type='checkbox'; careCheckbox.id='careToggle'; careCheckboxDiv.appendChild(careCheckbox); careCheckboxDiv.appendChild(document.createTextNode(' A√±adir LixbyCare+'));
      careRow.appendChild(careCheckboxDiv);
      careWrap.appendChild(careRow); options.appendChild(careWrap);

      // summary
      const summary = document.createElement('div'); summary.className='summary';
      summary.innerHTML = `<div><div class="muted">Precio</div><div class="big" id="totalPrice">--</div></div><div style="text-align:right"><div id="perMonth" class="muted">--</div><div id="careInfo" class="muted">--</div></div>`;
      options.appendChild(summary);

      // actions
      const actions = document.createElement('div'); actions.style.display='flex'; actions.style.gap='10px'; actions.style.marginTop='12px';
      const addBtn = document.createElement('button'); addBtn.className='btn btn-buy'; addBtn.textContent='A√±adir al carrito';
      const favBtn = document.createElement('button'); favBtn.className='btn'; favBtn.textContent='‚ô° Favorito';
      actions.appendChild(addBtn); actions.appendChild(favBtn);

      // assemble columns
      info.appendChild(title); info.appendChild(mini); info.appendChild(priceEl); info.appendChild(options); info.appendChild(actions);
      container.appendChild(wrap); container.appendChild(info);

      // initialize values
      const initialColor = localStorage.getItem(savedColorKey) || p.colors[0]; selColor.value = initialColor;
      const initialCap = localStorage.getItem(savedCapKey) || keys[0]; selCap.value = initialCap;
      selTerm.value = '1';
      careSelect.value = 'none';
      careCheckbox.checked = false;

      // Update summary logic
      function updateSummary(){
        try {
          const cap = selCap.value || keys[0];
          const base = Number(p.storage[cap] || 0);
          const careId = careCheckbox.checked ? (careSelect.value || 'none') : 'none';
          const careMonthly = CARE[careId] ? CARE[careId].monthly : 0;
          // if pago √∫nico selected (term === '1'), compute upfront care as monthly*12
          const term = Number(selTerm.value || 1);

          // compute displayed values
          const careUpfront = Math.round(careMonthly * 12 * 100) / 100;
          const totalSingle = Math.round((base + careUpfront) * 100) / 100;
          const monthlyForTerm = Math.round(((base / Math.max(term,1)) + careMonthly) * 100) / 100;

          // Big price logic:
          // - If Pago √∫nico selected (term===1), big shows total single (base + careUpfront)
          // - If Pagos mensuales selected (term>1), big shows "Desde {base} ‚Ç¨" (total device price) but we also show prominent monthly value
          const totalEl = document.getElementById('totalPrice');
          const perMonthEl = document.getElementById('perMonth');
          const careInfoEl = document.getElementById('careInfo');

          if (term <= 1) {
            totalEl.textContent = nf(totalSingle);
            perMonthEl.textContent = `o ${nf(Math.round((base / 24)*100)/100)} /mes (ej.: 24 meses)`;
          } else {
            // show device total as "Desde X ‚Ç¨" (without care upfront) and monthly prominently
            totalEl.textContent = 'Desde ' + nf(base);
            perMonthEl.textContent = `${nf(monthlyForTerm)} /mes durante ${term} meses (estim.)`;
          }

          if (careId === 'none' || !careCheckbox.checked) careInfoEl.textContent = 'Sin LixbyCare+';
          else {
            careInfoEl.textContent = `${CARE[careId].label} ‚Äî ${nf(careMonthly)} /mes (estim.)`;
          }
        } catch(e){ console.warn('updateSummary err', e); }
      }
      updateSummary();

      // events
      // when capacity change via UI we already set selCap; ensure we call updateSummary after small delay
      container.querySelectorAll('.cap-card').forEach(c=> c.addEventListener('click', ()=> setTimeout(updateSummary,50)));
      container.querySelectorAll('.color-dot').forEach(d=> d.addEventListener('click', ()=> setTimeout(updateSummary,50)));
      // care interactions
      careCheckbox.addEventListener('change', ()=> {
        // if unchecked force select none
        if (!careCheckbox.checked) {
          careSelect.value = 'none';
        } else {
          if (careSelect.value === 'none') careSelect.value = 'standard';
        }
        updateSummary();
      });
      careSelect.addEventListener('change', ()=> {
        if (careSelect.value !== 'none') careCheckbox.checked = true;
        updateSummary();
      });

      // months selection updates already call updateSummary in modal
      // add to cart
      addBtn.addEventListener('click', ()=>{
        const cap = selCap.value || keys[0];
        const base = Number(p.storage[cap] || 0);
        const careId = careCheckbox.checked ? (careSelect.value || 'none') : 'none';
        const careMonthly = CARE[careId] ? CARE[careId].monthly : 0;
        const term = Number(selTerm.value || 1);
        const productData = {
          id: p.id,
          name: `${p.name} ‚Äî ${cap}GB ‚Äî ${selColor.value || 'color'}`,
          price: nf(base),
          priceNum: base,
          qty: 1,
          image: p.image,
          color: selColor.value || '',
          storage: cap,
          care: careId,
          term: term
        };
        window.addToCart(productData);
        addBtn.textContent = 'A√±adido';
        setTimeout(()=> addBtn.textContent = 'A√±adir al carrito', 900);
      });

      // favorites
      favBtn.addEventListener('click', ()=> {
        if (confirm('Para guardar favoritos debes iniciar sesi√≥n. ¬øIr a la p√°gina de cuenta?')) location.href='cuenta.html';
      });

    } // end renderProduct

    // render on load
    renderProduct();
    document.getElementById('year').textContent = new Date().getFullYear();

    // Theme toggle (simple)
    try {
      const tbtn = document.getElementById('themeToggle');
      tbtn && tbtn.addEventListener('click', ()=> {
        document.documentElement.classList.toggle('light');
        try { localStorage.setItem('lixby_theme', document.documentElement.classList.contains('light') ? 'light' : 'dark'); } catch(e){}
      });
    } catch(e){}
  })();
  </script>
</body>
</html>
