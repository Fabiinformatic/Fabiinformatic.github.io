<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LIXBY ‚Äî Detalle de producto</title>
  <link rel="stylesheet" href="style.css">
  <meta name="description" content="Ficha del producto Lixby ‚Äî detalles, precio y especificaciones." />
  <style>
    /* Minimal product UI overrides (redondeado + minimal) */
    .options { gap:18px; display:flex; flex-direction:column; }
    .option-title { font-weight:700; font-size:1.02rem; color:color-mix(in oklab, var(--text) 88%, var(--muted) 12%); margin-bottom:8px; }
    .colors { display:flex; gap:12px; align-items:center; }
    .color-dot {
      width:40px;height:40px;border-radius:50%;border:1px solid rgba(255,255,255,0.06);
      display:inline-flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .14s ease,box-shadow .14s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,0.02) inset; outline:none;
    }
    .color-dot[data-color="blue"]{ background:#2f6bff }
    .color-dot[data-color="green"]{ background:#9fe0d4 }
    .color-dot[data-color="pink"]{ background:#f1b6d9 }
    .color-dot[data-color="white"]{ background:#f7f7f7; border:1px solid rgba(0,0,0,0.08) }
    .color-dot[data-color="black"]{ background:#3d3f42 }
    .color-dot.active{ transform:scale(1.03); box-shadow: 0 18px 36px rgba(10,132,255,0.08); border-color:var(--accent); }
    .color-dot:focus{ box-shadow: 0 0 0 6px rgba(10,132,255,0.12); }

    .capacities { display:flex; gap:12px; flex-wrap:wrap; align-items:stretch; }
    .cap-card {
      min-width:150px;padding:14px 16px;border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border:1px solid rgba(255,255,255,0.04); cursor:pointer; display:flex; justify-content:space-between; align-items:center;
      transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
      box-shadow: 0 6px 18px rgba(2,6,12,0.04);
    }
    .cap-card.active{ border-color:var(--accent); transform:translateY(-6px); box-shadow:0 20px 40px rgba(10,132,255,0.06) }
    .cap-card:focus{ outline:none; box-shadow: 0 0 0 6px rgba(10,132,255,0.08); }

    .summary { margin-top:12px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03); display:flex;justify-content:space-between;align-items:center; }
    .big { font-weight:800; font-size:1.28rem; color:var(--accent); }
    .muted { color:var(--muted); font-size:0.95rem; }

    .pay-options { display:flex; gap:10px; align-items:center; }
    .pay-card { padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.04); cursor:pointer; min-width:140px; text-align:center; }
    .pay-card.active { border-color:var(--accent); box-shadow:0 12px 30px rgba(10,132,255,0.06); transform:translateY(-4px); }

    .term-select-wrap { display:flex; gap:8px; align-items:center; margin-left:8px; }
    .term-select { padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit; }

    /* LixbyCare as square cards (like capacities) */
    .care-grid { display:flex; gap:12px; flex-wrap:wrap; align-items:stretch; }
    .care-card {
      min-width:160px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      cursor:pointer; display:flex; flex-direction:column; gap:8px;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .care-card.active { border-color:var(--accent); transform:translateY(-6px); box-shadow:0 18px 36px rgba(10,132,255,0.06); }
    .care-card small { color:var(--muted); font-size:0.92rem; }

    /* small responsive adjustments */
    @media (max-width:700px) {
      .color-dot { width:34px;height:34px; }
      .cap-card { min-width:48%; padding:12px;border-radius:12px; }
      .big { font-size:1.08rem; }
      .term-select-wrap { margin-left:0; margin-top:8px; flex-direction:column; align-items:flex-start; }
    }

    /* Mini-cart show/hide safety */
    .mini-cart[aria-hidden="true"] { display:none !important; pointer-events:none; }
    .mini-cart[aria-hidden="false"] { display:flex !important; pointer-events:auto; }
  </style>
</head>
<body>
  <header class="nav glass" role="banner">
    <div class="nav-inner">
      <div class="brand" role="button" onclick="location.href='index.html'">LIXBY</div>
      <nav id="navLinks" aria-label="Principal">
        <a href="index.html#inicio">Inicio</a>
        <a href="index.html#productos">Productos</a>
        <a href="index.html#contacto">Cont√°ctanos</a>
      </nav>
      <div class="nav-right">
        <div class="cart-wrapper" style="position:relative">
          <button id="cartBtn" class="icon-btn" aria-label="Ver carrito" aria-controls="miniCart" aria-expanded="false">üõí <span id="cartCount" class="badge">0</span></button>
          <div id="miniCart" class="mini-cart glass" aria-hidden="true" role="region" aria-label="Mini carrito" style="flex-direction:column;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
              <strong>Carrito</strong>
              <button id="miniClear" class="text-btn">Vaciar</button>
            </div>
            <div id="miniCartItems" style="max-height:220px;overflow:auto;"></div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
              <div><strong>Total:</strong> <span id="miniCartTotal">0‚Ç¨</span></div>
              <div><button id="checkoutBtn" class="btn primary">Pagar</button></div>
            </div>
          </div>
        </div>
        <button id="themeToggle" class="btn ghost" aria-label="Cambiar tema">‚óê</button>
      </div>
    </div>
  </header>

  <main>
    <div id="productDetail" class="product-detail glass" aria-live="polite" style="display:flex;gap:22px;max-width:1100px;margin:28px auto;padding:20px;">
      <div style="flex:1;padding:18px;">Cargando producto‚Ä¶</div>
    </div>
  </main>

  <footer class="footer glass" style="text-align:center;padding:20px;margin-top:32px;">
    <p>¬© <span id="year"></span> LIXBY ‚Äî Todos los derechos reservados</p>
  </footer>

  <script>
  (function(){
    'use strict';
    // Util helpers
    const nf = v => (Math.round((Number(v)||0)*100)/100).toFixed(2).replace('.',',') + ' ‚Ç¨';
    const proxied = url => { try { return 'https://images.weserv.nl/?url=' + encodeURIComponent(url.replace(/^https?:\/\//,'')) + '&w=900&q=80'; } catch(e){ return url; } };

    // Product dataset
    const products = {
      "lixby-one": {
        id:'lixby-one', name:'Lixby One',
        mini:'Ultraligero, potente',
        image:'https://m.media-amazon.com/images/I/712Pyq1hPfL._UF1000,1000_QL80_.jpg',
        colors:['blue','green','pink','white','black'],
        storage:{ '128':349, '256':429, '512':549, '1024':699 }
      }
    };

    // Care options: monthly base
    const CARE = {
      none: { id:'none', label:'Sin LixbyCare+', monthly:0 },
      standard: { id:'standard', label:'LixbyCare+ (est√°ndar)', monthly:3.00 },
      theft: { id:'theft', label:'LixbyCare+ (robo y p√©rdida)', monthly:5.00 }
    };

    // Terms allowed (now including 30,36)
    const TERMS = [6,12,18,24,30,36];

    // Cart storage helpers (unchanged)
    const CART_KEY = 'lixby_cart_v1';
    function loadCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY))||[]; } catch(e){ return []; } }
    function saveCart(c){ try { localStorage.setItem(CART_KEY, JSON.stringify(c)); } catch(e){} }
    let cart = loadCart();

    // Mini-cart UI
    const cartBtn = document.getElementById('cartBtn');
    const miniCart = document.getElementById('miniCart');
    const miniCartItems = document.getElementById('miniCartItems');
    const miniCartTotal = document.getElementById('miniCartTotal');
    const cartCount = document.getElementById('cartCount');
    const miniClear = document.getElementById('miniClear');
    const checkoutBtn = document.getElementById('checkoutBtn');

    function updateMiniCartUI(){
      try {
        if (!miniCartItems) return;
        miniCartItems.innerHTML = '';
        if (!cart || cart.length === 0) {
          miniCartItems.innerHTML = '<div style="padding:8px;color:var(--muted)">Tu carrito est√° vac√≠o.</div>';
          miniCartTotal.textContent = '0 ‚Ç¨';
          if (cartCount) cartCount.textContent = '0';
          return;
        }
        let total = 0, qty = 0;
        cart.forEach((it, idx) => {
          const row = document.createElement('div'); row.style.display='flex'; row.style.gap='10px'; row.style.padding='8px'; row.style.alignItems='center';
          const img = document.createElement('img'); img.src = it.image || 'https://via.placeholder.com/80'; img.alt = it.name || ''; img.style.width='44px'; img.style.height='44px'; img.style.objectFit='cover'; img.style.borderRadius='6px';
          const meta = document.createElement('div'); meta.style.flex='1'; meta.innerHTML = `<div style="font-weight:700">${it.name}</div><div style="color:var(--muted)">${it.price} √ó ${it.qty||1}</div>`;
          const remove = document.createElement('button'); remove.textContent='‚úï'; remove.style.background='transparent'; remove.style.border='none'; remove.style.cursor='pointer';
          remove.addEventListener('click', ()=>{ cart.splice(idx,1); saveCart(cart); updateMiniCartUI(); });
          row.appendChild(img); row.appendChild(meta); row.appendChild(remove);
          miniCartItems.appendChild(row);
          total += (it.priceNum || 0) * (it.qty||1);
          qty += (it.qty||1);
        });
        miniCartTotal.textContent = nf(total);
        if (cartCount) cartCount.textContent = qty;
      } catch(e){ console.warn('mini update err', e); }
    }
    updateMiniCartUI();

    if (cartBtn && miniCart) {
      cartBtn.addEventListener('click', () => {
        const shown = miniCart.getAttribute('aria-hidden') === 'false';
        miniCart.setAttribute('aria-hidden', String(!shown));
        cartBtn.setAttribute('aria-expanded', String(!shown));
      });
      document.addEventListener('click', (ev) => {
        const tg = ev.target;
        if (!tg || !tg.closest) return;
        if (!cartBtn.contains(tg) && !miniCart.contains(tg)) {
          miniCart.setAttribute('aria-hidden','true');
          cartBtn.setAttribute('aria-expanded','false');
        }
      });
    }
    if (miniClear) miniClear.addEventListener('click', ()=> { cart=[]; saveCart(cart); updateMiniCartUI(); });
    if (checkoutBtn) checkoutBtn.addEventListener('click', ()=> { if (!cart.length) return alert('El carrito est√° vac√≠o'); alert('Simulaci√≥n checkout ‚Äî ' + cart.reduce((s,i)=>s+(i.qty||0),0) + ' items'); });

    window.addToCart = function(product){
      try {
        if (!product) return;
        product.priceNum = product.priceNum || Number(String(product.price||'0').replace(/[^\d.-]/g,'').replace(',', '.')) || 0;
        product.qty = Number(product.qty || 1);
        const existing = cart.find(p => p.id === product.id && p.storage === product.storage && p.color === product.color && p.care === product.care && p.term === product.term);
        if (existing) existing.qty = (existing.qty||1) + product.qty;
        else cart.push(Object.assign({}, product));
        saveCart(cart);
        updateMiniCartUI();
        try { miniCart.setAttribute('aria-hidden','false'); cartBtn.setAttribute('aria-expanded','true'); setTimeout(()=>{ miniCart.setAttribute('aria-hidden','true'); cartBtn.setAttribute('aria-expanded','false'); }, 2200); } catch(e){}
      } catch(e){ console.error('addToCart err', e); }
    };

    // Render product + UI logic
    function getProductIdFromUrl(){ try { const p = new URLSearchParams(location.search).get('id'); if (p) return p; } catch(e){} return 'lixby-one'; }
    function renderProduct(){
      const id = getProductIdFromUrl();
      const p = products[id] || Object.values(products)[0];
      const container = document.getElementById('productDetail');
      if (!container) return;
      container.innerHTML = '';

      // image
      const wrap = document.createElement('div'); wrap.className = 'image-wrap';
      const img = document.createElement('img'); img.className='product-image'; img.alt = p.name; img.src = proxied(p.image); img.loading='eager';
      img.addEventListener('error', ()=>{ img.src = p.image; });
      wrap.appendChild(img);

      // info column
      const info = document.createElement('div'); info.className='product-info';
      const title = document.createElement('h1'); title.textContent = p.name;
      const mini = document.createElement('p'); mini.textContent = p.mini || '';
      const priceEl = document.createElement('div'); priceEl.className='price'; priceEl.textContent = nf(Object.values(p.storage)[0]);

      const options = document.createElement('div'); options.className='options';

      // colors
      const colWrap = document.createElement('div'); const colTitle = document.createElement('div'); colTitle.className='option-title'; colTitle.textContent='Acabado. Elige tu favorito.'; colWrap.appendChild(colTitle);
      const colorsRow = document.createElement('div'); colorsRow.className='colors';
      const selColor = document.createElement('input'); selColor.type='hidden'; selColor.id='selColor';
      const savedColorKey = 'lixby_sel_color_' + p.id;
      const savedColor = localStorage.getItem(savedColorKey);
      (p.colors||[]).forEach((c, i) => {
        const b = document.createElement('button'); b.className='color-dot'; b.setAttribute('data-color', c); b.setAttribute('aria-label', c); b.tabIndex=0;
        if (savedColor ? savedColor === c : i===0) b.classList.add('active');
        b.addEventListener('click', function(){
          colorsRow.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
          this.classList.add('active'); selColor.value = this.dataset.color; localStorage.setItem(savedColorKey, this.dataset.color); updateSummary();
        });
        b.addEventListener('keydown', ev => { if (ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); b.click(); }});
        colorsRow.appendChild(b);
      });
      colWrap.appendChild(colorsRow); colWrap.appendChild(selColor); options.appendChild(colWrap);

      // capacities
      const capWrap = document.createElement('div'); const capTitle = document.createElement('div'); capTitle.className='option-title'; capTitle.textContent='Capacidad. ¬øCu√°nto espacio necesitas?'; capWrap.appendChild(capTitle);
      const capRow = document.createElement('div'); capRow.className='capacities';
      const selCap = document.createElement('input'); selCap.type='hidden'; selCap.id='selCap';
      const keys = Object.keys(p.storage).sort((a,b)=>Number(a)-Number(b));
      const savedCapKey = 'lixby_sel_cap_' + p.id;
      const savedCap = localStorage.getItem(savedCapKey);
      keys.forEach((sz, idx) => {
        const card = document.createElement('div'); card.className='cap-card'; card.setAttribute('data-cap', sz); card.tabIndex=0;
        if (savedCap ? savedCap === sz : idx===0) card.classList.add('active');
        const left = document.createElement('div'); left.textContent = (sz==='1024' ? '1 TB' : sz + ' GB'); left.style.fontWeight='700';
        const right = document.createElement('div'); right.innerHTML = `${nf(p.storage[sz])}<div class="muted" style="margin-top:6px">o ${nf(Math.round((p.storage[sz]/24)*100)/100)} /mes (24 meses)</div>`;
        card.appendChild(left); card.appendChild(right);
        card.addEventListener('click', ()=>{ capRow.querySelectorAll('.cap-card').forEach(c=>c.classList.remove('active')); card.classList.add('active'); selCap.value = sz; localStorage.setItem(savedCapKey, sz); updateSummary(); });
        card.addEventListener('keydown', ev => { if (ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); card.click(); }});
        capRow.appendChild(card);
      });
      capWrap.appendChild(capRow); capWrap.appendChild(selCap); options.appendChild(capWrap);

      // payment options (Pago √∫nico / Pagos mensuales)
      const payWrap = document.createElement('div'); const payTitle = document.createElement('div'); payTitle.className='option-title'; payTitle.textContent='Opciones de pago. Elige lo que m√°s te convenga.'; payWrap.appendChild(payTitle);
      const payRow = document.createElement('div'); payRow.className='pay-options';
      const paySingle = document.createElement('div'); paySingle.className='pay-card active'; paySingle.setAttribute('data-pay','single'); paySingle.textContent='Pago √∫nico';
      const payPlazo = document.createElement('div'); payPlazo.className='pay-card'; payPlazo.setAttribute('data-pay','plazo'); payPlazo.textContent='Pagos mensuales';
      payRow.appendChild(paySingle); payRow.appendChild(payPlazo);

      // term select dropdown (visible only when plazo active)
      const termWrap = document.createElement('div'); termWrap.className='term-select-wrap';
      const termSelect = document.createElement('select'); termSelect.className='term-select'; termSelect.id = 'selTerm';
      // options: 6,12,18,24,30,36
      [6,12,18,24,30,36].forEach(m => {
        const o = document.createElement('option'); o.value = String(m); o.textContent = `${m} meses`;
        termSelect.appendChild(o);
      });
      // price badge next to select (base/mes)
      const termBadge = document.createElement('div'); termBadge.id = 'termBadge'; termBadge.className = 'muted';
      termWrap.appendChild(termSelect); termWrap.appendChild(termBadge);

      // initially hide termWrap (Pago √∫nico default)
      termWrap.style.display = 'none';

      payWrap.appendChild(payRow); payWrap.appendChild(termWrap); options.appendChild(payWrap);

      // LixbyCare as square cards
      const careWrap = document.createElement('div'); const careTitle = document.createElement('div'); careTitle.className='option-title'; careTitle.textContent='AppleCare+. Protege tu nuevo Lixby.'; careWrap.appendChild(careTitle);
      const careGrid = document.createElement('div'); careGrid.className = 'care-grid';
      const careSavedKey = 'lixby_sel_care_' + p.id;
      const savedCare = localStorage.getItem(careSavedKey) || 'none';
      // build cards from CARE map
      Object.values(CARE).forEach(c => {
        const card = document.createElement('button'); card.type='button'; card.className='care-card'; card.setAttribute('data-care', c.id);
        if (savedCare === c.id) card.classList.add('active');
        card.innerHTML = `<div style="font-weight:700">${c.label === 'Sin LixbyCare+' ? 'Sin LixbyCare+' : c.label}</div><small>${c.monthly > 0 ? (nf(c.monthly) + ' / mes (estim.)') : 'Sin coste'}</small>`;
        card.addEventListener('click', ()=> {
          careGrid.querySelectorAll('.care-card').forEach(x=>x.classList.remove('active'));
          card.classList.add('active');
          localStorage.setItem(careSavedKey, c.id);
          updateSummary();
        });
        careGrid.appendChild(card);
      });
      careWrap.appendChild(careGrid);
      options.appendChild(careWrap);

      // summary
      const summary = document.createElement('div'); summary.className='summary';
      summary.innerHTML = `<div><div class="muted">Precio</div><div class="big" id="totalPrice">--</div></div><div style="text-align:right"><div id="perMonth" class="muted">--</div><div id="careInfo" class="muted">--</div></div>`;
      options.appendChild(summary);

      // actions (add to cart / fav)
      const actions = document.createElement('div'); actions.style.display='flex'; actions.style.gap='10px'; actions.style.marginTop='12px';
      const addBtn = document.createElement('button'); addBtn.className='btn btn-buy'; addBtn.textContent='A√±adir al carrito';
      const favBtn = document.createElement('button'); favBtn.className='btn'; favBtn.textContent='‚ô° Favorito';
      actions.appendChild(addBtn); actions.appendChild(favBtn);

      // assemble info
      info.appendChild(title); info.appendChild(mini); info.appendChild(priceEl); info.appendChild(options); info.appendChild(actions);
      container.appendChild(wrap); container.appendChild(info);

      // initialize hidden values
      selColor.value = savedColor || (p.colors[0]||'');
      selCap.value = savedCap || keys[0];
      termSelect.value = '12'; // default when switching to plazo
      // init care active state
      const activeCareId = savedCare || 'none';
      careGrid.querySelectorAll('.care-card').forEach(card => {
        if (card.dataset.care === activeCareId) card.classList.add('active'); else card.classList.remove('active');
      });

      // Payment toggles
      paySingle.addEventListener('click', ()=> {
        payRow.querySelectorAll('.pay-card').forEach(c=>c.classList.remove('active'));
        paySingle.classList.add('active');
        termWrap.style.display = 'none';
        updateSummary();
      });
      payPlazo.addEventListener('click', ()=> {
        payRow.querySelectorAll('.pay-card').forEach(c=>c.classList.remove('active'));
        payPlazo.classList.add('active');
        termWrap.style.display = 'flex';
        updateSummary();
      });

      termSelect.addEventListener('change', updateSummary);
      // capacity and color interactions already wired via localStorage listeners when cards clicked

      // care card click handled earlier ‚Äî add keyboard support
      careGrid.querySelectorAll('.care-card').forEach(c=> c.addEventListener('keydown', ev => { if (ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); c.click(); }}));

      // update summary function
      function updateSummary(){
        try {
          const cap = selCap.value || keys[0];
          const base = Number(p.storage[cap] || 0);
          // detect term selection
          const isPlazo = payPlazo.classList.contains('active');
          const term = isPlazo ? Number(termSelect.value || 12) : 1;
          // care selected
          const careId = (careGrid.querySelector('.care-card.active') || {}).dataset?.care || 'none';
          const careMonthly = CARE[careId] ? CARE[careId].monthly : 0;

          // compute values
          const deviceTotal = base;
          const deviceMonthly = Math.round((deviceTotal / Math.max(term,1)) * 100) / 100;
          const careUpfront = Math.round(careMonthly * 12 * 100) / 100; // upfront cost for single payment approximated as 12*monthly
          const totalSingle = Math.round((deviceTotal + careUpfront) * 100) / 100;
          const perMonthTotal = Math.round((deviceMonthly + careMonthly) * 100) / 100;

          const totalEl = document.getElementById('totalPrice');
          const perMonthEl = document.getElementById('perMonth');
          const careInfoEl = document.getElementById('careInfo');
          const termBadgeEl = document.getElementById('termBadge');

          if (!isPlazo) {
            // show full total (device + upfront care)
            totalEl.textContent = nf(totalSingle);
            perMonthEl.textContent = `Pago √∫nico. Ejemplo: ${nf(Math.round((deviceTotal/24)*100)/100)} /mes (si financias a 24 meses)`;
            termBadgeEl.textContent = ''; // hide badge when not plazo
          } else {
            totalEl.textContent = 'Desde ' + nf(deviceTotal);
            perMonthEl.textContent = `${nf(perMonthTotal)} /mes durante ${term} meses (estim.)`;
            termBadgeEl.textContent = `Dispositivo: ${nf(deviceMonthly)} /mes`; // badge shows device-only monthly price
          }

          if (!careId || careId === 'none') {
            careInfoEl.textContent = 'Sin LixbyCare+';
          } else {
            careInfoEl.textContent = `${CARE[careId].label} ‚Äî ${nf(careMonthly)} /mes (estim.)`;
          }

        } catch(e){ console.warn('updateSummary err', e); }
      }

      // initial update
      updateSummary();

      // add to cart behavior
      addBtn.addEventListener('click', ()=>{
        const cap = selCap.value || keys[0];
        const base = Number(p.storage[cap] || 0);
        const careId = (careGrid.querySelector('.care-card.active') || {}).dataset?.care || 'none';
        const term = payPlazo.classList.contains('active') ? Number(termSelect.value || 12) : 1;
        const productData = {
          id: p.id,
          name: `${p.name} ‚Äî ${cap} GB ‚Äî ${selColor.value || 'color'}`,
          price: nf(base),
          priceNum: base,
          qty: 1,
          image: p.image,
          color: selColor.value || '',
          storage: cap,
          care: careId,
          term: term
        };
        window.addToCart(productData);
        addBtn.textContent = 'A√±adido';
        setTimeout(()=> addBtn.textContent = 'A√±adir al carrito', 900);
      });

      // favorites
      favBtn.addEventListener('click', ()=> {
        if (confirm('Para guardar favoritos debes iniciar sesi√≥n. ¬øIr a la p√°gina de cuenta?')) location.href='cuenta.html';
      });

      // ensure keyboard accessibility on cap/color
      capRow.querySelectorAll('.cap-card').forEach(c=> c.addEventListener('keydown', ev => { if (ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); c.click(); }}));
      colorsRow.querySelectorAll('.color-dot').forEach(d=> d.addEventListener('keydown', ev => { if (ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); d.click(); }}));
    } // end renderProduct

    renderProduct();
    try { document.getElementById('year').textContent = new Date().getFullYear(); } catch(e){}
    // theme toggle (simple)
    try {
      const tbtn = document.getElementById('themeToggle');
      tbtn && tbtn.addEventListener('click', ()=> {
        document.documentElement.classList.toggle('light');
        try { localStorage.setItem('lixby_theme', document.documentElement.classList.contains('light') ? 'light' : 'dark'); } catch(e){}
      });
    } catch(e){}
  })();
  </script>
</body>
</html>
