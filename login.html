<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Iniciar sesión — LIXBY</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="wrap">
    <header style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px">
      <a class="brand" href="index.html"><img src="https://i.imgur.com/dOCYmkx.jpeg" alt="LIXBY" width="44" height="44"><strong>LIXBY</strong></a>
    </header>

    <section class="panel" style="max-width:520px;margin:0 auto">
      <h1>Inicia sesión para acceder a Lixby</h1>
      <p class="small">Gestiona pedidos, favoritos y tu perfil.</p>

      <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px">
        <button id="btnGoogle" class="auth-btn ghost">Iniciar con Google</button>
        <button id="btnGithub" class="auth-btn ghost">Iniciar con GitHub</button>
      </div>

      <div style="display:flex;align-items:center;gap:8px;margin:12px 0;">
        <hr style="flex:1;border:none;height:1px;background:rgba(0,0,0,0.06)"><div class="muted">o</div><hr style="flex:1;border:none;height:1px;background:rgba(0,0,0,0.06)"></div>

      <form id="loginForm" style="display:flex;flex-direction:column;gap:10px">
        <label for="loginId">Correo electrónico o teléfono</label>
        <input id="loginId" autocomplete="username" />

        <label for="loginPass">Contraseña</label>
        <input id="loginPass" type="password" autocomplete="current-password" />

        <div style="display:flex;justify-content:space-between;align-items:center">
          <a href="forgot-password.html" class="muted">¿Has olvidado la contraseña?</a>
          <button class="btn primary" type="submit">Iniciar sesión</button>
        </div>

        <div class="small muted">¿No tienes cuenta? <a href="register.html">Crear cuenta de Lixby</a></div>
        <div id="errLogin" class="errorsmall" aria-live="polite"></div>
      </form>
    </section>
  </main>

  <script type="module" src="auth-firebase-minimal.js"></script>
  <script>
    (function(){
      document.getElementById('btnGoogle').addEventListener('click', ()=> { if (window.appAuth) window.appAuth.signInWithGoogle(); else alert('No disponible'); });
      document.getElementById('btnGithub').addEventListener('click', ()=> { if (window.appAuth) window.appAuth.signInWithGitHub(); else alert('No disponible'); });

      document.getElementById('loginForm').addEventListener('submit', async (e)=> {
        e.preventDefault();
        document.getElementById('errLogin').textContent = '';
        const id = (document.getElementById('loginId').value||'').trim();
        const pass = document.getElementById('loginPass').value || '';
        if (!id) { document.getElementById('errLogin').textContent = 'Introduce correo o teléfono'; return; }
        if (!pass) { document.getElementById('errLogin').textContent = 'Introduce la contraseña'; return; }
        try {
          if (window.appAuth && typeof window.appAuth.signInWithEmail === 'function') {
            await window.appAuth.signInWithEmail(id, pass);
            // appAuth handles redirect to cuenta.html
          } else {
            // fallback demo
            alert('Demo: autenticación simulada. Redirigiendo a cuenta.');
            setTimeout(()=> location.href='cuenta.html', 600);
          }
        } catch(err) {
          console.warn(err);
          document.getElementById('errLogin').textContent = err && err.message ? err.message : 'Error al iniciar sesión';
        }
      });
    })();
  </script>
</body>
</html>
