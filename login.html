<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Inicia sesión — LIXBY</title>
  <meta name="description" content="Inicia sesión en Lixby para acceder a tus servicios.">
  <style>
    :root{ --bg:#07121a; --card:#0f1724; --muted:#9aa7b0; --text:#e6eef2; --accent:#3dd1c3; --danger:#ff5c5c; --radius:12px; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    body{margin:0;background:linear-gradient(180deg,#041018,#07121a);color:var(--text);-webkit-font-smoothing:antialiased}
    .wrap{max-width:520px;margin:48px auto;padding:18px}
    a.brand{display:flex;align-items:center;gap:8px;text-decoration:none;color:inherit;margin-bottom:8px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008)); border:1px solid rgba(255,255,255,0.03); padding:18px;border-radius:var(--radius)}
    h1{margin:0 0 6px;font-size:1.2rem}
    p.small{color:var(--muted)}
    .field{display:flex;flex-direction:column;margin-bottom:12px}
    input{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    .btn{padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:#00121a;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
    .row{display:flex;gap:8px;align-items:center}
    .muted{color:var(--muted)}
    .errorsmall{color:var(--danger);font-size:0.9rem;margin-top:6px}
    footer{margin-top:12px;color:var(--muted);font-size:0.9rem}
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <a class="brand" href="index.html" aria-label="Ir al inicio"><img src="https://i.imgur.com/dOCYmkx.jpeg" alt="LIXBY logo" width="44" height="44"><strong>LIXBY</strong></a>
    <article class="panel" aria-labelledby="h">
      <h1 id="h">Inicia sesión para acceder a Lixby y a tus servicios</h1>
      <p class="small">Inicia sesión en Lixby para gestionar pedidos, favoritos y configuración.</p>

      <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px">
        <button id="btnGoogle" class="btn ghost" aria-label="Iniciar con Google">Iniciar con Google</button>
        <button id="btnGithub" class="btn ghost" aria-label="Iniciar con GitHub">Iniciar con GitHub</button>
      </div>

      <div class="divider" style="margin-top:12px">
        <hr><div class="muted">o</div><hr>
      </div>

      <form id="loginForm" novalidate style="margin-top:12px">
        <div class="field">
          <label for="loginId">Correo electrónico o número de teléfono</label>
          <input id="loginId" autocomplete="username" />
          <div id="err-loginId" class="errorsmall" aria-live="polite"></div>
        </div>
        <div class="field">
          <label for="loginPass">Contraseña</label>
          <input id="loginPass" type="password" autocomplete="current-password" />
          <div id="err-loginPass" class="errorsmall" aria-live="polite"></div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:8px">
          <a href="forgot-password.html" class="muted link">¿Has olvidado la contraseña?</a>
          <button type="submit" class="btn">Iniciar sesión</button>
        </div>

        <div class="small muted">¿No tienes cuenta de Lixby? <a href="register.html" class="link">Crear cuenta de Lixby</a></div>
      </form>
    </article>

    <footer>
      <p class="muted">Si necesitas ayuda, contacta con <a href="mailto:soporte@lixby.example" class="link">soporte@lixby.example</a></p>
    </footer>
  </main>

  <script type="module">
    // Conectar con Firebase o reusar window.appAuth si está disponible.
    async function trySocial(providerName){
      if (window.appAuth) {
        try {
          if (providerName === 'google') await window.appAuth.signInWithGoogle();
          else await window.appAuth.signInWithGitHub();
          return;
        } catch(e){ console.warn(e); alert('Error al iniciar con '+providerName); return; }
      }
      alert('Social sign-in no disponible en demo - integra appAuth para OAUTH real.');
    }

    document.getElementById('btnGoogle').addEventListener('click', ()=> trySocial('google'));
    document.getElementById('btnGithub').addEventListener('click', ()=> trySocial('github'));

    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      document.getElementById('err-loginId').textContent = '';
      document.getElementById('err-loginPass').textContent = '';

      const id = document.getElementById('loginId').value.trim();
      const pass = document.getElementById('loginPass').value || '';
      if(!id){ document.getElementById('err-loginId').textContent = 'Introduce correo o teléfono'; document.getElementById('loginId').focus(); return; }
      if(!pass){ document.getElementById('err-loginPass').textContent = 'Introduce la contraseña'; document.getElementById('loginPass').focus(); return; }

      // prefer window.appAuth if available
      if (window.appAuth && typeof window.appAuth.signInWithEmail === 'function') {
        try {
          await window.appAuth.signInWithEmail(id, pass);
          // success: handled by appAuth (redirect)
          return;
        } catch (err) {
          console.warn(err);
          document.getElementById('err-loginPass').textContent = err.message || 'Error al iniciar sesión';
          return;
        }
      }

      // fallback demo: accept any
      document.getElementById('err-loginPass').textContent = '';
      alert('Demo: sesión iniciada (simulado). Redirigiendo a Mi cuenta.');
      setTimeout(()=> location.href = 'cuenta.html', 600);
    });
  </script>
</body>
</html>
